/*@license SPA.js (XHR) [MIT]*/
!function(t){var n=Object.prototype,s=Array.prototype,w=0;function o(e,t){return 1===arguments.length?s.slice.call(e):s.slice.call(e,t)}function a(e){return-1<r.indexOf(e)}function S(e,t){return n.hasOwnProperty.call(e,t)}var r="hasOwnProperty,prototype,__proto__".split(",");function e(t,n){return Object.keys(n).forEach(function(e){a(e)||Object.defineProperty(t,e,{value:n[e]})}),t}var i,c,l,u=spa.extractStrBetweenIn,f=spa.is,A=spa.isString,p=spa.isArray,C=spa.isObject,d=spa.isObjectLike,D=spa.isFunction,H=spa.isUndefined,q=spa.extend,U=spa.merge,h=spa.find;function k(e){if(C(e)){var s,a,r,i=e;return S(e,"_payload_")||function e(t){var n=!0;if("object"==typeof t)for(var s=Object.keys(t),a=0;n&&a<s.length;a++)n="object"!=typeof t[s[a]]||p(t[s[a]])&&e(t[s[a]]);return n}(e)||(i={_payload_:e}),Object.keys(i).reduce(function(e,t,n){return s=0===n?"":"&",a=encodeURIComponent(t),r=p(i[t])?i[t].map(function(e){return o(e)}).join(","):o(i[t]),[e,s,a,"=",r].join("")},"")}return String(e);function o(e){return encodeURIComponent("object"==typeof e?JSON.stringify(e):e)}}function Q(e){return e instanceof M||e instanceof R||e instanceof v||t.Promise&&e instanceof Promise||t.jqXHR&&e instanceof jqXHR||t.Thenable&&e instanceof Thenable||t.Deferred&&e instanceof Deferred}function N(e,t,n){var s=e.fnQ.then,a=e.fnQ.fail,r=e.fnQ.done,i={then:"then,fail,done",fail:"fail,done",done:"done"}[n];if(Q(t)){if(-1<i.indexOf("then"))for(;0<s.length;)t.then(s.shift());else e.fnQ.then=[];if(-1<i.indexOf("fail"))for(;0<a.length;)t.catch(a.shift());else e.fnQ.fail=[];if(-1<i.indexOf("done"))for(;0<r.length;)t.finally(r.shift())}}function v(t,n,s){Object.defineProperty(this,"fnQ",{value:{then:[],fail:[],done:[]}}),this.isPending=!0,this.isResolved=!1,this.isRejected=!1,this.response,this.prevFnRes;var i=this;function a(e,t){if(i.isPending){i.isPending=!1,i.response=t,i.prevFnRes=t,i.isResolved=e,i.isRejected=!e;var n=i.fnQ.then,s=i.fnQ.fail,a=i.fnQ.done;function r(e,t){for(;0<e.length;)i.prevFnRes=[e.shift().apply(i,i.prevFnRes)],N(i,i.prevFnRes[0],t)}i.isResolved?r(n,"then"):r(s,"fail"),r(a,"done")}else console.warn("Already this promise has been "+(i.isResolved?"Resolved.":"Rejected."))}function r(){a.call(i,!0,Array.prototype.slice.call(arguments))}function o(){a.call(i,!1,Array.prototype.slice.call(arguments))}var c={resolve:r,reject:o};setTimeout(function(){if(D(t)){var e=t.call(c,r,o);s&&setTimeout(function(){i.isPending&&a.call(i,!!e,[e])},H(e)?s:n||w)}else setTimeout(function(){i.isPending&&a.call(i,!!t,[t])},n||w)},w)}function y(e,t,n){var s=e;if("function"==typeof n){var a=!s.isPending;if("then"===t?a=a&&s.isResolved:"fail"===t&&(a=a&&s.isRejected),a){var r=n.apply(s,s.prevFnRes);Q(r)?s=r:s.prevFnRes=[r]}else s.fnQ[t].push(n)}return s}function T(e){return y(this,"fail",e)}function g(e){return y(this,"done",e)}function R(e){Object.defineProperty(this,"fnQ",{value:{then:[],fail:[],done:[]}}),this.requests=e,this.responses=[],this.length=e.length,this.isPending=e.length,this.isFailed=!1,this.failed=[],this.prevFnRes;var r=this;function t(e){for(var t,n=r.fnQ[e];0<n.length;)try{t=void 0===r.prevFnRes?[]:[r.prevFnRes],r.prevFnRes=n.shift().apply(r,t.concat(r.responses)),N(r,r.prevFnRes,e)}catch(e){console.error("Function Execution Error.",e)}}function i(){r.isPending--;try{r.isPending||(r.isFailed?t("fail"):t("then"),t("done"))}catch(e){console.error("Function Execution Error.",e)}}setTimeout(function(){e.forEach(function(e,t){if(Q(e)||d(e)&&(D(e.then)||D(e.fail)||D(e.catch))){"function"==typeof e.then&&e.then(function(){r.responses[t]=o(arguments),i()});var n="function"==typeof e.fail?"fail":"function"==typeof e.catch?"catch":"";n&&e[n](function(){r.responses[t]=o(arguments),r.isFailed=!0,r.failed.push(t),i()})}else if("function"==typeof e){var s=e.call(r,r.requests,r.responses,t),a=void 0!==s&&!s;r.responses[t]=s,r.isFailed=r.isFailed||a,a&&r.failed.push(t),i()}else r.responses[t]=e,r.isFailed=r.isFailed||!e,r.isFailed&&r.failed.push(t),i()})},w)}function F(e,t,n){var s,a=e;if("function"==typeof n){var r=!a.isPending;"then"===t?r=r&&!a.isFailed:"fail"===t&&(r=r&&a.isFailed),r?(s=void 0===a.prevFnRes?[]:[a.prevFnRes],a.prevFnRes=n.apply(a,s.concat(a.responses)),Q(a.prevFnRes)&&(a=a.prevFnRes)):a.fnQ[t].push(n)}return a}function O(e){return F(this,"fail",e)}function P(e){return F(this,"done",e)}function L(){var n,s,a=[],r={};if(arguments.length)for(var e=0;e<arguments.length;e++)Array.isArray(arguments[e])?a=a.concat(arguments[e]):a.push(arguments[e]);a.forEach(function(e,t){"string"==typeof e&&(/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i.test(e)?(n=e.split(":")[0],(s=e.replace(/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i,""))?e={url:s,method:n}:r.method=n):e={url:e},a[t]=e),"object"!=typeof e||e.url||(r=q(r,e))});var t=[];return a.forEach(function(e){C(e)&&e.url&&!Q(e)?t.push(B(q({},r,e))):Q(e)?t.push(e):t.push(function(e,t,n){return arguments.length?new v(e,t,n):new v(1,w)}(e))}),new R(t)}function M(e){Object.defineProperty(this,"fnQ",{value:{then:[],fail:[],done:[]}}),this.xhr=new XMLHttpRequest,this.reqOptions=e,this.isPending=!0,this.isSuccess=!1,this.isFailed=!1,this.response="",this.prevFnRes}function m(e,t,n){var s,a=e;if("function"==typeof n){var r=!a.isPending;"then"===t?r=r&&a.isSuccess:"fail"===t&&(r=r&&a.isFailed),r?(a.isFailed?(s=void 0===a.prevFnRes?a:a.prevFnRes,a.prevFnRes=n.call(a.reqOptions,s,a.statusText,a.statusMessage,a.response)):(s=void 0===a.prevFnRes?a.response:a.prevFnRes,a.prevFnRes=n.call(a.reqOptions,s,a.statusText,a,a.response)),Q(a.prevFnRes)&&(a=a.prevFnRes)):a.fnQ[t].push(n)}return a}function x(e){return m(this,"fail",e)}function E(e){return m(this,"done",e)}i=v,c={then:function(e){return y(this,"then",e)},else:T,fail:T,catch:T,done:g,always:g,finally:g},Object.keys(c).forEach(function(e){a(e)||(l?i.prototype[e]=c[e]:Object.defineProperty(i.prototype,e,{value:c[e]}))}),Object.defineProperties(R.prototype,{then:{value:function(e){return F(this,"then",e)}},fail:{value:O},catch:{value:O},done:{value:P},always:{value:P},finally:{value:P}}),Object.defineProperties(M.prototype,{then:{value:function(e){return m(this,"then",e)}},fail:{value:x},catch:{value:x},done:{value:E},always:{value:E},finally:{value:E}});var G={defaults:{dataType:"text",async:!0,cache:!1,method:"GET",headers:{},auth:null,timeout:0,success:null,error:null,finally:null},dataParsers:{css:function(e){var t=document.createTextNode(e),n=document.createElement("style");return n.setAttribute("id","css-"+(new Date).getTime()),n.setAttribute("type","text/css"),n.appendChild(t),document.head.appendChild(n),e},json:function(e){var t=e;try{t=JSON.parse(e)}catch(e){}return t},script:X,javascript:X},urls:{},url:z,setup:b,preFilter:I,get:function(){return s.unshift.call(arguments,"get"),B.apply(void 0,arguments)},post:function(){return s.unshift.call(arguments,"post"),B.apply(void 0,arguments)},put:function(){return s.unshift.call(arguments,"put"),B.apply(void 0,arguments)},del:function(){return s.unshift.call(arguments,"delete"),B.apply(void 0,arguments)},patch:function(){return s.unshift.call(arguments,"patch"),B.apply(void 0,arguments)},head:function(){return s.unshift.call(arguments,"head"),B.apply(void 0,arguments)},options:function(){return s.unshift.call(arguments,"options"),B.apply(void 0,arguments)}},j="url,setup,converters,preFilter,get,post,put,del,patch,head,options".split(",");function b(n){C(n)&&Object.keys(n).forEach(function(t){if(j.indexOf(t)<0)switch(t){case"dataParsers":case"urls":C(n[t])&&Object.keys(n[t]).forEach(function(e){G[t][e]=n[t][e]});break;default:G.defaults[t]=n[t]}})}function I(e){D(e)&&(G.defaults.preFilter=e)}function _(e,t){return S(e,t)?e[t]:G.defaults[t]}function X(e){if(e.trim()){var t=document.createElement("script");t.setAttribute("id","js-"+(new Date).getTime()),t.text=e,document.head.appendChild(t).parentNode.removeChild(t)}return e}var $={200:"OK",301:"Moved Permanently",400:"Bad Request",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",511:"Network Authentication Required"},J={text:"text/plain",html:"text/html",css:"text/css",style:"text/css",csv:"text/csv",xml:"text/xml",json:"application/json",pdf:"application/pdf",script:"application/javascript",spacomponent:"application/javascript",zip:"application/zip"};function z(e){var t="@"===String(e||"")[0];e=String(e||"").replace(/^[@\s]+/,"");var n,s,a=t?G.urls[e]||h(G.urls,e,e):e,r=o(arguments,1).map(function(e){return f(e,"object|array")?e:{}});return r=U.apply(null,r),Object.keys(r).length&&-1<a.indexOf("{")&&u(a,"{","}",!0).forEach(function(e){n=e.replace(/[{}<>]/g,""),s=h(r,n,r._undefined),a=a.replace(new RegExp(e.replace(/([^a-zA-Z0-9])/g,"\\$1"),"g"),s)}),a}function B(){if(!arguments.length)return L.apply(null,[]);if(2===arguments.length&&A(arguments[0])&&!/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)$/i.test(arguments[0])&&C(arguments[1])&&!S(arguments[1],"url")){var e=arguments[1];return e.url=arguments[0],B(e)}if(1<arguments.length||Array.isArray(arguments[0]))return L.apply(null,arguments);if(Q(arguments[0]))return arguments[0];var t=C(arguments[0])?arguments[0]:A(arguments[0])?{url:arguments[0]}:{},n={},s=[];t.skipDefaults?("string"==typeof(s=t.skipDefaults)?s=s.split(","):"boolean"==typeof s&&(s=["payload","headers"]),Array.isArray(s)&&s.length?(s=s.map(function(e){return(e=e.replace(/default/gi,"").trim())?"default"+e[0].toUpperCase()+e.slice(1):""}),Object.keys(G.defaults).forEach(function(e){s.indexOf(e)<0&&(n[e]=G.defaults[e])})):(s=[],n=q({},G.defaults))):n=q({},G.defaults),n.method=t.method||t.type||G.defaults.method;var a=q({},n,t);if(a.url){a.type=a.method=a.method.toUpperCase();var l=a.dataType.toLowerCase(),r=J[l]||(l&&l.indexOf("/")<-1?"text/"+a.dataType:a.dataType),i={},o=a.defaultHeaders;D(o)&&(o=o.call(a,a)),D(a.headers)&&(a.headers=a.headers.call(void 0,a)),C(a.headers)&&Object.keys(a.headers).forEach(function(e){i[e]=a.headers[e]}),C(o)&&(H(i)?i=o:C(i)&&(i=q(o,i))),!i.hasOwnProperty("Content-Type")&&r&&(i["Content-Type"]=r),i["X-Requested-With"]="XMLHttpRequest",i["Cache-Control"]=a.cache?"max-age=86400000":"no-cache, no-store, must-revalidate, max-age=0",i.Expires=a.cache?new Date((new Date).setDate((new Date).getDate()+1)).toUTCString():"0",a.cache||(i.Pragma="no-cache"),a.headers=i;var u,f,p,d,h=new M(a),c=h.xhr,v=h.reqOptions,y=h.fnQ;D(v.success)&&y.then.push(v.success),D(v.error)&&y.fail.push(v.error),D(v.finally)&&y.done.push(v.finally),Object.keys(v).forEach(function(t){var e=t.toLowerCase();"onreadystatechange"===e&&D(v[t])?d=v[t]:0===e.indexOf("on")&&D(v[t])&&(c[e]=function(e){v[t].call(c,e,h)})}),c.onreadystatechange=b;var T=v.defaultPayload;D(T)&&(T=T.call(v,v));var g=v.data;C(T)&&(H(g)?g=T:C(g)&&(g=U(T,g))),v.data=g;var R=_(v,"preFilter");R&&D(R)&&R.call(h,v,q({},v),h);var F=z(v.url,v.urlParams,v.data);/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i.test(F)&&(v.method=F.split(":")[0].toUpperCase(),F=F.replace(/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i,"")),v.url=F;var O=v.method=v.method.toUpperCase(),P=v.cache;if(g=v.data,!P){var m=(new Date).getTime();v.headers["X-T-"+m]=m,"GET"===O&&(F+=(F.indexOf("?")<0?"?":/\?$|&$/.test(F)?"":"&")+"_="+m)}"GET"===O&&g&&(g=k(g))&&(F+=(F.indexOf("?")<0?"?":/\?$|&$/.test(F)?"":"&")+g);try{v.auth&&C(v.auth)?v.auth.hasOwnProperty("user")&&(v.auth.hasOwnProperty("pwd")?c.open(O,F,v.async,v.auth.user,v.auth.pwd):c.open(O,F,v.async,v.auth.user)):c.open(O,F,v.async);var x=_(v,"beforeSend"),E=!0;if(x&&D(x))try{E=(E=x.call(c,c,v))||H(E),g=v.data}catch(e){E=!1,console.warn("beforeSend function failed.",e,h)}if(E){var j=v.headers;C(j)&&Object.keys(j).forEach(function(e){c.setRequestHeader(e,j[e])}),v.timeout&&(c.timeout=v.timeout,u=setTimeout(function(){f=!0,h.isPending&&0<c.readyState&&c.readyState<4&&c.abort()},v.timeout)),"GET"!==O&&g?(g=A(g)?g:JSON.stringify(g),v.async?setTimeout(function(){c.send(g)},w):c.send(g)):v.async?setTimeout(function(){c.send()},w):c.send()}else p=!0,c.abort(),b()}catch(e){console.warn("XHR-Exception",c,e)}return h}function b(e){var t=this,n=t.status;if(d&&d.call(v,t,e),p||4===t.readyState){h.isPending=!1,h.readyState=t.readyState,h.status=t.status,h.responseText=t.responseText,h.response=t.responseText;var s=t.responseText;if(200<=n&&n<300||304===n){var a,r;if(h.isSuccess=!0,h.statusText="success",h.statusMessage="OK",(a=S(v,"dataParser")?v.dataParser:G.dataParsers[l])&&D(a))try{r=a(s,l)}catch(e){console.warn("dataParsing failed.",s,h,e)}H(r)||(s=r);var i,o=_(v,"dataFilter");if(o&&D(o))try{i=o.call(h,s,l)}catch(e){console.warn("dataFilter failed.",s,h,e)}H(i)||(s=i),"json"===l&&(h.responseJSON=s)}else s=t.responseText,h.isFailed=!0,u&&f?(h.statusText="timeout",h.statusMessage="timeout",clearTimeout(u)):p?(h.statusText="canceled",h.statusMessage="canceled"):(h.statusText="error",h.statusMessage=$[n]||"Unknown Error");h.response=s,h.isSuccess?c("then"):h.isFailed&&c("fail"),c("done")}function c(e){for(var t,n=y[e];0<n.length;)try{h.isFailed?(t=void 0===h.prevFnRes?h:h.prevFnRes,h.prevFnRes=n.shift().call(v,t,h.statusText,h.statusMessage,h.response)):(t=void 0===h.prevFnRes?h.response:h.prevFnRes,h.prevFnRes=n.shift().call(v,t,h.statusText,h,h.response)),N(h,h.prevFnRes,e)}catch(e){console.error("Function Execution Error.",e)}}}console.error("XHR without URL.",arguments,a)}function K(){return L.apply(t,o(arguments))}e(B,G),e(K,{ajax:B,ajaxQ:L,when:L,defer:L,ajaxSetup:b,ajaxPrefilter:I}),t.spaXHR=K}(this);