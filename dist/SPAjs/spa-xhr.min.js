/*@license SPA.js (XHR) [MIT]*/
var spaXHR=function(t){var n=Object.prototype,r=Array.prototype,w=0;function o(e,t){return 1===arguments.length?r.slice.call(e):r.slice.call(e,t)}function s(e){return-1<c.indexOf(e)}function S(e,t){return n.hasOwnProperty.call(e,t)}var a,i,l,c="hasOwnProperty,prototype,__proto__".split(",");function e(t,n){return Object.keys(n).forEach(function(e){s(e)||Object.defineProperty(t,e,{value:n[e]})}),t}function u(e){return n.toString.call(e).slice(8,-1).toLowerCase()}function f(e,t){return 0<=(""+t).toLowerCase().indexOf(u(e))}function A(e){return f(e,"string")}function p(e){return f(e,"array")}function C(e){return f(e,"object")}function d(e){return"object"==typeof e||"function"==typeof e}function D(e){return f(e,"function")}function H(e){return f(e,"undefined")}function k(e){var t=(arguments.length?e:{})||{};if(arguments.length)for(var n,r=0;r<arguments.length;r++)if(C(n=arguments[r]))for(var a in n)!s(a)&&S(n,a)&&(t[a]=n[a]);else p(n)&&(t=h.call(null,t,n));return t}function q(){var e=(arguments.length?arguments[0]:{})||{};if(arguments.length)for(var t,n=0;n<arguments.length;n++)if(C(t=arguments[n]))for(var r in t)!s(r)&&S(t,r)&&(C(t[r])?e[r]=q(e[r],t[r]):p(t[r])?e[r]=h(e[r],t[r]):e[r]=t[r]);else p(t)&&(e=h.call(null,e,t));return e}function h(){var e=(arguments.length?arguments[0]:[])||[];if(arguments.length)for(var t,n=0;n<arguments.length;n++)if(p(t=arguments[n]))for(var r=0;r<t.length;r++)if(H(e[r]))e[r]=t[r];else switch(u(t[r])){case"object":e[r]=q(e[r],t[r]);break;case"array":e[r]=h(e[r],t[r]);break;case"undefined":break;default:e[r]=t[r]}return e}function v(e,t,n){if(1<arguments.length&&d(e)&&String(t)){var r=t.split("|").map(function(e){return e.trim()});t=r.shift();var a,s=r.join("|");if(0<=t.indexOf("*"))a=function(e,t){var n;if(d(e))if(S(e,t))n=e[t];else for(var r=Object.keys(e),a=0;H(n)&&a<r.length;)n=arguments.callee(e[r[a++]],t);return n}(e,t.replace(/\*/g,""));else{var i=0,o=(t||"").trim().replace(/]|\s+/g,"").replace(/(\[)|(\\)|(\/)/g,".").replace(/(\.+)/g,".").replace(/^[.]+|[.]+$/g,"").split(".");for(a=e;void 0!==a&&i<o.length;i++)a=d(a)?a[o[i]]:void 0}return H(a)?s?v(e,s,n):D(n)?n.call(e,e,t):n:a}return 3===arguments.length?D(n)?n.call(e,e,t):n:e}function Q(e){if(C(e)){var r,a,s,i=e;return S(e,"_payload_")||function e(t){var n=!0;if("object"==typeof t)for(var r=Object.keys(t),a=0;n&&a<r.length;a++)n="object"!=typeof t[r[a]]||p(t[r[a]])&&e(t[r[a]]);return n}(e)||(i={_payload_:e}),Object.keys(i).reduce(function(e,t,n){return r=0===n?"":"&",a=encodeURIComponent(t),s=p(i[t])?i[t].map(function(e){return o(e)}).join(","):o(i[t]),[e,r,a,"=",s].join("")},"")}return String(e);function o(e){return encodeURIComponent("object"==typeof e?JSON.stringify(e):e)}}function U(e){return e instanceof M||e instanceof O||e instanceof y||t.Promise&&e instanceof Promise||t.jqXHR&&e instanceof jqXHR||t.Thenable&&e instanceof Thenable||t.Deferred&&e instanceof Deferred}function N(e,t,n){var r=e.fnQ.then,a=e.fnQ.fail,s=e.fnQ.done,i={then:"then,fail,done",fail:"fail,done",done:"done"}[n];if(U(t)){if(-1<i.indexOf("then"))for(;0<r.length;)t.then(r.shift());else e.fnQ.then=[];if(-1<i.indexOf("fail"))for(;0<a.length;)t.catch(a.shift());else e.fnQ.fail=[];if(-1<i.indexOf("done"))for(;0<s.length;)t.finally(s.shift())}}function y(t,n,r){Object.defineProperty(this,"fnQ",{value:{then:[],fail:[],done:[]}}),this.isPending=!0,this.isResolved=!1,this.isRejected=!1,this.response,this.prevFnRes;var i=this;function a(e,t){if(i.isPending){i.isPending=!1,i.response=t,i.prevFnRes=t,i.isResolved=e,i.isRejected=!e;var n=i.fnQ.then,r=i.fnQ.fail,a=i.fnQ.done;function s(e,t){for(;0<e.length;)i.prevFnRes=[e.shift().apply(i,i.prevFnRes)],N(i,i.prevFnRes[0],t)}i.isResolved?s(n,"then"):s(r,"fail"),s(a,"done")}else console.warn("Already this promise has been "+(i.isResolved?"Resolved.":"Rejected."))}function s(){a.call(i,!0,Array.prototype.slice.call(arguments))}function o(){a.call(i,!1,Array.prototype.slice.call(arguments))}var l={resolve:s,reject:o};setTimeout(function(){if(D(t)){var e=t.call(l,s,o);r&&setTimeout(function(){i.isPending&&a.call(i,!!e,[e])},H(e)?r:n||w)}else setTimeout(function(){i.isPending&&a.call(i,!!t,[t])},n||w)},w)}function g(e,t,n){var r=e;if("function"==typeof n){var a=!r.isPending;if("then"===t?a=a&&r.isResolved:"fail"===t&&(a=a&&r.isRejected),a){var s=n.apply(r,r.prevFnRes);U(s)?r=s:r.prevFnRes=[s]}else r.fnQ[t].push(n)}return r}function T(e){return g(this,"fail",e)}function m(e){return g(this,"done",e)}function O(e){Object.defineProperty(this,"fnQ",{value:{then:[],fail:[],done:[]}}),this.requests=e,this.responses=[],this.length=e.length,this.isPending=e.length,this.isFailed=!1,this.failed=[],this.prevFnRes;var s=this;function t(e){for(var t,n=s.fnQ[e];0<n.length;)try{t=void 0===s.prevFnRes?[]:[s.prevFnRes],s.prevFnRes=n.shift().apply(s,t.concat(s.responses)),N(s,s.prevFnRes,e)}catch(e){console.error("Function Execution Error.",e)}}function i(){s.isPending--;try{s.isPending||(s.isFailed?t("fail"):t("then"),t("done"))}catch(e){console.error("Function Execution Error.",e)}}setTimeout(function(){e.forEach(function(e,t){if(U(e)||d(e)&&(D(e.then)||D(e.fail)||D(e.catch))){"function"==typeof e.then&&e.then(function(){s.responses[t]=o(arguments),i()});var n="function"==typeof e.fail?"fail":"function"==typeof e.catch?"catch":"";n&&e[n](function(){s.responses[t]=o(arguments),s.isFailed=!0,s.failed.push(t),i()})}else if("function"==typeof e){var r=e.call(s,s.requests,s.responses,t),a=void 0!==r&&!r;s.responses[t]=r,s.isFailed=s.isFailed||a,a&&s.failed.push(t),i()}else s.responses[t]=e,s.isFailed=s.isFailed||!e,s.isFailed&&s.failed.push(t),i()})},w)}function R(e,t,n){var r,a=e;if("function"==typeof n){var s=!a.isPending;"then"===t?s=s&&!a.isFailed:"fail"===t&&(s=s&&a.isFailed),s?(r=void 0===a.prevFnRes?[]:[a.prevFnRes],a.prevFnRes=n.apply(a,r.concat(a.responses)),U(a.prevFnRes)&&(a=a.prevFnRes)):a.fnQ[t].push(n)}return a}function P(e){return R(this,"fail",e)}function F(e){return R(this,"done",e)}function L(){var n,r,a=[],s={};if(arguments.length)for(var e=0;e<arguments.length;e++)Array.isArray(arguments[e])?a=a.concat(arguments[e]):a.push(arguments[e]);a.forEach(function(e,t){"string"==typeof e&&(/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i.test(e)?(n=e.split(":")[0],(r=e.replace(/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i,""))?e={url:r,method:n}:s.method=n):e={url:e},a[t]=e),"object"!=typeof e||e.url||(s=k(s,e))});var t=[];return a.forEach(function(e){C(e)&&e.url&&!U(e)?t.push(K(k({},s,e))):U(e)?t.push(e):t.push(function(e,t,n){return arguments.length?new y(e,t,n):new y(1,w)}(e))}),new O(t)}function M(e){Object.defineProperty(this,"fnQ",{value:{then:[],fail:[],done:[]}}),this.xhr=new XMLHttpRequest,this.reqOptions=e,this.isPending=!0,this.isSuccess=!1,this.isFailed=!1,this.response="",this.prevFnRes}function x(e,t,n){var r,a=e;if("function"==typeof n){var s=!a.isPending;"then"===t?s=s&&a.isSuccess:"fail"===t&&(s=s&&a.isFailed),s?(a.isFailed?(r=void 0===a.prevFnRes?a:a.prevFnRes,a.prevFnRes=n.call(a.reqOptions,r,a.statusText,a.statusMessage,a.response)):(r=void 0===a.prevFnRes?a.response:a.prevFnRes,a.prevFnRes=n.call(a.reqOptions,r,a.statusText,a,a.response)),U(a.prevFnRes)&&(a=a.prevFnRes)):a.fnQ[t].push(n)}return a}function E(e){return x(this,"fail",e)}function j(e){return x(this,"done",e)}a=y,i={then:function(e){return g(this,"then",e)},else:T,fail:T,catch:T,done:m,always:m,finally:m},Object.keys(i).forEach(function(e){s(e)||(l?a.prototype[e]=i[e]:Object.defineProperty(a.prototype,e,{value:i[e]}))}),Object.defineProperties(O.prototype,{then:{value:function(e){return R(this,"then",e)}},fail:{value:P},catch:{value:P},done:{value:F},always:{value:F},finally:{value:F}}),Object.defineProperties(M.prototype,{then:{value:function(e){return x(this,"then",e)}},fail:{value:E},catch:{value:E},done:{value:j},always:{value:j},finally:{value:j}});var G={defaults:{dataType:"text",async:!0,cache:!1,method:"GET",headers:{},auth:null,timeout:0,success:null,error:null,finally:null},dataParsers:{css:function(e){var t=document.createTextNode(e),n=document.createElement("style");return n.setAttribute("id","css-"+(new Date).getTime()),n.setAttribute("type","text/css"),n.appendChild(t),document.head.appendChild(n),e},json:function(e){var t=e;try{t=JSON.parse(e)}catch(e){}return t},script:$,javascript:$},urls:{},url:B,setup:_,preFilter:I,get:function(){return r.unshift.call(arguments,"get"),K.apply(void 0,arguments)},post:function(){return r.unshift.call(arguments,"post"),K.apply(void 0,arguments)},put:function(){return r.unshift.call(arguments,"put"),K.apply(void 0,arguments)},del:function(){return r.unshift.call(arguments,"delete"),K.apply(void 0,arguments)},patch:function(){return r.unshift.call(arguments,"patch"),K.apply(void 0,arguments)},head:function(){return r.unshift.call(arguments,"head"),K.apply(void 0,arguments)},options:function(){return r.unshift.call(arguments,"options"),K.apply(void 0,arguments)}},b="url,setup,converters,preFilter,get,post,put,del,patch,head,options".split(",");function _(n){C(n)&&Object.keys(n).forEach(function(t){if(b.indexOf(t)<0)switch(t){case"dataParsers":case"urls":C(n[t])&&Object.keys(n[t]).forEach(function(e){G[t][e]=n[t][e]});break;default:G.defaults[t]=n[t]}})}function I(e){D(e)&&(G.defaults.preFilter=e)}function X(e,t){return S(e,t)?e[t]:G.defaults[t]}function $(e){if(e.trim()){var t=document.createElement("script");t.setAttribute("id","js-"+(new Date).getTime()),t.text=e,document.head.appendChild(t).parentNode.removeChild(t)}return e}var J={200:"OK",301:"Moved Permanently",400:"Bad Request",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",511:"Network Authentication Required"},z={text:"text/plain",html:"text/html",css:"text/css",style:"text/css",csv:"text/csv",xml:"text/xml",json:"application/json",pdf:"application/pdf",script:"application/javascript",spacomponent:"application/javascript",zip:"application/zip"};function B(e){var t="@"===String(e||"")[0];e=String(e||"").replace(/^[@\s]+/,"");var n,r,a=t?G.urls[e]||v(G.urls,e,e):e,s=o(arguments,1).map(function(e){return f(e,"object|array")?e:{}});return s=q.apply(null,s),Object.keys(s).length&&-1<a.indexOf("{")&&function(e,t,n,r){var a=String(e).match(RegExp("\\"+t+"([^\\"+t+"\\"+n+"].*?)\\"+n,"g"))||[];if(!r&&a.length){var s=t.length,i=-1*n.length;a=a.map(function(e){return e.slice(s,i)})}return a}(a,"{","}",!0).filter(function(e,t,n){return n.indexOf(e)===t}).forEach(function(e){n=e.replace(/[{}<>]/g,""),r=v(s,n,s._undefined),a=a.replace(new RegExp(e.replace(/([^a-zA-Z0-9])/g,"\\$1"),"g"),r)}),a}function K(){if(!arguments.length)return L.apply(null,[]);if(2===arguments.length&&A(arguments[0])&&!/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)$/i.test(arguments[0])&&C(arguments[1])&&!S(arguments[1],"url")){var e=arguments[1];return e.url=arguments[0],K(e)}if(1<arguments.length||Array.isArray(arguments[0]))return L.apply(null,arguments);if(U(arguments[0]))return arguments[0];var t=C(arguments[0])?arguments[0]:A(arguments[0])?{url:arguments[0]}:{},n={},r=[];t.skipDefaults?("string"==typeof(r=t.skipDefaults)?r=r.split(","):"boolean"==typeof r&&(r=["payload","headers"]),Array.isArray(r)&&r.length?(r=r.map(function(e){return(e=e.replace(/default/gi,"").trim())?"default"+e[0].toUpperCase()+e.slice(1):""}),Object.keys(G.defaults).forEach(function(e){r.indexOf(e)<0&&(n[e]=G.defaults[e])})):(r=[],n=k({},G.defaults))):n=k({},G.defaults),n.method=t.method||t.type||G.defaults.method;var a=k({},n,t);if(a.url){a.type=a.method=a.method.toUpperCase();var c=a.dataType.toLowerCase(),s=z[c]||(c&&c.indexOf("/")<-1?"text/"+a.dataType:a.dataType),i={},o=a.defaultHeaders;D(o)&&(o=o.call(a,a)),D(a.headers)&&(a.headers=a.headers.call(void 0,a)),C(a.headers)&&Object.keys(a.headers).forEach(function(e){i[e]=a.headers[e]}),C(o)&&(H(i)?i=o:C(i)&&(i=k(o,i))),!i.hasOwnProperty("Content-Type")&&s&&(i["Content-Type"]=s),i["X-Requested-With"]="XMLHttpRequest",i["Cache-Control"]=a.cache?"max-age=86400000":"no-cache, no-store, must-revalidate, max-age=0",i.Expires=a.cache?new Date((new Date).setDate((new Date).getDate()+1)).toUTCString():"0",a.cache||(i.Pragma="no-cache"),a.headers=i;var u,f,p,d,h=new M(a),l=h.xhr,v=h.reqOptions,y=h.fnQ;D(v.success)&&y.then.push(v.success),D(v.error)&&y.fail.push(v.error),D(v.finally)&&y.done.push(v.finally),Object.keys(v).forEach(function(t){var e=t.toLowerCase();"onreadystatechange"===e&&D(v[t])?d=v[t]:0===e.indexOf("on")&&D(v[t])&&(l[e]=function(e){v[t].call(l,e,h)})}),l.onreadystatechange=b;var g=v.defaultPayload;D(g)&&(g=g.call(v,v));var T=v.data;C(g)&&(H(T)?T=g:C(T)&&(T=q(g,T))),v.data=T;var m=X(v,"preFilter");m&&D(m)&&m.call(h,v,k({},v),h);var O=B(v.url,v.urlParams,v.data);/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i.test(O)&&(v.method=O.split(":")[0].toUpperCase(),O=O.replace(/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i,"")),v.url=O;var R=v.method=v.method.toUpperCase(),P=v.cache;if(T=v.data,!P){var F=(new Date).getTime();v.headers["X-T-"+F]=F,"GET"===R&&(O+=(O.indexOf("?")<0?"?":/\?$|&$/.test(O)?"":"&")+"_="+F)}"GET"===R&&T&&(T=Q(T))&&(O+=(O.indexOf("?")<0?"?":/\?$|&$/.test(O)?"":"&")+T);try{v.auth&&C(v.auth)?v.auth.hasOwnProperty("user")&&(v.auth.hasOwnProperty("pwd")?l.open(R,O,v.async,v.auth.user,v.auth.pwd):l.open(R,O,v.async,v.auth.user)):l.open(R,O,v.async);var x=X(v,"beforeSend"),E=!0;if(x&&D(x))try{E=(E=x.call(l,l,v))||H(E),T=v.data}catch(e){E=!1,console.warn("beforeSend function failed.",e,h)}if(E){var j=v.headers;C(j)&&Object.keys(j).forEach(function(e){l.setRequestHeader(e,j[e])}),v.timeout&&(l.timeout=v.timeout,u=setTimeout(function(){f=!0,h.isPending&&0<l.readyState&&l.readyState<4&&l.abort()},v.timeout)),"GET"!==R&&T?(T=A(T)?T:JSON.stringify(T),v.async?setTimeout(function(){l.send(T)},w):l.send(T)):v.async?setTimeout(function(){l.send()},w):l.send()}else p=!0,l.abort(),b()}catch(e){console.warn("XHR-Exception",l,e)}return h}function b(e){var t=this,n=t.status;if(d&&d.call(v,t,e),p||4===t.readyState){h.isPending=!1,h.readyState=t.readyState,h.status=t.status,h.responseText=t.responseText,h.response=t.responseText;var r=t.responseText;if(200<=n&&n<300||304===n){var a,s;if(h.isSuccess=!0,h.statusText="success",h.statusMessage="OK",(a=S(v,"dataParser")?v.dataParser:G.dataParsers[c])&&D(a))try{s=a(r,c)}catch(e){console.warn("dataParsing failed.",r,h,e)}H(s)||(r=s);var i,o=X(v,"dataFilter");if(o&&D(o))try{i=o.call(h,r,c)}catch(e){console.warn("dataFilter failed.",r,h,e)}H(i)||(r=i),"json"===c&&(h.responseJSON=r)}else r=t.responseText,h.isFailed=!0,u&&f?(h.statusText="timeout",h.statusMessage="timeout",clearTimeout(u)):p?(h.statusText="canceled",h.statusMessage="canceled"):(h.statusText="error",h.statusMessage=J[n]||"Unknown Error");h.response=r,h.isSuccess?l("then"):h.isFailed&&l("fail"),l("done")}function l(e){for(var t,n=y[e];0<n.length;)try{h.isFailed?(t=void 0===h.prevFnRes?h:h.prevFnRes,h.prevFnRes=n.shift().call(v,t,h.statusText,h.statusMessage,h.response)):(t=void 0===h.prevFnRes?h.response:h.prevFnRes,h.prevFnRes=n.shift().call(v,t,h.statusText,h,h.response)),N(h,h.prevFnRes,e)}catch(e){console.error("Function Execution Error.",e)}}}console.error("XHR without URL.",arguments,a)}function V(){return L.apply(t,o(arguments))}return e(K,G),e(V,{ajax:K,ajaxQ:L,when:L,defer:L,ajaxSetup:_,ajaxPrefilter:I}),V}(this);