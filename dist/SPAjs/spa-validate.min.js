/*@license SPA.js (Form Validation Extension) [MIT]*/
!function(a){var E=a.jQuery;spa.usejQuery&&E||(E=dom),spa._validateDefaults={required:"Required",digits:"Digits",numbers:"Numbers",integer:"Integer",alphabet:"Alpha",alphanumeric:"AlphaNumeric",pattern:"PatternMatch",range:"ValueRange",fixedlength:"Lengths",minlength:"LengthMin",maxlength:"LengthMax",email:"Email",url:"Url",date:"Date",cardno:"CardNo",ipv4:"IPv4",ipv6:"IPv6",ipaddress:"IP",subnetmask:"Subnet",phoneUS:"PhoneUS",wordsize:"WordSize",compare:"Compare",promise:"Promise",xss:"CheckXSS",noop:"Noop"},spa._validate={defaults:{offline:!0},_isOnOfflineValidation:!1,_validateAlertTemplate:'<div class="errortxt error-txt break-txt" data-i18n=""></div>',_offlineValidationRules:{},_fn:{Noop:function _fnNoop(){return!0},CheckXSS:function _fnCheckXSS(a){a=spa.getElValue(a);return!(/<\s*\/?\s*(\bscript\b)/gi.test(a)||/\s*on([a-z])+\s*=|javascript:/gi.test(a))},Promise:function _fnPromise(a){var e;return spa._validate._isOnOfflineValidation||(a=(e=E(a)).data("validate")||"",/(promise)(\s)*:(\s)*(\'|\")/.test(a)&&spa._validate._addValidationClass(e,"validation-pending")),!0},Required:function _fnRequired(a){a=spa.getElValue(a);return!spa.isBlank(a)},Digits:function _fnValidDigits(a){a=E(a).val();return 0===a.length||/^\d+$/.test(a)},Numbers:function _fnValidNumbers(a){a=E(a).val();return 0===a.length||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a)},Integer:function _fnValidInteger(a){a=E(a).val();return 0===a.length||/^-?\d+$/.test(a)},Alpha:function _fnValidAlpha(a){a=E(a).val();return 0===a.length||!/[^a-z]/gi.test(a)},AlphaNumeric:function _fnValidAlphaNumeric(a){a=E(a).val();return 0===a.length||!/[^a-z0-9]/gi.test(a)},PatternMatch:function _fnValidPatternMatch(a){var e=E(a).val(),t=0===e.length;return t||(t=new RegExp(E(a).data("validatePattern"),E(a).data("validatePatternOptions").replace(/!/g,"")).test(e),0<=E(a).data("validatePatternOptions").indexOf("!")&&(t=!t)),t},ValueRange:function _fnValidValueRange(a){var e,t,n,i=E(a).val(),s=0===i.length;return s||(s=!1,/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(i)&&(e=spa.toFloat(i),n=(" "+(E(a).data("validateRange")||"")+": ").split(":"),t=!spa.isBlank(n[0]),i=!spa.isBlank(n[1]),a=spa.toFloat(n[0]),n=spa.toFloat(n[1]),t&&i?s=a<=e&&e<=n:t?s=a<=e:i&&(s=e<=n))),s},LengthMin:function _fnValidLengthMin(a){var e=E(a).val(),a=spa.toInt(E(a).data("minlength")||E(a).data("minLength")||E(a).attr("minlength"));return e.length>=a},LengthMax:function _fnValidLengthMax(a){var e=E(a).val(),a=spa.toInt(E(a).data("maxlength")||E(a).data("maxLength"));return e.length<=a},Lengths:function _fnValidLengths(a){var e,t=E(a).val().length;return a.hasAttribute("data-fixed-length")||a.hasAttribute("data-fixedlength")?t==+(a.getAttribute("data-fixed-length")||a.getAttribute("data-fixedlength")):(e=spa.toInt(E(a).data("minlength")||E(a).data("minLength")||E(a).attr("minlength")),a=spa.toInt(E(a).data("maxlength")||E(a).data("maxLength")),e<=t&&t<=a)},WordSize:function _fnValidWordSize(a){var e=(""+E(a).val()).replace(/[-\n]/g," ").split(" ").map(function(a){return a.length});return(spa.isBlank(e)?0:Math.max.apply(null,e))<=(spa.toInt(E(a).data("validWordSize"))||20)},Email:function _fnValidEmail(a){a=E(a).val();return 0===a.length||(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)||/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/i.test(a))&&/[a-z0-9]/i.test(a[a.length-1])&&1==((a||"").match(/@/g)||[]).length},Url:function _fnValidUrl(a){a=E(a).val();return 0===a.length||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},Date:function _isValidDate(a){var e=E(a).val();if(!(r=0===e.length)){r=!1;var t,n,i,s=E(a).data("validateFormat")||"YMD",l="^\\d{1,2}[\\/\\-\\.]\\d{1,2}[\\/\\-\\.]\\d{4}$",o=e.replace(/[^a-z]/gi,"");o&&((a=["","JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"].indexOf(o.toUpperCase()))<=0&&(a=["","JANUARY","FEBRUARY","MARCH","APRIL","MAY","JUNE","JULY","AUGUST","SEPTEMBER","OCTOBER","NOVEMBER","DECEMBER"].indexOf(o.toUpperCase())),0<a&&(e=e.replace(new RegExp(o,"gi"),a)));var r,d=(e=e.replace(/[^0-9]/g," ").normalizeStr().replace(/ /g,"/")).split("/");switch(s.toUpperCase()){case"YMD":l="^\\d{4}[\\/\\-\\.]\\d{1,2}[\\/\\-\\.]\\d{1,2}$",t=d[0],n=d[1],i=d[2];break;case"MDY":n=d[0],i=d[1],t=d[2];break;case"DMY":i=d[0],n=d[1],t=d[2]}new RegExp(l,"").test(e)&&(i=parseInt(i,10),n=parseInt(n,10),t=parseInt(t,10),r=(e=new Date(t,n-1,i)).getFullYear()===t&&e.getMonth()===n-1&&e.getDate()===i)}return r},CardNo:function _fnValidCardNo(a){var e=E(a).val(),t=0===e.length;if(!t){var n=!/[^0-9 \-]+/.test(e),i=e.replace(/[^0-9]/g,""),a=i.length;if(n&&a&&0<"0345".indexOf(i[0])&&(15==a||16==a)){for(var s=0,l=0,o=!1,r=e.replace(/\D/g,""),d=r.length-1;0<=d;d--){var u=r.charAt(d),l=parseInt(u,10);o&&9<(l*=2)&&(l-=9),s+=l,o=!o}t=s%10==0}}return t},IPv4:function _fnValidIpv4(a){a=E(a).val();return 0===a.length||/^(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)$/i.test(a)&&spa.every(a.split("."),function(a){return!(1<a.length)||!a.beginsWithStr("0")})},IPv6:function _fnValidIpv6(a){a=E(a).val();return 0===a.length||/^((([0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}:[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){5}:([0-9A-Fa-f]{1,4}:)?[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){4}:([0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){3}:([0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){2}:([0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(([0-9A-Fa-f]{1,4}:){0,5}:((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(::([0-9A-Fa-f]{1,4}:){0,5}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|([0-9A-Fa-f]{1,4}::([0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})|(::([0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){1,7}:))$/i.test(a)},IP:function _fnValidIpAddress(a,e){var t,n,i=E(a).val(),s=0===i.length;return s||(t=i,n=spa.toInt(E(a).data("validateIpaddressOctates")||4)-1,s=new RegExp("^(([01]?[0-9]?[0-9]|2([0-4][0-9]|5[0-5]))\\.){"+n+"}([01]?[0-9]?[0-9]|2([0-4][0-9]|5[0-5]))$","g").test(t)&&spa.every(t.split("."),function(a){return!(1<a.length)||!a.beginsWithStr("0")}),spa._validate._showValidateMsg(a,e,s),i=E(a).data("validateIpaddressClass"),s&&i&&(n={A:{oct1:{B:0,E:127},oct2:{B:0,E:256},oct3:{B:0,E:256},oct4:{B:1,E:255}},B:{oct1:{B:127,E:192},oct2:{B:1,E:256},oct3:{B:0,E:256},oct4:{B:0,E:255}},C:{oct1:{B:191,E:224},oct2:{B:0,E:256},oct3:{B:1,E:256},oct4:{B:1,E:255}},D:{oct1:{B:223,E:240},oct2:{B:0,E:256},oct3:{B:0,E:256},oct4:{B:0,E:256}},E:{oct1:{B:239,E:255},oct2:{B:0,E:256},oct3:{B:0,E:256},oct4:{B:0,E:255}}},s=+(t=t.split("."))[0]>n[i].oct1.B&&+t[0]<n[i].oct1.E&&(+t[1]>=n[i].oct2.B&&+t[1]<n[i].oct2.E&&(+t[2]>=n[i].oct3.B&&+t[2]<n[i].oct3.E&&(+t[3]>n[i].oct4.B&&+t[3]<n[i].oct4.E))),spa._validate._showValidateMsg(a,e,s))),s},Subnet:function _fnValidSubnet(a){var e=E(a).val(),a=0===e.length;return a=a||new RegExp("^((128|192|224|240|248|252|254)\\.0\\.0\\.0)|(255\\.(((0|128|192|224|240|248|252|254)\\.0\\.0)|(255\\.(((0|128|192|224|240|248|252|254)\\.0)|255\\.(0|128|192|224|240|248|252|254)))))$").test(e)&&spa.every(e.split("."),function(a){return!(1<a.length)||!a.beginsWithStr("0")})},PhoneUS:function _fnValidPhoneUS(a){a=E(a).val();return 0===a.length||9<a.length&&a.match(/^(\+?1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)},Compare:function _fnValidCompare(a){var e=0===E(a).val().length;if(!e){var t,n=E(a).data(),i=spa.toJSON(n.validateCompare||"{}");if(!spa.isBlank(i)&&i.target){t=E(i.target);var n=i.valid||"=",s=spa.getElValue(a),l=spa.getElValue(t);if(("number".equalsIgnoreCase(i.type)||0<=n.indexOf("<")||0<=n.indexOf(">"))&&(s=spa.toFloat(s),l=spa.toFloat(l)),!"date".equalsIgnoreCase(i.type))switch(n){case"!=":e=s!=l;break;case"!==":e=s!==l;break;case"===":e=s===l;break;case">":e=l<s;break;case"<":e=s<l;break;case">=":e=l<=s;break;case"<=":e=s<=l;break;default:e=s==l}}}return e}},_showValidateMsg:function __showValidateMsg(a,e,t,n,i){e=e||"";var s=E(a);if(s.length){2<arguments.length&&spa.isString(t)&&(n=t),2<arguments.length&&spa.isBoolean(t)&&t&&(e="");var l=!(n=n||spa._validate._validateAlertTemplate).beginsWithStrIgnoreCase("<"),o=s.parent(),r=s.data("errorClassTarget"),d=r?s.closest(r):o,u=s.data("errorPosition");a=s[0],spa._validate._isOnOfflineValidation||(d.removeClass("has-error-msg no-error-msg")[!1===t?"addClass":"removeClass"]("validation-error "+(e?"has-error-msg":"no-error-msg")),s[!1===t?"addClass":"removeClass"]("invalid-data"),i||spa.updateTrackFormCtrls(a.form));var p=l?E(n):s.next();!l&&u&&("first".equalsIgnoreCase(u)?p=o.children().first():"last".equalsIgnoreCase(u)&&(p=o.children().last()));var F,f="",r="";return E(p).attr("class")===E(n).attr("class")||l?(e.beginsWithStrIgnoreCase("i18n:")&&(spa.console.group("i18n-Msg"),spa.console.log("msg:",e),F=(e.getLeftStr("|")||e).replace(/i18n:/gi,""),r=e.getRightStr("|"),f="{html:'"+F+"'}",d=spa.toJSON(r),d=spa.isObject(d)?d:{},spa.console.log("i18nData@msg:",d),l=s.dataJSON("i18nData"),spa.isBlank(l)||(spa.console.log("i18nData@el",l),d=spa.merge(d,l),spa.console.log("i18nData:",d)),e=spa.i18n.text(F,d),spa.console.groupEnd("i18n-Msg")),spa._validate._isOnOfflineValidation||(E(p).attr("data-i18n",f).data("i18n",f),E(p).attr("data-i18n-data",r).data("i18nData",r),E(p).html(e))):spa.isBlank(e)||(u?"first".equalsIgnoreCase(u)?E(n).prependTo(o):"last".equalsIgnoreCase(u)?E(n).appendTo(o):E(n).insertAfter(s):E(n).insertAfter(s),spa._validate._showValidateMsg(a,e,t,n)),t}spa.console.warn("Validation config/setup is wrong for validation Msg:["+e+"] forEl:",a)},_getValidationClassTarget:function(a){var e=E(a),a=e.data("errorClassTarget");return a?e.closest(a):e.parent()},_addValidationClass:function(a,e){spa._validate._getValidationClassTarget(a).addClass(e)},_removeValidationClass:function(a,e){spa._validate._getValidationClassTarget(a).removeClass(e)},_deferValidate:function(){return!0},_registerPromise:function(a,e,t,n){var i,s=!spa.isBlank(a);return!s||(e=(i=E(e)).data("promises")||"").indexOf("["+a+"]")<0&&(spa.console.log("validating promise: "+a),e+="["+a+"]",i.attr("data-promises",e).data("promises",e),spa._validate._addValidationClass(i,"validation-pending"),spa.isFunction(t)&&t.call(i,i,n,a)),s},expose:function(e){return e=e||{},spa.keys(spa._validateDefaults).forEach(function(a){e[a]=spa._validate._fn[spa._validateDefaults[a]]}),e}},spa.initValidation=spa.initDataValidation=function(a){spa.console.group("initValidation"),spa.console.log(">>>>> initDataValidation request for context:"+a);function bc(t){return t=t||{},spa.each(spa.keys(t),function(e){0==e.indexOf("on")&&0<e.indexOf("_")&&(spa.each(e.split("_"),function(a){a.indexOf("on")<0&&(a="on"+a),t[a]?spa.isArray(t[a])?t[a].push(t[e]):t[a]=[t[a],t[e]]:t[a]=[t[e]]}),delete t[e])}),t}var e=E(a=a||"body"),t=e.data("validateElFilter")||"";spa.console.log("$context",e),spa.console.log("data-validate-common",e.data("validateCommon"));var c=bc(spa.toJSON(e.data("validateCommon")||"{}")),n=spa.merge({},c.onFocus),g=!!spa.toJSON(e.attr("data-validate-defaults")||{}).offline;spa.console.log("commonValidateRules");var v,h,_,m,i={fn:"_check.promise",offline:!1};spa.isBlank(n)?c.onFocus=i:(spa.isArray(n)||(n=[n]),n.push(i)),c.onFocus=n,spa.console.log("commonValidateRules",c);var A=(e.data("validateForm")||e.data("validateScope")||"").replace(/onRender/i,"").replace(/[^a-zA-Z0-9]/g,"");spa.isBlank(A)&&(A=a.replace(/[^a-zA-Z0-9]/g,"")),spa.console.log("offlineValidationKey: "+A);var D=!spa.isBlank(A);D&&(spa.console.log("resetting the rules for "+A),spa._validate._offlineValidationRules[A]={rules:{}}),spa.console.log(A,spa._validate._offlineValidationRules[A]),e.find(t+"[data-validate]").each(function(a,e){var i=e.getAttribute("id");i||(i=(e.name||e.type).replace(/[^a-z]/gi,"")+a,e.setAttribute("id",i));var t,r={},n=E(e).data("validate");n&&n.indexOf("{")<0&&(t=(E(e).data("validateEvents")||"onBlur").replace(/[^a-z]/gi," ").normalizeStr().replace(/ /g,"_"),a=",offline:"+(E(e).data("validateOffline")||g||"false"),n="{"+t+":["+("{fn:"+n.replace(/[,;]/," ").normalizeStr().replace(/ /g,a+"},{fn:")+a+"}")+"]}"),r=bc(spa.toJSON(n));var s,l,o={},d="",u=e.attributes;if(u&&u.length){for(var p=u.length;0<=p;p--)if(d=u[p]?u[p].name:"",d&&/^data-validate-on/i.test(d)&&(s="."+function _formatEventName(a){return/^on/i.test(a)&&(a=(a=a.toLowerCase()).substring(0,2)+a[2].toUpperCase()+a.substring(3)),a}(d.replace(/data-validate-/i,"")),l=spa.toJSON(e.getAttribute(d)),!spa.isBlank(l)))if(Array.isArray(l))for(var F=0,f=l.length;F<f;F++)spa.setObjProperty(o,s,l[F]);else spa.setObjProperty(o,s,l);spa.isBlank(o)||(o=bc(o),Object.keys(o).forEach(function(a){spa.setObjProperty(r,"."+a,o[a])}))}spa.console.log(n),spa.each(spa.keys(c),function(n){var a=c[n];spa.isArray(a)||(a=[a]),a.reverse(),spa.console.group("vRules #"+i),spa.each(a,function(a){var e,t;m=!0,v="<",_=a.offline||!1,h=!1,a.el?(e=a.el.replace(/ /g,"").split(","),t=a.el.replace(/[< >!]/g,"").split(",").indexOf(i),(m=0<=t)&&(v=0<=e[t].indexOf(">")?">":"<",h=0<=e[t].indexOf("!"))):a.ex&&(m=a.ex.replace(/[< >!]/g,"").split(",").indexOf(i)<0),m&&(m=spa.omit(a,["el","ex"]),spa.console.log(">>commonRule2El:",m,a),h&&(m.offline=!_),r[n]||(r[n]=[]),spa.console.group("-"+n),"<"===v?(spa.console.log(v+"all:",[m],r[n]),r[n]=spa.union([m],r[n])):(spa.console.log(v+"all:",r[n],[m]),r[n]=spa.union(r[n],[m])),spa.console.log("uniq:",r[n]),spa.console.groupEnd("-"+n))}),spa.console.group("-FinalRules"),spa.console.log(r),spa.console.groupEnd("-All"),spa.console.groupEnd("vRules #"+i)}),spa.each(spa.keys(r),function(o){var a=o.substring(2,3).toLowerCase()+o.substring(3);spa.console.log("settingup event on["+a+"]..."),spa.isArray(r[o])||(r[o]=[r[o]]),spa.console.log(r),D&&spa.each(r[o],function(a){spa.isArray(a)||(a=[a]),spa.each(a,function(a){a.hasOwnProperty("offline")||(a.offline=g),spa.console.log(a),a.offline&&!a.promise&&(a={fn:a.fn,msg:a.msg},spa._validate._offlineValidationRules[A].rules[i]||(spa._validate._offlineValidationRules[A].rules[i]=[]),spa.indexOf(spa._validate._offlineValidationRules[A].rules[i],a)<0&&spa._validate._offlineValidationRules[A].rules[i].push(a))})}),spa.console.log("registering an event: "+o),o.beginsWithStrIgnoreCase("on")&&!"test".equalsIgnoreCase(a)&&E(e).on(a,function(){var e,t,n,i=this,a=E(i),s=i&&i.hasAttribute("data-validate-pause")&&spa.toBoolean(i.getAttribute("data-validate-pause")+""||"true"),l=i&&i.hasAttribute("data-ignore-validation-if-invisible")&&spa.toBoolean(i.getAttribute("data-ignore-validation-if-invisible")+""||"true");s||l&&!a.is(":visible")||spa.every(r[o],function(a){return spa.isArray(a)?spa.every(a,function(a){return e=a.fn,spa.isString(e)&&(e=spa.findSafe(window,e)),spa.isFunction(e)||console.error("data-validate-function Not Found: "+a.fn),t=a.msg||E(i).data("validateMsg")||"",spa._validate._registerPromise(a.promise,i,e,t)&&(e=spa._validate._deferValidate),n=!!spa.isFunction(e)&&e.call(i,i,t),spa.isBoolean(n)&&spa._validate._showValidateMsg(i,t,n),n}):(e=a.fn,spa.isString(e)&&(e=spa.findSafe(window,e)),spa.isFunction(e)||console.error("data-validate-function Not Found: "+a.fn),t=a.msg||E(i).data("validateMsg")||"",spa._validate._registerPromise(a.promise,i,e,t)&&(e=spa._validate._deferValidate),n=!!spa.isFunction(e)&&e.call(i,i,t),spa.isBoolean(n)&&spa._validate._showValidateMsg(i,t,n),n)})})})}),spa.console.groupEnd("initValidation")},spa.validateForm=spa.validate=spa.doDataValidation=function(a,e,s){var t;spa.isString(arguments[1])&&(t="#"+arguments[1].replace(/[ #]/g,"").replace(/,/g,",#")+",",e=arguments[2],s=arguments[3]);var l,n,i=a.replace(/[^a-zA-Z0-9]/g,""),o="#"+a.replace(/#/g,""),r=E(o),d=[];return spa._validate._offlineValidationRules[i]?(l=spa._validate._offlineValidationRules[i].rules,spa.console.log("vRules:",l),spa.isEmptyObject(l)?(i=1,n="Offline rules not found in scope ["+a+"].",r.find(".validation-error,.validation-pending").length&&(i=3,n+=" Found .validation-error|.validation-pending"),d=[{errcode:i,errmsg:n}]):(n=spa.keys(l),t&&(n=n.map(function(a){return 0<=t.indexOf("#"+a+",")?a:""})),spa._validate._isOnOfflineValidation=!e,spa.every(n,function(a){return!a||(a=a,n=r.find("#"+a),(i=n[0])&&i.hasAttribute("data-validate-pause")&&spa.toBoolean(i.getAttribute("data-validate-pause")+""||"true")||spa.toBoolean(n.data("ignoreValidationIfInvisible"))&&!n.is(":visible")||spa.every(l[a],function(a){return t=a.fn,spa.isString(t)&&(t=spa.findSafe(window,t)),spa.isFunction(t)||console.error("data-validate-function Not Found: "+a.fn),e=a.msg||n.data("validateMsg")||"",t=!!spa.isFunction(t)&&t.call(i,i,e),spa.isBoolean(t)&&spa._validate._showValidateMsg(n,e,t,"",!0),t||(a={errcode:2,el:i,fn:a.fn,msg:e},d.push(a)),t})||s);var e,t,n,i}),spa._validate._isOnOfflineValidation=!1)):r.length?r.is("[data-validate-form]")&&(d=[{errcode:1,errmsg:"Form Not Initialized."}]):d=[{errcode:1,errmsg:"Form Not Found."}],d},spa.pauseValidation=function(a,e){var t=void 0===e||e;E(a).each(function(a,e){t?e.setAttribute("data-validate-pause",t):e.removeAttribute("data-validate-pause")})},spa.clearValidation=spa.removeValidationMsg=function(a){a&&E(a).each(function(a,e){spa._validate._showValidateMsg(e,"",!0)})},spa.updateValidation=function(a,t,n,i){2==arguments.length&&(n=spa.isBlank(t)),E(a).each(function(a,e){spa._validate._showValidateMsg(e,t,n,i)})},spa.updateValidationPromise=function(t,a,n,i,s){var l,o;E(a).each(function(a,e){l=E(e),spa.each(t.split(","),function(a){o=(l.data("promises")||"").replace("["+a.trim()+"]",""),l.attr("data-promises",o).data("promises",o),spa.isBlank(o)&&spa._validate._removeValidationClass(l,"validation-pending")}),spa._validate._showValidateMsg(e,n,i,s)})},a._clearSpaValidateMsg=function _clearSpaValidateMsg(a){return spa._validate._showValidateMsg(a),!0},a._check=spa._validate.expose()}(this);