/*@license SPA.js (XHR/ajax) [MIT]*/
!function(t){var r=Object.prototype,n=Array.prototype,F=0;function _argsToArr(e,t){return 1===arguments.length?n.slice.call(e):n.slice.call(e,t)}function _isReservedKey(e){return-1<s.indexOf(e)}function _hasOwnProp(e,t){return r.hasOwnProperty.call(e,t)}var s="hasOwnProperty,prototype,__proto__".split(",");function _fnProps(t,r){return Object.keys(r).forEach(function(e){_isReservedKey(e)||Object.defineProperty(t,e,{value:r[e]})}),t}function _clearTimer(e){e&&(Array.isArray(e)?e:[e]).forEach(function(e){e&&clearTimeout(e)})}var a=spa.extractStrBetweenIn,i=spa.is,T=spa.isString,o=spa.isArray,x=spa.isObject,l=spa.isObjectLike,O=spa.isFunction,E=spa.isUndefined,w=spa.extend,S=spa.merge,c=spa.find,j=spa.sanitizeXSS;function _toQueryString(e){if(x(e)){var n,s,a,i=e;return _hasOwnProp(e,"_payload_")||function _isSimple(e){var t=!0;if("object"==typeof e)for(var r=Object.keys(e),n=0;t&&n<r.length;n++)t="object"!=typeof e[r[n]]||o(e[r[n]])&&_isSimple(e[r[n]]);return t}(e)||(i={_payload_:e}),Object.keys(i).reduce(function(e,t,r){return n=0===r?"":"&",s=encodeURIComponent(t),a=o(i[t])?i[t].map(_toQryParamValue).join(","):_toQryParamValue(i[t]),[e,n,s,"=",a].join("")},"")}return String(e);function _toQryParamValue(e){return encodeURIComponent("object"==typeof e?JSON.stringify(e):e)}}function _isDeferred(e){return e instanceof XHR||e instanceof XHRQ||e instanceof SimplePromise||t.Promise&&e instanceof Promise||t.jqXHR&&e instanceof jqXHR||t.Thenable&&e instanceof Thenable||t.Deferred&&e instanceof Deferred}function _shiftFnsToNxtPromise(e,t,r){var n=e.fnQ.then,s=e.fnQ.fail,a=e.fnQ.done,r={then:"then,fail,done",fail:"fail,done",done:"done"}[r];if(_isDeferred(t)){if(-1<r.indexOf("then"))for(;0<n.length;)t.then(n.shift());else e.fnQ.then=[];if(-1<r.indexOf("fail"))for(;0<s.length;)t.catch(s.shift());else e.fnQ.fail=[];if(-1<r.indexOf("done"))for(;0<a.length;)t.finally(a.shift())}}function SimplePromise(t,r,n){Object.defineProperty(this,"fnQ",{value:{then:[],fail:[],done:[]}}),this.isPending=!0,this.isResolved=!1,this.isRejected=!1,this.response,this.prevFnRes;var s,a,i=this;function complete(e,t){function _runFn(e,t){for(;0<e.length;)i.prevFnRes=[e.shift().apply(i,i.prevFnRes)],_shiftFnsToNxtPromise(i,i.prevFnRes[0],t)}var r;i.isPending?(i.isPending=!1,i.response=t,i.prevFnRes=t,i.isResolved=e,i.isRejected=!e,r=i.fnQ.then,t=i.fnQ.fail,e=i.fnQ.done,i.isResolved?_runFn(r,"then"):_runFn(t,"fail"),_runFn(e,"done")):console.warn("Already this promise has been "+(i.isResolved?"Resolved.":"Rejected.")),_clearTimer([l,s,a])}function resolve(){complete.call(i,!0,Array.prototype.slice.call(arguments))}function reject(){complete.call(i,!1,Array.prototype.slice.call(arguments))}var o={resolve:resolve,reject:reject},l=setTimeout(function(){var e;O(t)?(e=t.call(o,resolve,reject),n&&(s=setTimeout(function(){i.isPending&&complete.call(i,!!e,[e])},E(e)?n:r||F))):a=setTimeout(function(){i.isPending&&complete.call(i,!!t,[t])},r||F)},F)}function _registerPromiseFn(e,t,r){var n=e;return"function"==typeof r&&(e=!n.isPending,"then"===t?e=e&&n.isResolved:"fail"===t&&(e=e&&n.isRejected),e?_isDeferred(e=r.apply(n,n.prevFnRes))?n=e:n.prevFnRes=[e]:n.fnQ[t].push(r)),n}function _onPromiseError(e){return _registerPromiseFn(this,"fail",e)}function _onPromiseAlways(e){return _registerPromiseFn(this,"done",e)}function XHRQ(e){Object.defineProperty(this,"fnQ",{value:{then:[],fail:[],done:[]}}),this.requests=e,this.responses=[],this.length=e.length,this.isPending=e.length,this.isFailed=!1,this.failed=[],this.prevFnRes;var t,s=this;function _runFn(e){for(var t,r=s.fnQ[e];0<r.length;)try{t=void 0===s.prevFnRes?[]:[s.prevFnRes],s.prevFnRes=r.shift().apply(s,t.concat(s.responses)),_shiftFnsToNxtPromise(s,s.prevFnRes,e)}catch(e){console.error("Function Execution Error.",e)}}function updateQ(){s.isPending--;try{s.isPending||(s.isFailed?_runFn("fail"):_runFn("then"),_runFn("done"),_clearTimer(t))}catch(e){console.error("Function Execution Error.",e),_clearTimer(t)}}t=setTimeout(function(){e.forEach(function(e,t){var r,n;_isDeferred(e)||l(e)&&(O(e.then)||O(e.fail)||O(e.catch))?("function"==typeof e.then&&e.then(function(){s.responses[t]=_argsToArr(arguments),updateQ()}),(n="function"==typeof e.fail?"fail":"function"==typeof e.catch?"catch":"")&&e[n](function(){s.responses[t]=_argsToArr(arguments),s.isFailed=!0,s.failed.push(t),updateQ()})):("function"==typeof e?(n=void 0!==(r=e.call(s,s.requests,s.responses,t))&&!r,s.responses[t]=r,s.isFailed=s.isFailed||n,n&&s.failed.push(t)):(s.responses[t]=e,s.isFailed=s.isFailed||!e,s.isFailed&&s.failed.push(t)),updateQ())})},F)}function _registerXHRQChainFn(e,t,r){var n=e;return"function"==typeof r&&(e=!n.isPending,"then"===t?e=e&&!n.isFailed:"fail"===t&&(e=e&&n.isFailed),e?(e=void 0===n.prevFnRes?[]:[n.prevFnRes],n.prevFnRes=r.apply(n,e.concat(n.responses)),_isDeferred(n.prevFnRes)&&(n=n.prevFnRes)):n.fnQ[t].push(r)),n}function _onXHRQError(e){return _registerXHRQChainFn(this,"fail",e)}function _onXHRQAlways(e){return _registerXHRQChainFn(this,"done",e)}function _xhrQ(){var r,n,s=[],a={};if(arguments.length)for(var e=0;e<arguments.length;e++)Array.isArray(arguments[e])?s=s.concat(arguments[e]):s.push(arguments[e]);s.forEach(function(e,t){"string"==typeof e&&(/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i.test(e)?(r=e.split(":")[0],(n=e.replace(/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i,""))?e={url:n,method:r}:a.method=r):e={url:e},s[t]=e),"object"!=typeof e||e.url||(a=w(a,e))});var t=[];return s.forEach(function(e){x(e)&&e.url&&!_isDeferred(e)?t.push(_xhr(w({},a,e))):_isDeferred(e)?t.push(e):t.push(function _defer(e,t,r){return arguments.length?new SimplePromise(e,t,r):new SimplePromise(1,F)}(e))}),new XHRQ(t)}function XHR(e){Object.defineProperty(this,"fnQ",{value:{then:[],fail:[],done:[]}}),this.xhr=new XMLHttpRequest,this.reqOptions=e,this.isPending=!0,this.isSuccess=!1,this.isFailed=!1,this.response="",this.prevFnRes}function _registerXHRChainFn(e,t,r){var n,s=e;return"function"==typeof r&&(e=!s.isPending,"then"===t?e=e&&s.isSuccess:"fail"===t&&(e=e&&s.isFailed),e?(s.isFailed?(n=void 0===s.prevFnRes?s:s.prevFnRes,s.prevFnRes=r.call(s.reqOptions,n,s.statusText,s.statusMessage,s.response)):(n=void 0===s.prevFnRes?s.response:s.prevFnRes,s.prevFnRes=r.call(s.reqOptions,n,s.statusText,s,s.response)),_isDeferred(s.prevFnRes)&&(s=s.prevFnRes)):s.fnQ[t].push(r)),s}function _onXhrError(e){return _registerXHRChainFn(this,"fail",e)}function _onXhrAlways(e){return _registerXHRChainFn(this,"done",e)}!function _attachPrototypes(t,r,n){Object.keys(r).forEach(function(e){_isReservedKey(e)||(n?t.prototype[e]=r[e]:Object.defineProperty(t.prototype,e,{value:r[e]}))})}(SimplePromise,{then:function _onPromiseSuccess(e){return _registerPromiseFn(this,"then",e)},else:_onPromiseError,fail:_onPromiseError,catch:_onPromiseError,done:_onPromiseAlways,always:_onPromiseAlways,finally:_onPromiseAlways}),Object.defineProperties(XHRQ.prototype,{then:{value:function _onXHRQSuccess(e){return _registerXHRQChainFn(this,"then",e)}},fail:{value:_onXHRQError},catch:{value:_onXHRQError},done:{value:_onXHRQAlways},always:{value:_onXHRQAlways},finally:{value:_onXHRQAlways}}),Object.defineProperties(XHR.prototype,{then:{value:function _onXhrSuccess(e){return _registerXHRChainFn(this,"then",e)}},fail:{value:_onXhrError},catch:{value:_onXhrError},done:{value:_onXhrAlways},always:{value:_onXhrAlways},finally:{value:_onXhrAlways}});var A={defaults:{dataType:"text",async:!0,cache:!1,method:"GET",headers:{},auth:null,timeout:0,success:null,error:null,finally:null},dataParsers:{css:function _cssParser(e){var t=document.createTextNode(e),r=document.createElement("style");return r.setAttribute("id","css-"+(new Date).getTime()),r.setAttribute("type","text/css"),r.appendChild(t),document.head.appendChild(r),e},json:function _jsonParser(e){var t=e;try{t=JSON.parse(e)}catch(e){}return t},script:_scriptParser,javascript:_scriptParser},urls:{},url:_xhrUrl,setup:_setupGlobalXHRDefaults,preFilter:_setupPreFilter,get:function(){return n.unshift.call(arguments,"get"),_xhr.apply(void 0,arguments)},post:function(){return n.unshift.call(arguments,"post"),_xhr.apply(void 0,arguments)},put:function(){return n.unshift.call(arguments,"put"),_xhr.apply(void 0,arguments)},del:function(){return n.unshift.call(arguments,"delete"),_xhr.apply(void 0,arguments)},patch:function(){return n.unshift.call(arguments,"patch"),_xhr.apply(void 0,arguments)},head:function(){return n.unshift.call(arguments,"head"),_xhr.apply(void 0,arguments)},options:function(){return n.unshift.call(arguments,"options"),_xhr.apply(void 0,arguments)}},e="url,setup,converters,preFilter,get,post,put,del,patch,head,options".split(",");function _setupGlobalXHRDefaults(r){x(r)&&Object.keys(r).forEach(function(t){if(e.indexOf(t)<0)switch(t){case"dataParsers":case"urls":x(r[t])&&Object.keys(r[t]).forEach(function(e){A[t][e]=r[t][e]});break;default:A.defaults[t]=r[t]}})}function _setupPreFilter(e){O(e)&&(A.defaults.preFilter=e)}function _getOptionalVal(e,t){t=(_hasOwnProp(e,t)?e:A.defaults)[t];return t}function _scriptParser(e){var t;return e.trim()&&((t=document.createElement("script")).setAttribute("id","js-"+(new Date).getTime()),t.text=e,document.head.appendChild(t).parentNode.removeChild(t)),e}var Q={200:"OK",301:"Moved Permanently",400:"Bad Request",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",511:"Network Authentication Required"},H={text:"text/plain",html:"text/html",css:"text/css",style:"text/css",csv:"text/csv",xml:"text/xml",json:"application/json",pdf:"application/pdf",script:"application/javascript",spacomponent:"application/javascript",zip:"application/zip"};function _xhrUrl(e){var t="@"===String(e||"")[0];e=String(e||"").replace(/^[@\s]+/,"");var r,n=t?A.urls[e]||c(A.urls,e,e):e,s=_argsToArr(arguments,1).map(function(e){return i(e,"object|array")?e:{}}),s=S.apply(null,s);return Object.keys(s).length&&-1<n.indexOf("{")&&a(n,"{","}",!0).forEach(function(e){r=e.replace(/[{}<>]/g,""),r=c(s,r,s._undefined),n=n.replace(new RegExp(e.replace(/([^a-zA-Z0-9])/g,"\\$1"),"g"),r)}),n}function _xhr(){if(!arguments.length)return _xhrQ.apply(null,[]);if(2===arguments.length&&T(arguments[0])&&!/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)$/i.test(arguments[0])&&x(arguments[1])&&!_hasOwnProp(arguments[1],"url")){var e=arguments[1];return e.url=arguments[0],_xhr(e)}if(1<arguments.length||Array.isArray(arguments[0]))return _xhrQ.apply(null,arguments);if(_isDeferred(arguments[0]))return arguments[0];var t=x(arguments[0])?arguments[0]:T(arguments[0])?{url:arguments[0]}:{},r={},n=[];t.skipDefaults?("string"==typeof(n=t.skipDefaults)?n=n.split(","):"boolean"==typeof n&&(n=["payload","headers"]),Array.isArray(n)&&n.length?(n=n.map(function(e){return(e=e.replace(/default/gi,"").trim())?"default"+e[0].toUpperCase()+e.slice(1):""}),Object.keys(A.defaults).forEach(function(e){n.indexOf(e)<0&&(r[e]=A.defaults[e])})):(n=[],r=w({},A.defaults))):r=w({},A.defaults),r.method=t.method||t.type||A.defaults.method;var s=w({},r,t);if(s.url){s.type=s.method=s.method.toUpperCase();var c=s.dataType.toLowerCase(),e=H[c]||(c&&c.indexOf("/")<-1?"text/"+s.dataType:s.dataType),a={},t=s.defaultHeaders;O(t)&&(t=t.call(s,s)),O(s.headers)&&(s.headers=s.headers.call(void 0,s)),x(s.headers)&&Object.keys(s.headers).forEach(function(e){a[e]=s.headers[e]}),x(t)&&(E(a)?a=t:x(a)&&(a=w(t,a))),!a.hasOwnProperty("Content-Type")&&e&&(a["Content-Type"]=e),a["X-Requested-With"]="XMLHttpRequest",a["Cache-Control"]=s.cache?"max-age=86400000":"no-cache, no-store, must-revalidate, max-age=0",a.Expires=s.cache?new Date((new Date).setDate((new Date).getDate()+1)).toUTCString():"0",s.cache||(a.Pragma="no-cache"),s.headers=a;var u,p,f,h,d,y=new XHR(s),i=y.xhr,_=y.reqOptions,v=y.fnQ;O(_.success)&&v.then.push(_.success),O(_.error)&&v.fail.push(_.error),O(_.finally)&&v.done.push(_.finally),Object.keys(_).forEach(function(t){var e=t.toLowerCase();"onreadystatechange"===e&&O(_[t])?d=_[t]:0===e.indexOf("on")&&O(_[t])&&(i[e]=function(e){_[t].call(i,e,y)})}),i.onreadystatechange=_xhrReadyStateChange;e=_.defaultPayload;O(e)&&(e=e.call(_,_));var o=_.data;x(e)&&(E(o)?o=e:x(o)&&(o=S(e,o))),_.data=o;e=_getOptionalVal(_,"preFilter");e&&O(e)&&e.call(y,_,w({},_),y);var l=_xhrUrl(_.url,_.urlParams,_.data);/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i.test(l)&&(_.method=l.split(":")[0].toUpperCase(),l=l.replace(/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i,"")),_.url=l;var P=_.method=_.method.toUpperCase(),e=_.cache,o=_.data;e||(e=(new Date).getTime(),_.headers["X-T-"+e]=e,"GET"===P&&(l+=(l.indexOf("?")<0?"?":/\?$|&$/.test(l)?"":"&")+"_="+e)),"GET"===P&&o&&(o=_toQueryString(o))&&(l+=(l.indexOf("?")<0?"?":/\?$|&$/.test(l)?"":"&")+o);try{_.auth&&x(_.auth)?_.auth.hasOwnProperty("user")&&(_.auth.hasOwnProperty("pwd")?i.open(P,l,_.async,_.auth.user,_.auth.pwd):i.open(P,l,_.async,_.auth.user)):i.open(P,l,_.async);var m,g=_getOptionalVal(_,"beforeSend"),R=!0;if(g&&O(g))try{R=(R=g.call(i,i,_))||E(R),o=_.data}catch(e){R=!1,console.warn("beforeSend function failed.",e,y)}R?(m=_.headers,x(m)&&Object.keys(m).forEach(function(e){i.setRequestHeader(e,m[e])}),_.timeout&&(i.timeout=_.timeout,u=setTimeout(function(){p=!0,y.isPending&&0<i.readyState&&i.readyState<4&&i.abort()},_.timeout)),"GET"!==P&&o?(o=T(o)?o:JSON.stringify(o),_.async?h=setTimeout(function(){i.send(o)},F):i.send(o)):_.async?h=setTimeout(function(){i.send()},F):i.send()):(f=!0,i.abort(),_xhrReadyStateChange())}catch(e){console.warn("XHR-Exception",i,e)}return y}function _xhrReadyStateChange(e){var t=this,r=t.status;if(d&&d.call(_,t,e),f||4===t.readyState){y.isPending=!1,y.readyState=t.readyState,y.status=t.status,y.responseText=t.responseText,y.response=t.responseText;var n,s,a=t.responseText;if(200<=r&&r<300||304===r){if(y.isSuccess=!0,y.statusText="success",y.statusMessage="OK",(n=_hasOwnProp(_,"dataParser")?_.dataParser:A.dataParsers[c])&&O(n))try{s=n(a,c)}catch(e){console.warn("dataParsing failed.",a,y,e)}E(s)||(a=s);var i,o=_getOptionalVal(_,"dataFilter");if(o&&O(o))try{i=o.call(y.reqOptions,a,c)}catch(e){console.warn("dataFilter failed.",a,y,e)}E(i)||(a=i);var l=_.sanitizeApiXss;l&&(a=O(l)?l.call(a,a)||a:j(a)),"json"===c&&(y.responseJSON=a)}else a=t.responseText,y.isFailed=!0,u&&p?(y.statusText="timeout",y.statusMessage="timeout"):f?(y.statusText="canceled",y.statusMessage="canceled"):(y.statusText="error",y.statusMessage=Q[r]||"Unknown Error");y.response=a,y.isSuccess?_runFn("then"):y.isFailed&&_runFn("fail"),_runFn("done"),_clearTimer([u,h])}function _runFn(e){for(var t,r=v[e];0<r.length;)try{y.isFailed?(t=void 0===y.prevFnRes?y:y.prevFnRes,y.prevFnRes=r.shift().call(_,t,y.statusText,y.statusMessage,y.response)):(t=void 0===y.prevFnRes?y.response:y.prevFnRes,y.prevFnRes=r.shift().call(_,t,y.statusText,y,y.response)),_shiftFnsToNxtPromise(y,y.prevFnRes,e)}catch(e){console.error("Function Execution Error.",e)}}}console.error("XHR without URL.",arguments,s)}function xhrLib(){return _xhrQ.apply(t,_argsToArr(arguments))}_fnProps(_xhr,A),_fnProps(xhrLib,{ajax:_xhr,ajaxQ:_xhrQ,when:_xhrQ,defer:_xhrQ,ajaxSetup:_setupGlobalXHRDefaults,ajaxPrefilter:_setupPreFilter}),t.spaXHR=xhrLib}(this);