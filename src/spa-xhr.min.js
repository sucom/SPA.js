/*@license SPA.js (XHR/ajax) [MIT]*/
!function(t){var r=Object.prototype,n=Array.prototype,R=0;function _argsToArr(e,t){return 1===arguments.length?n.slice.call(e):n.slice.call(e,t)}function _isReservedKey(e){return-1<s.indexOf(e)}function _hasOwnProp(e,t){return r.hasOwnProperty.call(e,t)}var s="hasOwnProperty,prototype,__proto__".split(",");function _fnProps(t,n){return Object.keys(n).forEach(function(e){_isReservedKey(e)||Object.defineProperty(t,e,{value:n[e]})}),t}function _clearTimer(e){e&&(Array.isArray(e)?e:[e]).forEach(function(e){e&&clearTimeout(e)})}var a=spa.extractStrBetweenIn,i=spa.is,w=spa.isString,o=spa.isArray,F=spa.isObject,l=spa.isObjectLike,T=spa.isFunction,x=spa.isUndefined,O=spa.extend,S=spa.merge,c=spa.find,j=spa.sanitizeXSS;function _toQueryString(e){var r,s,a,i;return F(e)?(_hasOwnProp(r=e,"_payload_")||function _isSimple(e){var t=!0;if("object"==typeof e)for(var n=Object.keys(e),r=0;t&&r<n.length;r++)t="object"!=typeof e[n[r]]||o(e[n[r]])&&_isSimple(e[n[r]]);return t}(e)||(r={_payload_:e}),Object.keys(r).reduce(function(e,t,n){return s=0===n?"":"&",a=encodeURIComponent(t),i=o(r[t])?r[t].map(_toQryParamValue).join(","):_toQryParamValue(r[t]),[e,s,a,"=",i].join("")},"")):String(e);function _toQryParamValue(e){return encodeURIComponent("object"==typeof e?JSON.stringify(e):e)}}function _isDeferred(e){return e instanceof XHR||e instanceof XHRQ||e instanceof SimplePromise||t.Promise&&e instanceof Promise||t.jqXHR&&e instanceof jqXHR||t.Thenable&&e instanceof Thenable||t.Deferred&&e instanceof Deferred}function _shiftFnsToNxtPromise(e,t,n){var r=e.fnQ.then,s=e.fnQ.fail,a=e.fnQ.done,n={then:"then,fail,done",fail:"fail,done",done:"done"}[n];if(_isDeferred(t)){if(-1<n.indexOf("then"))for(;0<r.length;)t.then(r.shift());else e.fnQ.then=[];if(-1<n.indexOf("fail"))for(;0<s.length;)t.catch(s.shift());else e.fnQ.fail=[];if(-1<n.indexOf("done"))for(;0<a.length;)t.finally(a.shift())}}function SimplePromise(t,n,r){Object.defineProperty(this,"fnQ",{value:{then:[],fail:[],done:[]}}),this.isPending=!0,this.isResolved=!1,this.isRejected=!1,this.response,this.prevFnRes;var s,a,i=this;function complete(e,t){function _runFn(e,t){for(;0<e.length;)i.prevFnRes=[e.shift().apply(i,i.prevFnRes)],_shiftFnsToNxtPromise(i,i.prevFnRes[0],t)}var n;i.isPending?(i.isPending=!1,i.response=t,i.prevFnRes=t,i.isResolved=e,i.isRejected=!e,t=i.fnQ.then,e=i.fnQ.fail,n=i.fnQ.done,i.isResolved?_runFn(t,"then"):_runFn(e,"fail"),_runFn(n,"done")):console.warn("Already this promise has been "+(i.isResolved?"Resolved.":"Rejected.")),_clearTimer([l,s,a])}function resolve(){complete.call(i,!0,Array.prototype.slice.call(arguments))}function reject(){complete.call(i,!1,Array.prototype.slice.call(arguments))}var o={resolve:resolve,reject:reject},l=setTimeout(function(){var e;T(t)?(e=t.call(o,resolve,reject),r&&(s=setTimeout(function(){i.isPending&&complete.call(i,!!e,[e])},x(e)?r:n||R))):a=setTimeout(function(){i.isPending&&complete.call(i,!!t,[t])},n||R)},R)}function _registerPromiseFn(e,t,n){var r;return"function"==typeof n&&(r=!e.isPending,"then"===t?r=r&&e.isResolved:"fail"===t&&(r=r&&e.isRejected),r?_isDeferred(r=n.apply(e,e.prevFnRes))?e=r:e.prevFnRes=[r]:e.fnQ[t].push(n)),e}function _onPromiseError(e){return _registerPromiseFn(this,"fail",e)}function _onPromiseAlways(e){return _registerPromiseFn(this,"done",e)}function XHRQ(e){Object.defineProperty(this,"fnQ",{value:{then:[],fail:[],done:[]}}),this.requests=e,this.responses=[],this.length=e.length,this.isPending=e.length,this.isFailed=!1,this.failed=[],this.prevFnRes;var t,s=this;function _runFn(e){for(var t,n=s.fnQ[e];0<n.length;)try{t=void 0===s.prevFnRes?[]:[s.prevFnRes],s.prevFnRes=n.shift().apply(s,t.concat(s.responses)),_shiftFnsToNxtPromise(s,s.prevFnRes,e)}catch(e){console.error("Function Execution Error.",e)}}function updateQ(){s.isPending--;try{s.isPending||(s.isFailed?_runFn("fail"):_runFn("then"),_runFn("done"),_clearTimer(t))}catch(e){console.error("Function Execution Error.",e),_clearTimer(t)}}t=setTimeout(function(){e.forEach(function(e,t){var n,r;_isDeferred(e)||l(e)&&(T(e.then)||T(e.fail)||T(e.catch))?("function"==typeof e.then&&e.then(function(){s.responses[t]=_argsToArr(arguments),updateQ()}),(n="function"==typeof e.fail?"fail":"function"==typeof e.catch?"catch":"")&&e[n](function(){s.responses[t]=_argsToArr(arguments),s.isFailed=!0,s.failed.push(t),updateQ()})):("function"==typeof e?(r=void 0!==(n=e.call(s,s.requests,s.responses,t))&&!n,s.responses[t]=n,s.isFailed=s.isFailed||r,r&&s.failed.push(t)):(s.responses[t]=e,s.isFailed=s.isFailed||!e,s.isFailed&&s.failed.push(t)),updateQ())})},R)}function _registerXHRQChainFn(e,t,n){var r;return"function"==typeof n&&(r=!e.isPending,"then"===t?r=r&&!e.isFailed:"fail"===t&&(r=r&&e.isFailed),r?(r=void 0===e.prevFnRes?[]:[e.prevFnRes],e.prevFnRes=n.apply(e,r.concat(e.responses)),_isDeferred(e.prevFnRes)&&(e=e.prevFnRes)):e.fnQ[t].push(n)),e}function _onXHRQError(e){return _registerXHRQChainFn(this,"fail",e)}function _onXHRQAlways(e){return _registerXHRQChainFn(this,"done",e)}function _xhrQ(){var n,r,s=[],a={};if(arguments.length)for(var e=0;e<arguments.length;e++)Array.isArray(arguments[e])?s=s.concat(arguments[e]):s.push(arguments[e]);s.forEach(function(e,t){"string"==typeof e&&(/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i.test(e)?(n=e.split(":")[0],(r=e.replace(/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i,""))?e={url:r,method:n}:a.method=n):e={url:e},s[t]=e),"object"!=typeof e||e.url||(a=O(a,e))});var t=[];return s.forEach(function(e){F(e)&&e.url&&!_isDeferred(e)?t.push(_xhr(O({},a,e))):_isDeferred(e)?t.push(e):t.push(function _defer(e,t,n){return arguments.length?new SimplePromise(e,t,n):new SimplePromise(1,R)}(e))}),new XHRQ(t)}function XHR(e){Object.defineProperty(this,"fnQ",{value:{then:[],fail:[],done:[]}}),this.xhr=new XMLHttpRequest,this.reqOptions=e,this.isPending=!0,this.isSuccess=!1,this.isFailed=!1,this.response="",this.prevFnRes}function _registerXHRChainFn(e,t,n){var r,s;return"function"==typeof n&&(s=!e.isPending,"then"===t?s=s&&e.isSuccess:"fail"===t&&(s=s&&e.isFailed),s?(e.isFailed?(r=void 0===e.prevFnRes?e:e.prevFnRes,e.prevFnRes=n.call(e.reqOptions,r,e.statusText,e.statusMessage,e.response)):(r=void 0===e.prevFnRes?e.response:e.prevFnRes,e.prevFnRes=n.call(e.reqOptions,r,e.statusText,e,e.response)),_isDeferred(e.prevFnRes)&&(e=e.prevFnRes)):e.fnQ[t].push(n)),e}function _onXhrError(e){return _registerXHRChainFn(this,"fail",e)}function _onXhrAlways(e){return _registerXHRChainFn(this,"done",e)}!function _attachPrototypes(t,n,r){Object.keys(n).forEach(function(e){_isReservedKey(e)||(r?t.prototype[e]=n[e]:Object.defineProperty(t.prototype,e,{value:n[e]}))})}(SimplePromise,{then:function _onPromiseSuccess(e){return _registerPromiseFn(this,"then",e)},else:_onPromiseError,fail:_onPromiseError,catch:_onPromiseError,done:_onPromiseAlways,always:_onPromiseAlways,finally:_onPromiseAlways}),Object.defineProperties(XHRQ.prototype,{then:{value:function _onXHRQSuccess(e){return _registerXHRQChainFn(this,"then",e)}},fail:{value:_onXHRQError},catch:{value:_onXHRQError},done:{value:_onXHRQAlways},always:{value:_onXHRQAlways},finally:{value:_onXHRQAlways}}),Object.defineProperties(XHR.prototype,{then:{value:function _onXhrSuccess(e){return _registerXHRChainFn(this,"then",e)}},fail:{value:_onXhrError},catch:{value:_onXhrError},done:{value:_onXhrAlways},always:{value:_onXhrAlways},finally:{value:_onXhrAlways}});var E={defaults:{dataType:"text",async:!0,cache:!1,method:"GET",headers:{},auth:null,timeout:0,success:null,error:null,finally:null},dataParsers:{css:function _cssParser(e){var t=document.createTextNode(e),n=document.createElement("style");return n.setAttribute("id","css-"+(new Date).getTime()),n.setAttribute("type","text/css"),n.appendChild(t),document.head.appendChild(n),e},json:function _jsonParser(e){var t=e;try{t=JSON.parse(e)}catch(e){}return t},script:_scriptParser,javascript:_scriptParser},urls:{},url:_xhrUrl,setup:_setupGlobalXHRDefaults,preFilter:_setupPreFilter,get:function(){return n.unshift.call(arguments,"get"),_xhr.apply(void 0,arguments)},post:function(){return n.unshift.call(arguments,"post"),_xhr.apply(void 0,arguments)},put:function(){return n.unshift.call(arguments,"put"),_xhr.apply(void 0,arguments)},del:function(){return n.unshift.call(arguments,"delete"),_xhr.apply(void 0,arguments)},patch:function(){return n.unshift.call(arguments,"patch"),_xhr.apply(void 0,arguments)},head:function(){return n.unshift.call(arguments,"head"),_xhr.apply(void 0,arguments)},options:function(){return n.unshift.call(arguments,"options"),_xhr.apply(void 0,arguments)}},e="url,setup,converters,preFilter,get,post,put,del,patch,head,options".split(",");function _setupGlobalXHRDefaults(n){F(n)&&Object.keys(n).forEach(function(t){if(e.indexOf(t)<0)switch(t){case"dataParsers":case"urls":F(n[t])&&Object.keys(n[t]).forEach(function(e){E[t][e]=n[t][e]});break;default:E.defaults[t]=n[t]}})}function _setupPreFilter(e){T(e)&&(E.defaults.preFilter=e)}function _getOptionalVal(e,t){e=(_hasOwnProp(e,t)?e:E.defaults)[t];return e}function _scriptParser(e){var t;return e.trim()&&((t=document.createElement("script")).setAttribute("id","js-"+(new Date).getTime()),t.text=e,document.head.appendChild(t).parentNode.removeChild(t)),e}var A={200:"OK",301:"Moved Permanently",400:"Bad Request",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",511:"Network Authentication Required"},Q={text:"text/plain",html:"text/html",css:"text/css",style:"text/css",csv:"text/csv",xml:"text/xml",json:"application/json",pdf:"application/pdf",script:"application/javascript",spacomponent:"application/javascript",zip:"application/zip"};function _xhrUrl(e){var t,n="@"===String(e||"")[0],r=(e=String(e||"").replace(/^[@\s]+/,""),n?E.urls[e]||c(E.urls,e,e):e),s=_argsToArr(arguments,1).map(function(e){return i(e,"object|array")?e:{}}),s=S.apply(null,s);return Object.keys(s).length&&-1<r.indexOf("{")&&a(r,"{","}",!0).forEach(function(e){t=e.replace(/[{}<>]/g,""),t=c(s,t,s._undefined),r=r.replace(new RegExp(e.replace(/([^a-zA-Z0-9])/g,"\\$1"),"g"),t)}),r}function _xhr(){if(!arguments.length)return _xhrQ.apply(null,[]);if(2===arguments.length&&w(arguments[0])&&!/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)$/i.test(arguments[0])&&F(arguments[1])&&!_hasOwnProp(arguments[1],"url"))return(e=arguments[1]).url=arguments[0],_xhr(e);if(1<arguments.length||Array.isArray(arguments[0]))return _xhrQ.apply(null,arguments);if(_isDeferred(arguments[0]))return arguments[0];var e=F(arguments[0])?arguments[0]:w(arguments[0])?{url:arguments[0]}:{},c={},t=[],n=(e.skipDefaults?("string"==typeof(t=e.skipDefaults)?t=t.split(","):"boolean"==typeof t&&(t=["payload","headers"]),Array.isArray(t)&&t.length?(t=t.map(function(e){return(e=e.replace(/default/gi,"").trim())?"default"+e[0].toUpperCase()+e.slice(1):""}),Object.keys(E.defaults).forEach(function(e){t.indexOf(e)<0&&(c[e]=E.defaults[e])})):(t=[],c=O({},E.defaults))):c=O({},E.defaults),c.method=e.method||e.type||E.defaults.method,O({},c,e));if(n.url){n.type=n.method=n.method.toUpperCase();var u,p,f,h,d,y=n.dataType.toLowerCase(),e=Q[y]||(y&&y.indexOf("/")<-1?"text/"+n.dataType:n.dataType),r={},s=n.defaultHeaders,o=(T(s)&&(s=s.call(n,n)),T(n.headers)&&(n.headers=n.headers.call(void 0,n)),F(n.headers)&&Object.keys(n.headers).forEach(function(e){r[e]=n.headers[e]}),F(s)&&(x(r)?r=s:F(r)&&(r=O(s,r))),!r.hasOwnProperty("Content-Type")&&e&&(r["Content-Type"]=e),r["X-Requested-With"]="XMLHttpRequest",r["Cache-Control"]=n.cache?"max-age=86400000":"no-cache, no-store, must-revalidate, max-age=0",r.Expires=n.cache?new Date((new Date).setDate((new Date).getDate()+1)).toUTCString():"0",n.cache||(r.Pragma="no-cache"),n.headers=r,new XHR(n)),a=o.xhr,l=o.reqOptions,_=o.fnQ,s=(T(l.success)&&_.then.push(l.success),T(l.error)&&_.fail.push(l.error),T(l.finally)&&_.done.push(l.finally),Object.keys(l).forEach(function(t){var e=t.toLowerCase();"onreadystatechange"===e&&T(l[t])?d=l[t]:0===e.indexOf("on")&&T(l[t])&&(a[e]=function(e){l[t].call(a,e,o)})}),a.onreadystatechange=_xhrReadyStateChange,l.defaultPayload),i=(T(s)&&(s=s.call(l,l)),l.data),e=(F(s)&&(x(i)?i=s:F(i)&&(i=S(s,i))),l.data=i,_getOptionalVal(l,"preFilter")),s=(e&&T(e)&&e.call(o,l,O({},l),o),_xhrUrl(l.url,l.urlParams,l.data)),e=(/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i.test(s)&&(l.method=s.split(":")[0].toUpperCase(),s=s.replace(/^(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)(:+)/i,"")),l.url=s,l.method=l.method.toUpperCase()),v=l.cache,i=l.data;v||(v=(new Date).getTime(),l.headers["X-T-"+v]=v,"GET"===e&&(s+=(s.indexOf("?")<0?"?":/\?$|&$/.test(s)?"":"&")+"_="+v)),"GET"===e&&i&&(i=_toQueryString(i))&&(s+=(s.indexOf("?")<0?"?":/\?$|&$/.test(s)?"":"&")+i);try{l.auth&&F(l.auth)?l.auth.hasOwnProperty("user")&&(l.auth.hasOwnProperty("pwd")?a.open(e,s,l.async,l.auth.user,l.auth.pwd):a.open(e,s,l.async,l.auth.user)):a.open(e,s,l.async);var P,m=_getOptionalVal(l,"beforeSend"),g=!0;if(m&&T(m))try{g=(g=m.call(a,a,l))||x(g),i=l.data}catch(e){g=!1,console.warn("beforeSend function failed.",e,o)}g?(P=l.headers,F(P)&&Object.keys(P).forEach(function(e){a.setRequestHeader(e,P[e])}),l.timeout&&(a.timeout=l.timeout,u=setTimeout(function(){p=!0,o.isPending&&0<a.readyState&&a.readyState<4&&a.abort()},l.timeout)),"GET"!==e&&i?(i=w(i)?i:JSON.stringify(i),l.async?h=setTimeout(function(){a.send(i)},R):a.send(i)):l.async?h=setTimeout(function(){a.send()},R):a.send()):(f=!0,a.abort(),_xhrReadyStateChange())}catch(e){console.warn("XHR-Exception",a,e)}return o}function _xhrReadyStateChange(e){var t=this,n=t.status;if(d&&d.call(l,t,e),f||4===t.readyState){o.isPending=!1,o.readyState=t.readyState,o.status=t.status,o.responseText=t.responseText,o.response=t.responseText;var r=t.responseText;if(200<=n&&n<300||304===n){if(o.isSuccess=!0,o.statusText="success",o.statusMessage="OK",(a=_hasOwnProp(l,"dataParser")?l.dataParser:E.dataParsers[y])&&T(a))try{i=a(r,y)}catch(e){console.warn("dataParsing failed.",r,o,e)}x(i)||(r=i);var s,a=_getOptionalVal(l,"dataFilter");if(a&&T(a))try{s=a.call(o.reqOptions,r,y)}catch(e){console.warn("dataFilter failed.",r,o,e)}x(s)||(r=s);var i=l.sanitizeApiXss;i&&(r=T(i)?i.call(r,r)||r:j(r)),"json"===y&&(o.responseJSON=r)}else r=t.responseText,o.isFailed=!0,u&&p?(o.statusText="timeout",o.statusMessage="timeout"):f?(o.statusText="canceled",o.statusMessage="canceled"):(o.statusText="error",o.statusMessage=A[n]||"Unknown Error");o.response=r,o.isSuccess?_runFn("then"):o.isFailed&&_runFn("fail"),_runFn("done"),_clearTimer([u,h])}function _runFn(e){for(var t,n=_[e];0<n.length;)try{o.isFailed?(t=void 0===o.prevFnRes?o:o.prevFnRes,o.prevFnRes=n.shift().call(l,t,o.statusText,o.statusMessage,o.response)):(t=void 0===o.prevFnRes?o.response:o.prevFnRes,o.prevFnRes=n.shift().call(l,t,o.statusText,o,o.response)),_shiftFnsToNxtPromise(o,o.prevFnRes,e)}catch(e){console.error("Function Execution Error.",e)}}}console.error("XHR without URL.",arguments,n)}function xhrLib(){return _xhrQ.apply(t,_argsToArr(arguments))}_fnProps(_xhr,E),_fnProps(xhrLib,{ajax:_xhr,ajaxQ:_xhrQ,when:_xhrQ,defer:_xhrQ,ajaxSetup:_setupGlobalXHRDefaults,ajaxPrefilter:_setupPreFilter}),t.spaXHR=xhrLib}(window||globalThis);