(function(){var e;var d=function(){};var b=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];var c=b.length;var a=(window.console=window.console||{});while(c--){e=b[c];if(!a[e]){a[e]=d}}if(!("none" in window)){window.none=""}if(!("noop" in window)){window.noop=function(){}}}());var isKHashRouteOn=false;(function(){var win=this;var klib=function(obj){if(obj instanceof klib){return obj}if(!(this instanceof klib)){return new klib(obj)}};win.klib=klib;klib.VERSION="2.0.0";var isById=(document.getElementById),isByName=(document.all);klib.isIE=(isByName)?true:false;klib.isNonIE=(isById&&!isByName)?true:false;klib.noop=function(){};klib.debug=false;klib["debugger"]={on:function(){klib.debug=true},off:function(){klib.debug=false},toggle:function(){klib.debug=!klib.debug}};klib.cOut=function(consoleType,o){if(klib.debug&&console[consoleType]){console[consoleType](o)}};klib.console={clear:function(){console.clear()},assert:function(o){klib.cOut("assert",o)},count:function(o){klib.cOut("count",o)},debug:function(o){klib.cOut("debug",o)},dir:function(o){klib.cOut("dir",o)},dirxml:function(o){klib.cOut("dirxml",o)},error:function(o){klib.cOut("error",o)},exception:function(o){klib.cOut("exception",o)},group:function(o){klib.cOut("group",o)},groupCollapsed:function(o){klib.cOut("groupCollapsed",o)},groupEnd:function(o){klib.cOut("groupEnd",o)},info:function(o){klib.cOut("info",o)},log:function(o){klib.cOut("log",o)},markTimeline:function(o){klib.cOut("markTimeline",o)},profile:function(o){klib.cOut("profile",o)},profileEnd:function(o){klib.cOut("profileEnd",o)},table:function(o){klib.cOut("table",o)},time:function(o){klib.cOut("time",o)},timeEnd:function(o){klib.cOut("timeEnd",o)},timeStamp:function(o){klib.cOut("timeStamp",o)},trace:function(o){klib.cOut("trace",o)},warn:function(o){klib.cOut("warn",o)}};klib._initWindowOnHashChange=function(){if("onhashchange" in window){isKHashRouteOn=true;klib.console.info("Registering HashRouting Listener");window.onhashchange=function(ocEvent){var cHash=window.location.hash;klib.console.info("onHashChange: "+cHash);if(cHash){klib.route(cHash)}else{if(klib.routesOptions.defaultPageRoute){klib.route(klib.routesOptions.defaultPageRoute)}}}}};klib._stopWindowOnHashChange=function(){window.onhashchange=undefined};String.prototype.trimLeftStr=function(tStr){return(this.replace(new RegExp("^["+(tStr||"\\s")+"]+","g"),""))};String.prototype.trimRightStr=function(tStr){return(this.replace(new RegExp("["+(tStr||"\\s")+"]+$","g"),""))};String.prototype.trimStr=function(tStr){return this.trimLeftStr(tStr).trimRightStr(tStr)};String.prototype.isBlankStr=function(){return(this.trimStr()=="")};String.prototype.ifBlankStr=function(forNullStr,forNotNullStr){forNullStr=forNullStr||"";forNotNullStr=(typeof forNotNullStr==="undefined")?this.trimStr():forNotNullStr;return(this.isBlankStr()?((""+forNullStr).trimStr()):(forNotNullStr))};String.prototype.isNumberStr=function(){return((((""+this).replace(/[0-9.]/g,"")).trimStr()).length==0)};String.prototype.normalizeStr=function(){return(this).trimStr().replace(/\s+/g," ")};String.prototype.beginsWithStr=function(str,i){i=(i)?"i":"";var re=new RegExp("^"+str,i);return((this).normalizeStr().match(re))?true:false};String.prototype.beginsWithStrIgnoreCase=function(str){var re=new RegExp("^"+str,"i");return((this).normalizeStr().match(re))?true:false};String.prototype.endsWithStr=function(str,i){i=(i)?"i":"";var re=new RegExp(str+"$",i);return((this).normalizeStr().match(re))?true:false};String.prototype.endsWithStrIgnoreCase=function(str,i){var re=new RegExp(str+"$","i");return((this).normalizeStr().match(re))?true:false};String.prototype.containsStr=function(str,i){i=(i)?"gi":"g";var re=new RegExp(""+str,i);return((re).test(this))};String.prototype.containsStrIgnoreCase=function(str){var re=new RegExp(""+str,"gi");return((re).test(this))};String.prototype.equals=function(arg){return(this==arg)};String.prototype.equalsIgnoreCase=function(arg){return((String(this.toLowerCase())==(String(arg)).toLowerCase()))};String.prototype.toProperCase=function(normalizeSrc){return((((typeof normalizeSrc=="undefined")||normalizeSrc)?((this).normalizeStr()):(this)).toLowerCase().replace(/^(.)|\s(.)/g,function($1){return $1.toUpperCase()}))};klib.toJSON=function(str){var thisStr;if(_.isString(str)){thisStr=str.trimStr();if(thisStr.containsStr(":")&&!thisStr.containsStr(",")&&thisStr.containsStr(";")){thisStr=thisStr.replace(/\;/g,",")}if(!(thisStr.beginsWithStr("{")||thisStr.beginsWithStr("\\["))){if(thisStr.containsStr(":")){thisStr="{"+thisStr+"}"}else{if(thisStr.containsStr("=")){thisStr="{"+thisStr.replace(/=/g,":")+"}"}else{thisStr="["+thisStr+"]"}}}else{if(thisStr.beginsWithStr("{")&&!thisStr.containsStr(":")&&thisStr.containsStr("=")){thisStr=""+thisStr.replace(/=/g,":")+""}}}return(!_.isString(str)&&_.isObject(str))?str:(klib.isBlank(str)?null:(eval("("+thisStr+")")))};String.prototype.toJSON=function(){return klib.toJSON(this)};String.prototype.toBoolean=function(){var retValue=true;switch((""+this).trimStr().toLowerCase()){case"":case"0":case"-0":case"nan":case"null":case"false":case"undefined":retValue=false;break}if(retValue){retValue=(!(""+this).trimStr().beginsWithStr("-"))}return(retValue)};Boolean.prototype.toValue=function(tValue,fValue){if(typeof tValue=="undefined"){tValue=true}if(typeof fValue=="undefined"){fValue=false}return((this.valueOf())?(tValue):(fValue))};Boolean.prototype.toHtml=function(tElId,fElId){return $((this.valueOf())?tElId:fElId).html()};String.prototype.padStr=function(l,s,t){for(var ps="",i=0;i<l;i++){ps+=s}return(((t===0||t===2)?ps:"")+this+((t===1||t===2)?ps:""))};klib.lastSplitResult=[];klib.getOnSplit=function(str,delimiter,pickIndex){klib.lastSplitResult=str.split(delimiter);return(klib.getOnLastSplit(pickIndex))};klib.getOnLastSplit=function(pickIndex){return((pickIndex<0)?(_.last(klib.lastSplitResult)):(klib.lastSplitResult[pickIndex]))};klib.isBlank=klib.isEmpty=function(src){var retValue=true;if(src){switch(true){case (_.isString(src)):retValue=((src).trimStr().length==0);break;case (_.isArray(src)):case (_.isObject(src)):retValue=_.isEmpty(src);break}}return retValue};klib.isNumber=function(str){return((((""+str).replace(/[0-9.]/g,"")).trimStr()).length==0)};klib.toBoolean=function(str){var retValue=true;switch((""+str).trimStr().toLowerCase()){case"":case"0":case"-0":case"nan":case"null":case"false":case"undefined":retValue=false;break}return(retValue)};klib.toInt=function(str){str=(""+str).replace(/[^+-0123456789.]/g,"");str=klib.isBlank(str)?"0":((str.indexOf(".")>=0)?str.substring(0,str.indexOf(".")):str);return(parseInt(str*1,10))};klib.toFloat=function(str){str=(""+str).replace(/[^+-0123456789.]/g,"");str=klib.isBlank(str)?"0":str;return(parseFloat(str*(1)))};klib.toString=function(obj){klib.console.warn("klib.toString is deprecated. use klib.toStr instead.");var retValue=""+obj;if(_.isObject(obj)){retValue=JSON.stringify(obj)}return(retValue)};klib.toStr=function(obj){var retValue=""+obj;if(_.isObject(obj)){retValue=JSON.stringify(obj)}return(retValue)};klib.dotToX=function(dottedName,X){return((dottedName).replace(/\./g,X))};klib.dotToCamelCase=function(dottedName){var newName=(dottedName).replace(/\./g," ").toProperCase().replace(/ /g,"");return(newName[0].toLowerCase()+newName.substring(1))};klib.dotToTitleCase=function(dottedName){return((dottedName).replace(/\./g," ").toProperCase().replace(/ /g,""))};klib.toDottedPath=function(srcStr){return((srcStr||"").replace(/]/g,"").replace(/(\[)|(\\)|(\/)/g,".").replace(/(\.+)/g,".").trimStr("\\."))};klib.ifBlank=klib.ifEmpty=klib.ifNull=function(src,replaceWithIfBlank,replaceWithIfNotBlank){replaceWithIfBlank=(""+(replaceWithIfBlank||"")).trimStr();replaceWithIfNotBlank=(typeof replaceWithIfNotBlank==="undefined")?((""+src).trimStr()):replaceWithIfNotBlank;return(klib.isBlank(src)?(replaceWithIfBlank):(replaceWithIfNotBlank))};klib.now=function(){return(""+((new Date()).getTime()))};klib.year=function(n){n=n||0;return((new Date()).getFullYear()+(klib.toInt(n)))};klib.range=function(rangeSpec){var rSpec=(rangeSpec.toUpperCase()).split(".."),rangeB=""+rSpec[0],rangeE=""+rSpec[1],rStep="1";if(rangeE.indexOf(":")>0){rangeE=""+(rSpec[1].split(":"))[0];rStep=""+(rSpec[1].split(":"))[1]}if(rangeB.indexOf("Y")>=0){rangeB=klib.year((rangeB.split(/[^0-9+-]/))[1])}if(rangeE.indexOf("Y")>=0){rangeE=klib.year((rangeE.split(/[^0-9+-]/))[1])}var rB=klib.toInt(rangeB),rE=klib.toInt(rangeE),rS=klib.toInt(rStep);return(rangeB>rangeE)?((_.range(rE,(rB)+1,rS)).reverse()):(_.range(rB,(rE)+1,rS))};klib.checkAndPreventKey=function(e,disableKeys){if(!disableKeys){disableKeys=""}var withShiftKey=(disableKeys.indexOf("+shift")>=0),keyCode=""+e.keyCode,retValue=((((disableKeys.padStr(1,",",2)).indexOf(keyCode.padStr(1,",",2))>=0)&&(withShiftKey?((e.shiftKey)?true:false):((!e.shiftKey)?true:false))));if(retValue){e.preventDefault();klib.console.info("Key ["+keyCode+(withShiftKey?"+Shift":"")+"] has been disabled in this element.")}return retValue};klib._trackAndControlKey=function(e){var keyElement=e.currentTarget,$keyElement=$(keyElement),disableKeys=(""+$keyElement.data("disableKeys")).toLowerCase();klib.checkAndPreventKey(e,disableKeys);var changeFocusNext=(!klib.isBlank((""+$keyElement.data("focusNext")).replace(/undefined/,"").toLowerCase()));var changeFocusPrev=(!klib.isBlank((""+$keyElement.data("focusBack")).replace(/undefined/,"").toLowerCase()));if(changeFocusNext&&(klib.checkAndPreventKey(e,"9"))){$($keyElement.data("focusNext")).get(0).focus()}if(changeFocusPrev&&(klib.checkAndPreventKey(e,"9,+shift"))){$($keyElement.data("focusBack")).get(0).focus()}};klib.initKeyTracking=function(){var elementsToTrackKeys=(arguments.length)?arguments[0]:"[data-disable-keys],[data-focus-next],[data-focus-back]";klib.console.info("Finding Key-Tracking for element(s): "+elementsToTrackKeys);$(elementsToTrackKeys).each(function(index,element){$(element).keydown(klib._trackAndControlKey);klib.console.info("kLib is tracking keys on element:");klib.console.info(element)})};klib.getDocObj=function(objId){var jqSelector=((typeof objId)=="object")?objId:((objId.beginsWithStr("#")?"":"#")+objId);return($(jqSelector).get(0))};klib.getDocObjs=function(objId){var jqSelector=(objId.beginsWithStr("#")?"":"#")+objId;return($(jqSelector).get())};klib.setFocus=function(objId,isSelect){var oFocus=klib.getDocObj(objId);if(oFocus){oFocus.focus();if(isSelect){oFocus.select()}}};klib.isElementExist=function(elSelector){return(!$.isEmptyObject($(elSelector).get()))};klib.swapObjClass=function(objIDs,removeClass,addClass){$(objIDs).removeClass(removeClass);$(objIDs).addClass(addClass)};klib.docObjValue=function(objId,newValue){var reqObj=klib.getDocObj(objId);var retValue="";if(reqObj){retValue=reqObj.value;if(arguments.length===2){reqObj.value=newValue}}return(retValue)};klib.optionSelectedIndex=function(objId,newSelIdx){var retValue=-1;var oLstObj=klib.getDocObj(objId);if(oLstObj){retValue=oLstObj.selectedIndex;if(arguments.length===2){oLstObj.selectedIndex=newSelIdx}}return(retValue)};klib.optionIndexOfValue=function(objId,optValue){var retValue=-1;var oLstObj=klib.getDocObj(objId);if(oLstObj){for(var i=0;i<oLstObj.length;i++){if((""+optValue).equalsIgnoreCase(oLstObj.options[i].value)){retValue=i;break}}}return(retValue)};klib.optionIndexOfText=function(objId,optText){var retValue=-1;var oLstObj=klib.getDocObj(objId);if(oLstObj){for(var i=0;i<oLstObj.length;i++){if(optText.equalsIgnoreCase(oLstObj.options[i].text)){retValue=i;break}}}return(retValue)};klib.optionIndexOfValueBeginsWith=function(objId,optValue){var retValue=-1;var oLstObj=klib.getDocObj(objId);if(oLstObj){for(var i=0;i<oLstObj.length;i++){if((oLstObj.options[i].value).beginsWithStrIgnoreCase(optValue)){retValue=i;break}}}return(retValue)};klib.optionsSelectedValues=function(objId,delimiter){objId=(objId.beginsWithStr("#")?"":"#")+objId;delimiter=delimiter||",";return($.map(($(objId+" option:selected")),function(option){return(option.value)}).join(delimiter))};klib.optionsSelectedTexts=function(objId,delimiter){objId=(objId.beginsWithStr("#")?"":"#")+objId;delimiter=delimiter||",";return($.map(($(objId+" option:selected")),function(option){return(option.text)}).join(delimiter))};klib.optionValueOfIndex=function(objId,sIndex){var retValue="";var oLstObj=klib.getDocObj(objId);if((oLstObj)&&(sIndex>=0)&&(sIndex<oLstObj.length)){retValue=oLstObj.options[sIndex].value}return(retValue)};klib.optionTextOfIndex=function(objId,sIndex){var retValue="";var oLstObj=klib.getDocObj(objId);if((oLstObj)&&(sIndex>=0)&&(sIndex<oLstObj.length)){retValue=oLstObj.options[sIndex].text}return(retValue)};klib.selectOptionForValue=function(objId,selValue){var retValue=-1;var oLstObj=klib.getDocObj(objId);if(oLstObj){retValue=klib.optionIndexOfValue(objId,selValue);oLstObj.selectedIndex=retValue}return(retValue)};klib.selectOptionForValueBeginsWith=function(objId,selValue){var retValue=-1;var oLstObj=klib.getDocObj(objId);if(oLstObj){retValue=klib.optionIndexOfValueBeginsWith(objId,selValue);oLstObj.selectedIndex=retValue}return(retValue)};klib.selectOptionsForValues=function(objId,selValues,valDelimitChar){valDelimitChar=valDelimitChar||",";selValues=(valDelimitChar+selValues+valDelimitChar).toLowerCase();var oLstObj=klib.getDocObj(objId),optValue;if(oLstObj){for(var i=0;i<oLstObj.length;i++){optValue=(valDelimitChar+(oLstObj.options[i].value)+valDelimitChar).toLowerCase();oLstObj.options[i].selected=(selValues.indexOf(optValue)>=0)}}};klib.selectOptionForText=function(objId,selText){var retValue=-1;var oLstObj=klib.getDocObj(objId);if(oLstObj){retValue=klib.optionIndexOfText(objId,selText);oLstObj.selectedIndex=retValue}return(retValue)};klib.selectOptionsAll=function(objId){var oLstObj=klib.getDocObj(objId);if(oLstObj){for(var i=0;i<oLstObj.length;i++){oLstObj.options[i].selected=true}}};klib.selectOptionsNone=function(objId){var oLstObj=klib.getDocObj(objId);if(oLstObj){for(var i=0;i<oLstObj.length;i++){oLstObj.options[i].selected=false}}};klib.optionsReduceToLength=function(objID,nLen){nLen=nLen||0;var oSelOptList=klib.getDocObj(objID);if(oSelOptList){klib.selectOptionsNone(objID);oSelOptList.length=nLen}};klib.optionsRemoveAll=function(objID){klib.optionsReduceToLength(objID,0)};klib.optionRemoveForIndex=function(objId,optIndex){objId=(objId.beginsWithStr("#")?"":"#")+objId;var oLstObj=klib.getDocObj(objId);if(oLstObj){if((""+optIndex).equalsIgnoreCase("first")){optIndex=0}if((""+optIndex).equalsIgnoreCase("last")){optIndex=(oLstObj.length-1)}oLstObj.remove(optIndex)}};klib.optionRemoveForValue=function(objId,optValue){klib.optionRemoveForIndex(objId,klib.optionIndexOfValue(objId,optValue))};klib.optionRemoveForText=function(objId,optText){klib.optionRemoveForIndex(objId,klib.optionIndexOfText(objId,optText))};klib.optionRemoveForValueBeginsWith=function(objId,optValueBeginsWith){klib.optionRemoveForIndex(objId,klib.optionIndexOfValueBeginsWith(objId,optValueBeginsWith))};klib.optionAppend=function(objID,optValue,optText,appendAtIndex){var retValue=-1;var oSelOptList=klib.getDocObj(objID);if(oSelOptList){if(typeof appendAtIndex=="undefined"){var nOptPos=oSelOptList.length;oSelOptList.length=nOptPos+1;oSelOptList.options[nOptPos].value=optValue;oSelOptList.options[nOptPos].text=optText;retValue=nOptPos}else{$(oSelOptList).find("option").eq(appendAtIndex).before('<option value="'+optValue+'">'+optText+"</option>");retValue=appendAtIndex}}return(retValue)};klib.optionsLoad=function(elSelector,list,beginsAt,sortBy){var sortByAttr=["","key","value"];beginsAt=beginsAt||0;sortBy=sortBy||0;if((_.isString(list))&&(list.indexOf("..")>0)){list=klib.range(list)}if(beginsAt>=0){klib.optionsReduceToLength(elSelector,beginsAt)}if(_.isArray(list)){_.each(list,function(opt){klib.optionAppend(elSelector,opt,opt)})}else{if(sortBy>0){var listArray=[];for(var key in list){listArray.push({key:key,value:list[key]})}var listSorted=_.sortBy(listArray,sortByAttr[sortBy]);_.each(listSorted,function(opt){klib.optionAppend(elSelector,opt.key,opt.value)})}else{_.each(list,function(value,key){klib.optionAppend(elSelector,key,value)})}}};klib.checkedState=function(objId,newState){var retValue=false,objChk=klib.getDocObj(objId);if(objChk){retValue=objChk.checked;if(arguments.length===2){objChk.checked=newState}}return(retValue)};klib.isChecked=function(formId,eName){return(($("input[name="+eName+"]:checked",formId).length)>0)};klib.radioSelectedValue=function(formId,rName){var retValue=($("input[name="+rName+"]:checked",formId).val());return(retValue?retValue:"")};klib.radioClearSelection=function(formId,rName){($("input[name="+rName+"]:checked",formId).attr("checked",false))};klib.radioSelectForValue=function(formId,rName,sValue){$("input[name="+rName+"]:radio",formId).each(function(el){el.checked=((el.value).equalsIgnoreCase(sValue))})};klib.checkboxCheckedValues=function(formId,cbName,delimiter){delimiter=delimiter||",";return($("input[name="+cbName+"]:checked",formId).map(function(){return this.value}).get().join(delimiter))};klib.sleep=function(sec){var dt=new Date();dt.setTime(dt.getTime()+(sec*1000));while(new Date().getTime()<dt.getTime()){}};klib.filterJSON=function(jsonData,xFilter){return $(jsonData).filter(function(index,item){for(var i in xFilter){if(!item[i].toString().match(xFilter[i])){return null}}return item})};klib.randomPassword=function(passLen){var chars="9a8b77C8D9E8F7G6H5I4J3c6d5e4f32L3M4N5P6Qg2h3i4j5kV6W5X4Y3Z26m7n8p9q8r7s6t5u4v3w2x3y4z5A6BK7R8S9T8U7";var pass="";for(var x=0;x<passLen;x++){var i=Math.floor(Math.random()*(chars).length);pass+=chars.charAt(i)}return pass};klib.rand=function(min,max){return Math.floor(Math.random()*(max-min+1))+min};klib.htmlEncode=function(value){return $("<div/>").text(value).html()};klib.htmlDecode=function(value){return $("<div/>").html(value).text()};klib.parseKeyStr=function(keyName,changeToLowerCase){return((changeToLowerCase?keyName.toLowerCase():keyName).replace(/[^_0-9A-Za-z]/g,""))};klib.setObjProperty=function(obj,keyNameStr,propValue,keyToLowerCase){keyNameStr=(""+keyNameStr);keyToLowerCase=keyToLowerCase||false;var xObj=obj,oKey;var oKeys=keyNameStr.split(/(?=[A-Z])/);var keyIdentifier=$.trim(keyNameStr.replace(/[0-9A-Za-z]/g,""));if(keyIdentifier&&(keyIdentifier!="")){oKeys=keyNameStr.split(keyIdentifier[0])}while(oKeys.length>1){oKey=klib.parseKeyStr(oKeys.shift(),keyToLowerCase);if($.trim(oKey)!=""){if(typeof xObj[oKey]=="undefined"){xObj[oKey]={}}xObj=xObj[oKey]}}oKey=klib.parseKeyStr(oKeys.shift(),keyToLowerCase);xObj[oKey]=propValue;return obj};klib.getElValue=function(el){el=$(el).get(0);var elValue,unchkvalue;switch((el.tagName).toUpperCase()){case"INPUT":switch((el.type).toLowerCase()){case"checkbox":unchkvalue=$(el).data("unchecked");elValue=el.checked?(el.value):((typeof unchkvalue==="undefined")?"":unchkvalue);break;case"radio":elValue=el.checked?(el.value):"";break;default:elValue=$(el).val();break}break;case"SELECT":elValue=$.map(($(el).find("option:selected")),function(option){return(option.value)}).join(",");break;case"TEXTAREA":elValue=$(el).val();break;default:elValue=$(el).html();break}return elValue};klib.serializeDisabled=function(formSelector){var retValue="";$(formSelector).find("[disabled][name]").each(function(){retValue+=((retValue)?"&":"")+$(this).attr("name")+"="+klib.getElValue(this)});return retValue};klib.serializeForms=function(formSelector,includeDisabledElements){var disabledElementsKeyValues,unchkvalue,retValue=$(formSelector).serialize();$(formSelector).find("input:checkbox:enabled:not(:checked)[name]").each(function(){unchkvalue=$(this).data("unchecked");retValue+=((retValue)?"&":"")+$(this).attr("name")+"="+((typeof unchkvalue==="undefined")?"":unchkvalue)});if(includeDisabledElements){disabledElementsKeyValues=klib.serializeDisabled(formSelector);retValue+=((retValue&&disabledElementsKeyValues)?"&":"")+disabledElementsKeyValues}return retValue};klib.queryStringToJson=function(qStr){var retValue={},qStringWithParams=(qStr||location.search),qIndex=(""+qStringWithParams).indexOf("?"),ampIndex=(""+qStringWithParams).indexOf("&");if(qStringWithParams&&(qStringWithParams.length>0)&&(qIndex>=0)&&((qIndex==0)||(ampIndex>qIndex))){qStringWithParams=qStringWithParams.substring(qIndex+1)}_.each((qStringWithParams.split("&")),function(nvp){nvp=nvp.split("=");if(nvp[0]){if(_.has(retValue,nvp[0])){if(!_.isArray(retValue[nvp[0]])){retValue[nvp[0]]=[retValue[nvp[0]]]}retValue[nvp[0]].push(decodeURIComponent(nvp[1]||""))}else{retValue[nvp[0]]=decodeURIComponent(nvp[1]||"")}}});return retValue};$.fn.serializeUncheckedCheckboxes=function(appendTo){var $chkBox,unchkvalue,keyName,keyValue,toJSON=(typeof appendTo=="object"),retObj=(toJSON)?appendTo:{},retStr=(toJSON&&!appendTo)?(""):(appendTo);$(this).find("input:checkbox:enabled:not(:checked)[name]").each(function(index,el){$chkBox=$(el);keyName=$chkBox.attr("name");unchkvalue=$chkBox.data("unchecked");keyValue=((typeof unchkvalue==="undefined")?"":unchkvalue);if(toJSON){if(_.has(retObj,keyName)){if(!_.isArray(retObj[keyName])){retObj[keyName]=[retObj[keyName]]}retObj[keyName].push(keyValue)}else{retObj[keyName]=keyValue}}else{retStr+=((retStr)?"&":"")+keyName+"="+keyValue}});return((toJSON)?retObj:retStr)};klib.serializeUncheckedCheckboxes=function(formSelector,appendTo){return $(formSelector).serializeUncheckedCheckboxes(appendTo)};$.fn.serializeFormToJSON=$.fn.serializeFormToObject=function(obj,keyNameToLowerCase,strPrefixToIgnore){var a=this.serializeArray(),o=(typeof obj==="object")?obj:{},c=(typeof obj==="boolean")?obj:(keyNameToLowerCase||false),kParse=$(this).data("serializeIgnorePrefix"),oKeyName,oKeyValue;if(strPrefixToIgnore){kParse=strPrefixToIgnore}$.each(a,function(){oKeyName=(kParse)?(this.name).replace(kParse,""):this.name;o=klib.setObjProperty(o,oKeyName,this.value,c)});$(this).find("input:checkbox:enabled:not(:checked)").each(function(){oKeyName=$(this).attr("name");if(oKeyName){oKeyValue=$(this).data("unchecked");if(kParse){oKeyName=(oKeyName).replace(kParse,"")}oKeyValue=""+((typeof oKeyValue=="undefined")?"":oKeyValue);o=klib.setObjProperty(o,oKeyName,oKeyValue,c)}});return o};$.fn.serializeFormToSimpleJSON=$.fn.serializeFormToSimpleObject=function(obj,includeDisabledElements){var a=this.serializeArray(),o=(typeof obj==="object")?obj:{},c=(typeof obj==="boolean")?obj:(includeDisabledElements||false),oKeyStr,oGrpStr,oKeyName,oKeyValue;$.each(a,function(){o[this.name]=this.value});if(c){$(this).find("[disabled][name]").each(function(){o[this.name]=klib.getElValue(this)})}$(this).find("input:checkbox:enabled:not(:checked)[name]").each(function(){oKeyName=$(this).attr("name");oKeyValue=$(this).data("unchecked");oKeyValue=""+((typeof oKeyValue=="undefined")?"":oKeyValue);o[oKeyName]=oKeyValue});$(this).find("[data-to-json-group][name]").each(function(){oKeyStr=this.name;oGrpStr=$(this).data("toJsonGroup");if(oGrpStr){if(!o[oGrpStr]){o[oGrpStr]={}}o[oGrpStr][oKeyStr]=klib.getElValue(this)}});return o};klib.serializeFormToSimpleJSON=klib.serializeFormToSimpleObject=function(formSelector,obj,includeDisabledElements){return $(formSelector).serializeFormToSimpleJSON(obj,includeDisabledElements)};klib.serializeFormToJSON=klib.serializeFormToObject=function(formSelector,obj,keyNameToLowerCase,strPrefixToIgnore){return $(formSelector).serializeFormToJSON(obj,keyNameToLowerCase,strPrefixToIgnore)};klib.find=klib.locate=function(obj,path){var tObj=obj,retValue;if(typeof eval("tObj."+path)!="undefined"){retValue=eval("tObj."+path)}return retValue};klib.findSafe=klib.locateSafe=klib.valueOfKeyPath=function(obj,pathStr,def){for(var i=0,path=klib.toDottedPath(pathStr).split("."),len=path.length;i<len;i++){if(!obj||typeof obj=="undefined"){return def}obj=obj[path[i]]}if(typeof obj=="undefined"){return def}return obj};klib.has=klib.hasKey=function(obj,path){var tObj=obj,retValue=false;try{retValue=(typeof eval("tObj."+path)!="undefined")}catch(e){}return retValue};klib.hasIgnoreCase=klib.hasKeyIgnoreCase=function(obj,pathStr){var retValue="",tObj=obj||{},lookupPath=""+klib.toDottedPath((pathStr));var objKeys=klib.keysDottedAll(tObj);if(objKeys&&!_.isEmpty(objKeys)){klib.console.debug(objKeys);_.some(objKeys,function(oKey){var isMatch=oKey.equalsIgnoreCase(lookupPath);if(!isMatch){isMatch=oKey.beginsWithStrIgnoreCase(lookupPath+".");if(isMatch){oKey=oKey.slice(0,oKey.lastIndexOf("."))}}if(isMatch){retValue=oKey}return(isMatch)})}return retValue};klib.findIgnoreCase=function(obj,path,ifNot){var retValue=ifNot;var keyInObj=klib.hasIgnoreCase(obj,path);if(keyInObj){retValue=klib.findSafe(obj,keyInObj,ifNot)}return retValue};klib.keysDottedAll=function(a){var objKeys=klib.keysDotted(a);if(objKeys&&!_.isEmpty(objKeys)){objKeys=klib.toDottedPath(objKeys.join(",")).split(",")}return objKeys};klib.keysDotted=function(a){a=a||{};var list=[],xConnectorB,xConnectorE,curKey;(function(o,r){r=r||"";if(typeof o!="object"){return true}for(var c in o){curKey=r.substring(1);xConnectorB=(klib.isNumber(c))?"[":".";xConnectorE=(((curKey)&&(xConnectorB=="["))?"]":"");if(arguments.callee(o[c],r+xConnectorB+c+xConnectorE)){list.push((curKey)+(((curKey)?xConnectorB:""))+c+(xConnectorE))}}return false})(a);return list};klib.keysCamelCase=function(a){return(_.map(klib.keysDotted(a),function(name){var newName=(name).replace(/\./g," ").toProperCase().replace(/ /g,"");return(newName[0].toLowerCase()+newName.substring(1))}))};klib.keysTitleCase=function(a){return(_.map(klib.keysDotted(a),function(name){return((name).replace(/\./g," ").toProperCase().replace(/ /g,""))}))};klib.keys_=function(a){return(_.map(klib.keysDotted(a),function(name){return((name).replace(/\./g,"_"))}))};$.cachedScript=function(url,options){options=$.extend(options||{},{dataType:"script",cache:true,url:url});klib.console.info("$.cachedScript('"+url+"')");return $.ajax(options)};$.cachedStyle=function(styleId,url,options){options=$.extend(options||{},{dataType:"text",cache:true,url:url,success:function(cssStyles){$("head").append("<style id='"+(styleId)+"' type='text/css'>"+cssStyles+"</style>")}});klib.console.info("$.cachedScript('"+url+"')");return $.ajax(options)};klib.addScript=function(scriptId,scriptSrc){scriptId=scriptId.replace(/#/,"");klib.console.group("kAddScript");if(!klib.isElementExist("#kScriptsCotainer")){klib.console.info("#kScriptsCotainer NOT Found! Creating one...");$("body").append("<div id='kScriptsCotainer' style='display:none' rel='Dynamic Scripts Container'></div>")}if(klib.isElementExist("#"+scriptId)){klib.console.info("script ["+scriptId+"] already found in local.")}else{klib.console.info("script ["+scriptId+"] NOT found. Added script tag with src ["+scriptSrc+"]");$("#kScriptsCotainer").append("<script id='"+(scriptId)+"' type='text/javascript' src='"+scriptSrc+"'><\/script>")}klib.console.groupEnd("kAddScript")};klib.addStyle=function(styleId,styleSrc){styleId=styleId.replace(/#/,"");klib.console.group("kAddStyle");if(!klib.isElementExist("#kStylesCotainer")){klib.console.info("#kStylesCotainer NOT Found! Creating one...");$("body").append("<div id='kStylesCotainer' style='display:none' rel='Dynamic Styles Container'></div>")}if(klib.isElementExist("#"+styleId)){klib.console.info("style ["+styleId+"] already found in local.")}else{klib.console.info("style ["+styleId+"] NOT found. Added link tag with href ["+styleSrc+"]");$("#kStylesCotainer").append("<link id='"+(styleId)+"' rel='stylesheet' type='text/css' href='"+styleSrc+"'/>")}klib.console.groupEnd("kAddStyle")};klib.loadScript=function(scriptId,scriptPath,useScriptTag,tAjaxRequests){scriptId=scriptId.replace(/#/,"");useScriptTag=useScriptTag||false;tAjaxRequests=tAjaxRequests||[];klib.console.group("kScriptsLoad");if(klib.isBlank(scriptPath)){klib.console.error("script path ["+scriptPath+"] for ["+scriptId+"] NOT defined.")}else{if(useScriptTag){klib.addScript(scriptId,scriptPath)}else{tAjaxRequests.push($.cachedScript(scriptPath).done(function(script,textStatus){klib.console.info("Loaded script ["+scriptId+"] from ["+scriptPath+"]. STATUS: "+textStatus)}))}}klib.console.groupEnd("kScriptsLoad");return(tAjaxRequests)};klib.loadStyle=function(styleId,stylePath,useStyleTag,tAjaxRequests){styleId=styleId.replace(/#/,"");useStyleTag=useStyleTag||false;tAjaxRequests=tAjaxRequests||[];klib.console.group("kStylesLoad");if(klib.isBlank(stylePath)){klib.console.error("style path ["+stylePath+"] for ["+styleId+"] NOT defined.")}else{if(useStyleTag){klib.addStyle(styleId,stylePath)}else{tAjaxRequests.push($.cachedStyle(styleId,stylePath).done(function(style,textStatus){klib.console.info("Loaded style ["+styleId+"] from ["+stylePath+"]. STATUS: "+textStatus)}))}}klib.console.groupEnd("kStylesLoad");return(tAjaxRequests)};klib.addTemplateScript=function(tmplId,tmplBody,tmplType){tmplId=tmplId.replace(/#/,"");if(!klib.isElementExist("#kViewTemplateCotainer")){klib.console.info("#kViewTemplateCotainer NOT Found! Creating one...");$("body").append("<div id='kViewTemplateCotainer' style='display:none' rel='Template Container'></div>")}klib.console.info("Adding <script id='"+(tmplId)+"' type='text/"+tmplType+"'>");tmplBody=tmplBody.replace(/<( )*script/gi,"<_SCRIPTTAGINTEMPLATE_").replace(/<( )*(\/)( )*script/gi,"</_SCRIPTTAGINTEMPLATE_").replace(/<( )*link/gi,"<_LINKTAGINTEMPLATE_").replace(/<( )*(\/)( )*link/gi,"</_LINKTAGINTEMPLATE_");$("#kViewTemplateCotainer").append("<script id='"+(tmplId)+"' type='text/"+tmplType+"'>"+tmplBody+"<\/script>")};klib.loadTemplate=function(tmplId,tmplPath,templateType,viewContainerId,tAjaxRequests,tmplReload){tmplId=tmplId.replace(/#/g,"");tmplPath=(tmplPath.ifBlankStr("inline")).trimStr();templateType=templateType||"x-template";viewContainerId=viewContainerId||"#DummyInlineTemplateContainer";tAjaxRequests=tAjaxRequests||[];klib.console.group("kTemplateAjaxQue");if(!klib.isElementExist("#"+tmplId)){klib.console.info("Template["+tmplId+"] of ["+templateType+"] NOT found. Source ["+tmplPath+"]");if((tmplPath.equalsIgnoreCase("inline")||tmplPath.beginsWithStr("#"))){var localTemplateSrcContainerId=tmplPath.equalsIgnoreCase("inline")?viewContainerId:tmplPath;var $localTemplateSrcContainer=$(localTemplateSrcContainerId);var inlineTemplateHTML=$localTemplateSrcContainer.html();if(klib.isBlank(inlineTemplateHTML)){klib.console.error("Template["+tmplId+"] of ["+templateType+"] NOT defined inline in ["+localTemplateSrcContainerId+"].")}else{klib.addTemplateScript(tmplId,inlineTemplateHTML,templateType);if(tmplPath.equalsIgnoreCase("inline")){$localTemplateSrcContainer.html("")}}}else{if(tmplPath.equalsIgnoreCase("none")){klib.console.warn("Template["+tmplId+"] of ["+templateType+"] defined as NONE. Ignoring template.")}else{if(!tmplPath.equalsIgnoreCase("script")){var axTemplateRequest;if(tmplReload){klib.console.warn(">>>>>>>>>> Making New Template Request");axTemplateRequest=$.ajax({url:tmplPath,cache:false,dataType:"html",success:function(template){klib.addTemplateScript(tmplId,template,templateType);klib.console.info("Loaded Template["+tmplId+"] of ["+templateType+"] from ["+tmplPath+"]")},error:function(jqXHR,textStatus,errorThrown){klib.console.error("Failed Loading Template["+tmplId+"] of ["+templateType+"] from ["+tmplPath+"]. ["+textStatus+":"+errorThrown+"]")}})}else{axTemplateRequest=$.get(tmplPath,function(template){klib.addTemplateScript(tmplId,template,templateType);klib.console.info("Loaded Template["+tmplId+"] of ["+templateType+"] from ["+tmplPath+"]")},"html")}tAjaxRequests.push(axTemplateRequest)}else{klib.console.error("Template["+tmplId+"] of ["+templateType+"] NOT defined in <script>.")}}}}else{var $tmplId=$("#"+tmplId);if(tmplReload){klib.console.warn("Reload Template["+tmplId+"] of ["+templateType+"]");$tmplId.remove();tAjaxRequests=klib.loadTemplate(tmplId,tmplPath,templateType,viewContainerId,tAjaxRequests,tmplReload)}else{if(klib.isBlank(($tmplId.html()))){klib.console.warn("Template["+tmplId+"] of ["+templateType+"] script found EMPTY!");var externalPath=""+$tmplId.attr("path");if(!klib.isBlank((externalPath))){templateType=((($tmplId.attr("type")||"").ifBlankStr(templateType)).toLowerCase()).replace(/text\//gi,"");klib.console.info("prepare/remove to re-load Template["+tmplId+"]  of ["+templateType+"] from external path: ["+externalPath+"]");$tmplId.remove();tAjaxRequests=klib.loadTemplate(tmplId,externalPath,templateType,viewContainerId,tAjaxRequests,tmplReload)}}else{klib.console.info("Template["+tmplId+"]  of ["+templateType+"] already found in local.")}}}klib.console.groupEnd("kTemplateAjaxQue");return(tAjaxRequests)};klib.loadTemplatesCollection=function(templateCollectionId,dataTemplatesCollectionUrl){templateCollectionId=(templateCollectionId.beginsWithStr("#")?"":"#")+templateCollectionId;var retValue={};if(!klib.isElementExist(templateCollectionId)){klib.console.info(templateCollectionId+" NOT Found! Creating one...");if(!klib.isElementExist("#kViewTemplateCotainer")){klib.console.info("#kViewTemplateCotainer NOT Found! Creating one...");$("body").append("<div id='kViewTemplateCotainer' style='display:none' rel='Template Container'></div>")}$("#kViewTemplateCotainer").append("<div id='"+(templateCollectionId.substring(1))+"' style='display:none' rel='Template Collection Container'></div>");$.ajax({url:dataTemplatesCollectionUrl,cache:true,dataType:"html",async:false,success:function(result){$(templateCollectionId).html(result);klib.console.info("Loaded Template Collection ["+templateCollectionId+"] from ["+dataTemplatesCollectionUrl+"]");klib.console.info("Found following templates in Template Collection.");$(templateCollectionId+" script").each(function(index,element){retValue[$(element).attr("id")]="script"});klib.console.info({o:retValue})},error:function(jqXHR,textStatus,errorThrown){klib.console.error("Failed Loading Template Collection ["+templateCollectionId+"] from ["+dataTemplatesCollectionUrl+"]. ["+textStatus+":"+errorThrown+"]")}})}else{klib.console.info(templateCollectionId+" Found! skip template collection load from "+dataTemplatesCollectionUrl)}return(retValue)};klib.urlParams=function(urlQuery){urlQuery=(urlQuery||window.location.search||"");urlQuery=(urlQuery.beginsWithStr("\\?")||urlQuery.indexOf("//")<7)?urlQuery.substr(urlQuery.indexOf("?")+1):urlQuery;var qParams={};urlQuery.replace(/([^&=]+)=?([^&]*)(?:&+|$)/g,function(match,key,value){(qParams[key]=qParams[key]||[]).push(decodeURIComponent(value))});_.each(qParams,function(value,key){qParams[key]=(_.isArray(value)&&value.length==1)?value[0]:value});return qParams};klib.urlParam=function(name,queryString){return(klib.urlParams(queryString)[name])};klib.getLocHash=function(){return window.location.hash||""};klib.urlHash=function(returnOf,hashDelimiter){var retValue=(klib.getLocHash()||"#").substring(1);if(returnOf){hashDelimiter=hashDelimiter||"/";retValue=retValue.beginsWithStr(hashDelimiter)?retValue.substring(retValue.indexOf(hashDelimiter)+(hashDelimiter.length)):retValue;var hashArray=retValue.split(hashDelimiter);if(_.isNumber(returnOf)){retValue=(hashArray&&hashArray.length>returnOf)?hashArray[returnOf]:""}else{if(_.isArray(returnOf)){retValue=(returnOf.length===0)?hashArray:_.object(returnOf,hashArray)}else{if(_.isString(returnOf)&&returnOf=="?"){retValue=(retValue.containsStr("\\?"))?klib.getOnSplit(retValue,"?",1):""}}}}return retValue};klib.hashParam=function(name){var retValue=(""+klib.urlHash("?"));if(typeof name!=="undefined"&&!klib.isBlank(retValue)){retValue=klib.urlParam((""+name),retValue)}return(retValue)};klib.routeMatch=function(routePattern,urlHash){var rxParamMatcher=new RegExp(":[a-zA-Z0-9\\_\\-]+","g"),routeMatcher=new RegExp(routePattern.replace(rxParamMatcher,"([\\w\\+\\-\\|\\.\\?]+)")),_keysSrc=routePattern.match(rxParamMatcher),_values=urlHash.match(routeMatcher),_matchResult=(_values&&!_.isEmpty(_values))?_values.shift():"",_keys=(_keysSrc&&!_.isEmpty(_keysSrc))?_keysSrc.join(",").replace(/:/g,"").split(","):[],_values=(_values&&!_.isEmpty(_values))?_values.join(",").replace(/\?/g,"").split(","):[],retValue=undefined;if(_matchResult){retValue={hkeys:_keysSrc,params:_.zipObject(_keys,_values)}}return(retValue)};klib.i18n={};klib.i18n.loaded=false;klib.i18n.settings={name:"Language",path:"language/",encoding:"UTF-8",cache:true,mode:"map",callback:null};klib.i18n.setLanguage=function(lang,i18nSettings){if($.i18n){lang=lang||($.i18n.browserLang()).replace(/-/g,"_");i18nSettings=$.extend(klib.i18n.settings,i18nSettings);$.i18n.properties({name:i18nSettings.name,language:lang,path:i18nSettings.path,encoding:i18nSettings.encoding,cache:i18nSettings.cache,mode:i18nSettings.mode,callback:function(){$.i18n.loaded=(typeof $.i18n.loaded=="undefined")?(!$.isEmptyObject($.i18n.map)):$.i18n.loaded;klib.i18n.loaded=klib.i18n.loaded||$.i18n.loaded;if((lang.length>1)&&(!$.i18n.loaded)){klib.console.warn("Error Loading Language File ["+lang+"]. Loading default.");klib.i18n.setLanguage("_",i18nSettings)}klib.i18n.apply();if(i18nSettings.callback){i18nSettings.callback($.i18n.loaded)}}})}};klib.i18n.text=function(i18nKey,data){var dMessage=$.i18n.prop(i18nKey);if(data){var msgParamValue="";_.each(_.keys(data),function(key){msgParamValue=""+data[key];if(msgParamValue&&msgParamValue.beginsWithStrIgnoreCase("i18n:")){msgParamValue=$.i18n.prop(msgParamValue.replace(/i18n:/gi,""))}dMessage=dMessage.replace(new RegExp("{"+key+"}","gi"),msgParamValue)})}return dMessage};klib.i18n.apply=klib.i18n.render=function(contextRoot,elSelector){if(klib.i18n.loaded){contextRoot=contextRoot||"body";elSelector=elSelector||"";$(elSelector+"[data-i18n]",contextRoot).each(function(indes,el){var i18nSpec=klib.toJSON($(el).data("i18n")||"{}");var i18nData=i18nSpec.i18ndata;if(i18nData){delete i18nSpec.i18ndata}if(i18nSpec&&!$.isEmptyObject(i18nSpec)){_.each(_.keys(i18nSpec),function(attrSpec){var i18nKey=i18nSpec[attrSpec];var i18nValue=klib.i18n.text(i18nKey,i18nData);_.each(attrSpec.split("_"),function(attribute){switch(attribute.toLowerCase()){case"html":$(el).html(i18nValue);break;case"text":$(el).text(i18nValue);break;default:$(el).attr(attribute,i18nValue);break}})})}})}};klib.extendBackbone=function(){if(window.Backbone){klib.console.info("Found Backbone. Extending ...");_.extend(Backbone.Model.prototype,Backbone.Events,{activeCRUD:"",diffAttributes:function(dOptions){return(window.jsondiffpatch)?jsondiffpatch.diff(this.previousAttributes(),this.toJSON(),dOptions):this.changedAttributes()},sync:function(){this.activeCRUD=arguments[0];return Backbone.sync.apply(this,arguments)},url:function(){var baseURL,ajaxURL,qryParams,kURLs,paramName;var urlRoot=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(urlRoot){kURLs=(typeof urlRoot==="object")?urlRoot:{defaulturl:urlRoot};kURLs.patch=kURLs.patch||kURLs.update;baseURL=_.result(kURLs,this.activeCRUD.toLowerCase()+"url")||_.result(kURLs,"defaulturl")||urlError();ajaxURL=(baseURL.replace(/\{crud\}/gi,this.activeCRUD.toUpperCase()).replace(/\{now\}/gi,klib.now()))+((this.isNew()||(baseURL.indexOf("?")>0))?"":((((baseURL.charAt(baseURL.length-1)==="/")?"":"/")+encodeURIComponent(this.id))));while((qryParams=ajaxURL.match(/{([\s\S]*?)}/g))&&qryParams&&qryParams[0]){paramName=qryParams[0].replace(/[{}]/g,"");ajaxURL=ajaxURL.replace(new RegExp(qryParams[0],"g"),((paramName.indexOf(".")>=0)?klib.find(this.toJSON(),paramName):this.get(paramName))||"")}}klib.console.info("Backbone Sync Url: "+ajaxURL);return(ajaxURL)}})}else{klib.console.warn("Backbone not found. NOT extending...")}};klib.loadBackboneModelClass=function(bbModelClassUrl,options){options||(options={});var retValue={url:bbModelClassUrl,bbclass:Backbone.Model.extend({defaults:{}}),success:false};$.ajax({url:retValue.url,dataType:"text",async:false,success:function(result){result=result.substring(result.indexOf("{"));retValue.bbclass=Backbone.Model.extend(klib.toJSON(result));retValue.success=true;if(options.success){options.success(result)}},error:function(jqXHR,textStatus,errorThrown){klib.console.error("Failed loading backbone class from ["+(retValue.url)+"]. ["+textStatus+":"+errorThrown+"]");if(options.fail){options.fail(retValue.url,jqXHR,textStatus,errorThrown)}}});return(retValue)};klib.getModifiedElement=function(elSelector){var modified,modifiedEl=undefined;var $elements=$(elSelector||"form:not([data-ignore-change]) :input:not(:disabled,:button,[data-ignore-change])");_.every($elements,function(element){if(!modified){if((element.tagName.match(/^(select|textarea)$/i))&&(element.value!=element.defaultValue)){modified=true}else{if(element.tagName.match(/^input$/i)){if(element.type.match(/^(checkbox|radio)$/i)&&element.checked!=element.defaultChecked){modified=true}else{if(element.type.match(/^(text|password|hidden|color|email|month|number|tel|time|url|range|date|datetime|datetime-local)$/i)&&element.value!=element.defaultValue){modified=true}}}}if(modified){modifiedEl=element}}return(!modified)});return(modifiedEl)};klib.getModifiedElements=function(elSelector){var modified,modifiedEls=[];var $elements=$(elSelector||"form:not([data-ignore-change]) :input:not(:disabled,:button,[data-ignore-change])");$elements.each(function(index,element){modified=false;if((element.tagName.match(/^(select|textarea)$/i))&&(element.value!=element.defaultValue)){modified=true}else{if(element.tagName.match(/^input$/i)){if(element.type.match(/^(checkbox|radio)$/i)&&element.checked!=element.defaultChecked){modified=true}else{if(element.type.match(/^(text|password|hidden|color|email|month|number|tel|time|url|range|date|datetime|datetime-local)$/i)&&element.value!=element.defaultValue){modified=true}}}}if(modified){modifiedEls.push(element)}});return(modifiedEls)};klib.initTrackElValueChanges=klib.resetElementsDefaultValue=function(elSelector){$(elSelector||"form :input:not(:disabled)").each(function(index,element){element.defaultValue=element.value;if((element.tagName.match(/^input$/i))&&(element.type.match(/^(checkbox|radio)$/i)&&element.checked!=element.defaultChecked)){element.defaultChecked=element.checked}})};klib.trash={container:[],push:function(junk){this.container.push(junk)},empty:function(){this.container=[]},pick:function(tIndex){return((tIndex)?this.container[tIndex]:this.container)}};klib.fillData=function(data,context,options){var ready2Fill=((typeof data)=="object");if(context&&((typeof context)=="object")){options=context;context=null}context=context||"body";var fillOptions={dataParams:{},dataCache:false,keyFormat:"aBc",selectPattern:"[name='?']",formatterCommon:null,formatterOnKeys:null,resetElDefault:true,resetElDefaultInContext:true,keysMap:{}};$.extend(fillOptions,options);if(!ready2Fill){$.ajax({url:data,data:fillOptions.dataParams,cache:fillOptions.dataCache,dataType:"text",async:false,success:function(result){data=klib.toJSON(result);ready2Fill=((typeof data)=="object")},error:function(jqXHR,textStatus,errorThrown){klib.console.error("Failed loading data from ["+data+"]. ["+textStatus+":"+errorThrown+"]")}})}if(ready2Fill){var keyFormat=fillOptions.keyFormat;keyFormat=(keyFormat.match(/^[a-z]/)!=null)?"aBc":keyFormat;keyFormat=(keyFormat.match(/^[A-Z]/)!=null)?"AbC":keyFormat;var dataKeys=klib.keysDotted(data);klib.console.group("fillData");klib.console.info(dataKeys);_.each(dataKeys,function(dataKeyPath){klib.console.group(">>"+dataKeyPath);var dataKey=""+(dataKeyPath.replace(/[\[\]]/g,"_")||"");var dataKeyForFormatterFnSpec=dataKeyPath.replace(/\[[0-9]+\]/g,"");var isArrayKey=(/\[[0-9]+\]/).test(dataKeyPath);switch(keyFormat){case"_":dataKey=klib.dotToX(dataKey,"_");dataKeyForFormatterFnSpec=klib.dotToX(dataKeyForFormatterFnSpec,"_");break;case"AbC":dataKey=klib.dotToTitleCase(dataKey);dataKeyForFormatterFnSpec=klib.dotToTitleCase(dataKeyForFormatterFnSpec);break;default:dataKey=klib.dotToCamelCase(dataKey);dataKeyForFormatterFnSpec=klib.dotToCamelCase(dataKeyForFormatterFnSpec);break}var debugInfo={patternKey:dataKey+(isArrayKey?(" || "+dataKeyForFormatterFnSpec):""),formatterKey:dataKeyForFormatterFnSpec,isArrayChild:isArrayKey};klib.trash.push(debugInfo);klib.console.info(debugInfo);klib.trash.empty();var elSelector=(fillOptions.selectPattern).replace(/\?/g,dataKey);if(fillOptions.keysMap[dataKey]||fillOptions.keysMap[dataKeyForFormatterFnSpec]){fillOptions.keysMap[dataKey]=fillOptions.keysMap[dataKey]||{};fillOptions.keysMap[dataKeyForFormatterFnSpec]=fillOptions.keysMap[dataKeyForFormatterFnSpec]||{};fillOptions.keysMap[dataKey].pattern=fillOptions.keysMap[dataKey].pattern||fillOptions.keysMap[dataKeyForFormatterFnSpec].pattern;if(fillOptions.keysMap[dataKey].pattern){elSelector=(fillOptions.keysMap[dataKey].pattern).replace(/\?/g,dataKey)}if(fillOptions.keysMap[dataKeyForFormatterFnSpec].formatter){fillOptions.formatterOnKeys=fillOptions.formatterOnKeys||{};fillOptions.formatterOnKeys[dataKeyForFormatterFnSpec]=fillOptions.keysMap[dataKeyForFormatterFnSpec].formatter}}klib.console.info(">> "+elSelector+" found: "+$(elSelector,context).length);var dataValue=null;if($(elSelector,context).length>0){dataValue=klib.find(data,dataKeyPath);if((!fillOptions.formatterOnKeys)&&(fillOptions.formatterCommon)){dataValue=fillOptions.formatterCommon(dataValue,dataKeyPath,data)}if(fillOptions.formatterOnKeys){if(fillOptions.formatterOnKeys[dataKeyForFormatterFnSpec]){dataValue=fillOptions.formatterOnKeys[dataKeyForFormatterFnSpec](dataValue,dataKeyPath,data)}else{if(fillOptions.formatterCommon){dataValue=fillOptions.formatterCommon(dataValue,dataKeyPath,data)}}}klib.console.info({value:dataValue})}$(elSelector,context).each(function(index,el){klib.console.info(el);switch((el.tagName).toUpperCase()){case"INPUT":switch((el.type).toLowerCase()){case"text":case"password":case"hidden":case"color":case"date":case"datetime":case"datetime-local":case"email":case"month":case"number":case"search":case"tel":case"time":case"url":case"range":case"button":case"submit":case"reset":$(el).val(dataValue);if(!fillOptions.resetElDefaultInContext&&fillOptions.resetElDefault){el.defaultValue=el.value}break;case"checkbox":case"radio":el.checked=(el.value).equalsIgnoreCase(dataValue);if(!fillOptions.resetElDefaultInContext&&fillOptions.resetElDefault){el.defaultChecked=el.checked}break}break;case"SELECT":klib.selectOptionForValue(el,dataValue);if(!fillOptions.resetElDefaultInContext&&fillOptions.resetElDefault){el.defaultValue=el.value}break;case"TEXTAREA":$(el).val(dataValue);if(!fillOptions.resetElDefaultInContext&&fillOptions.resetElDefault){el.defaultValue=el.value}break;default:$(el).html(dataValue);break}});klib.console.groupEnd(">>"+dataKeyPath)});klib.console.groupEnd("fillData");if(fillOptions.resetElDefaultInContext){klib.resetElementsDefaultValue(context+" :input")}}};klib.toRenderDataStructure=function(saoDataUrl,soParams){var retObj={},dataCollection={},itemUrl={},oParams={};if(soParams){oParams=(_.isString(soParams))?klib.queryStringToJson(soParams):((_.isObject(soParams))?soParams:{})}switch(true){case (_.isString(saoDataUrl)):if(saoDataUrl.containsStr("\\|")){retObj.dataModel=klib.getOnSplit(saoDataUrl,"|",0);saoDataUrl=klib.getOnLastSplit(1)}retObj.dataUrl=saoDataUrl;if(!_.isEmpty(oParams)){retObj.dataParams=oParams}break;case (_.isArray(saoDataUrl)):dataCollection={urls:[]};itemUrl={};_.each(saoDataUrl,function(apiUrl,urlIndex){itemUrl={url:apiUrl,params:oParams};if(apiUrl.containsStr("\\|")){itemUrl.target=klib.getOnSplit(apiUrl,"|",0);itemUrl.url=klib.getOnLastSplit(1)}dataCollection.urls.push(itemUrl)});break;case (_.isObject(saoDataUrl)):dataCollection={urls:[]};itemUrl={};_.each(_.keys(saoDataUrl),function(dName,kIndex){itemUrl={name:dName,url:saoDataUrl[dName],params:oParams};if(saoDataUrl[dName].containsStr("\\|")){itemUrl.target=klib.getOnSplit(saoDataUrl[dName],"|",0);itemUrl.url=klib.getOnLastSplit(1)}dataCollection.urls.push(itemUrl)});break}if(!_.isEmpty(dataCollection.urls)){retObj.dataCollection=dataCollection}return retObj};klib.viewModels={};klib.renderHistory={};klib.renderHistoryMax=0;klib.defaults={dataTemplateEngine:"handlebars"};klib.render=function(viewContainerId,uOptions){if(!arguments.length){return}if((arguments.length===1)&&(typeof viewContainerId==="object")){uOptions=_.merge({},viewContainerId);if(uOptions.hasOwnProperty("target")){viewContainerId=uOptions.target;delete uOptions.target}else{viewContainerId="dynRender_"+klib.now()+"_"+(klib.rand(1000,9999))}klib.render(viewContainerId,uOptions);return}if(uOptions){(function transOptions(opt){var keyMaps={template:"dataTemplate",templates:"dataTemplates",templateEngine:"dataTemplateEngine",templatesCache:"dataTemplatesCache",templatesCollectionUrl:"dataTemplatesCollectionUrl",scripts:"dataScripts",scriptsCache:"dataScriptsCache",styles:"dataStyles",stylesCache:"dataStylesCache",renderEngine:"dataRenderEngine",renderType:"dataRenderType",dataRenderCallBack:"dataRenderCallback",renderCallback:"dataRenderCallback",renderCallBack:"dataRenderCallback",callback:"dataRenderCallback",callBack:"dataRenderCallback",renderId:"dataRenderId"};_.forEach(keyMaps,function(value,key){if(opt.hasOwnProperty(key)){opt[value]=uOptions[key];delete opt[key]}})})(uOptions)}var retValue={id:"",view:{},model:{},cron:"",elDataAttr:{},iOptions:uOptions};var kAjaxRequestsQue=[];var doDeepRender=false;var foundViewContainer=klib.isElementExist(viewContainerId);if(foundViewContainer){retValue.elDataAttr=$(viewContainerId).data()}var kDefaultTemplateConfig={backbone:{engine:"underscore",template:"x-underscore-template"},hogan:{engine:"hogan",template:"x-hogan-template"},unknown:{engine:"unknown",template:"x-unknown-template"}};var noOfArgs=arguments.length;var useOptions=(noOfArgs>1);var useParamData=(useOptions&&uOptions.hasOwnProperty("data"));var dataFound=true;var kRVOptions={data:{},dataUrl:"",dataUrlErrorHandle:"",dataParams:{},dataModel:"",dataModelType:"",dataCache:false,dataCollection:{},dataTemplatesCollectionUrl:"",dataTemplates:{},dataTemplateEngine:"",dataTemplate:"",dataTemplatesCache:true,dataScripts:{},dataScriptsCache:true,dataStyles:{},dataStylesCache:true,dataRenderEngine:"",dataRenderCallback:"",dataRenderId:""};if(!foundViewContainer){if(!klib.isElementExist("#kRunTimeLoadContainer")){$("body").append("<div id='kRunTimeLoadContainer' style='display:none;'></div>")}$("#kRunTimeLoadContainer").append("<div id='"+viewContainerId.replace(/\#/gi,"")+"'></div>")}if(useOptions){var saveOptions=(uOptions.hasOwnProperty("saveOptions")&&uOptions.saveOptions);for(var key in uOptions){kRVOptions[key]=uOptions[key];if(saveOptions&&(!(key==="data"||key==="saveOptions"))){$(viewContainerId).data((""+((""+(_.at(""+key,4)||"")).toLowerCase())+key.slice(5)),klib.toStr(uOptions[key]))}}}var kRenderId=(""+$(viewContainerId).data("renderId")).replace(/undefined/,"");if(!klib.isBlank(kRVOptions.dataRenderId)){kRenderId=kRVOptions.dataRenderId}retValue.id=(kRenderId.ifBlankStr(("kRender"+(klib.now())+(klib.rand(1000,9999)))));var kRenderEngine=(""+$(viewContainerId).data("renderEngine")).replace(/undefined/,"");if(!klib.isBlank(kRVOptions.dataRenderEngine)){kRenderEngine=kRVOptions.dataRenderEngine}kRenderEngine=(kRenderEngine.ifBlankStr("unknown")).toLowerCase();var kRenderEngineKey=kRenderEngine;if(!kDefaultTemplateConfig.hasOwnProperty(kRenderEngineKey)){kRenderEngineKey="unknown";kRenderEngine+="-unknown"}var kTemplateType=kDefaultTemplateConfig[kRenderEngineKey].template;var kTemplateEngine=(""+$(viewContainerId).data("templateEngine")).replace(/undefined/,"");if(!klib.isBlank(kRVOptions.dataTemplateEngine)){kTemplateEngine=kRVOptions.dataTemplateEngine}if(klib.isBlank(kTemplateEngine)){if(kRenderEngineKey.equalsIgnoreCase("unknown")){kTemplateEngine=(klib.defaults.dataTemplateEngine||"handlebars")}else{kTemplateEngine=(kTemplateEngine.ifBlankStr(kDefaultTemplateConfig[kRenderEngineKey].engine)).toLowerCase()}}switch(kTemplateEngine){case"hogan":if(kRenderEngine=="unknown"){kRenderEngineKey=kRenderEngine=kTemplateEngine;kTemplateType=kDefaultTemplateConfig[kRenderEngineKey].template}break}var kBackboneModelOption={};var kViewDataModelType=(""+$(viewContainerId).data("modelType")).replace(/undefined/,"");if(!klib.isBlank(kRVOptions.dataModelType)){kViewDataModelType=kRVOptions.dataModelType}if(kViewDataModelType.beginsWithStrIgnoreCase("backbone:")){kBackboneModelOption=klib.toJSON(kViewDataModelType.substring(9));kViewDataModelType="backbone";if(kRenderEngine.equalsIgnoreCase("unknown")){kRenderEngine="backbone"}}kViewDataModelType=(kViewDataModelType.ifBlankStr()).toLowerCase();klib.console.group("kLoadingViewScripts");if(!(useOptions&&uOptions.hasOwnProperty("dataScriptsCache"))){var scriptsCacheInTagData=(""+$(viewContainerId).data("scriptsCache")).replace(/undefined/,"");if(!klib.isBlank(scriptsCacheInTagData)){kRVOptions.dataScriptsCache=scriptsCacheInTagData.toBoolean();klib.console.info("Override [data-scripts-cache] with [data-scripts-cache] option in tag-attribute: "+kRVOptions.dataScriptsCache)}}else{klib.console.info("Override [data-scripts-cache] with user option [dataScriptsCache]: "+kRVOptions.dataScriptsCache)}var vScriptsList=(""+$(viewContainerId).data("scripts")).replace(/undefined/,"");if(vScriptsList&&klib.isBlank((vScriptsList||"").replace(/[^:'\"]/g,""))){vScriptsList="'"+((vScriptsList).split(",").join("','"))+"'"}var vScripts=klib.toJSON(vScriptsList||"{}");if((!(_.isObject(kRVOptions.dataScripts)))&&(_.isString(kRVOptions.dataScripts))){vScriptsList=(kRVOptions.dataScripts||"").trimStr();if(klib.isBlank((vScriptsList||"").replace(/[^:'\"]/g,""))){vScriptsList="'"+((vScriptsList).split(",").join("','"))+"'"}kRVOptions.dataScripts=klib.toJSON(vScriptsList)}if(!$.isEmptyObject(kRVOptions.dataScripts)){vScripts=kRVOptions.dataScripts}if(_.isArray(vScripts)){_.remove(vScripts,function(item){return !item})}klib.console.info(vScripts);if(vScripts&&(!$.isEmptyObject(vScripts))){if(_.isArray(vScripts)){klib.console.info("Convert array of script(s) without scriptID to object with scriptID(s).");var newScriptsObj={};var dynScriptIDForContainer="__scripts_"+(viewContainerId.trimStr("#"))+"_";_.each(vScripts,function(scriptUrl,sIndex){klib.console.log(scriptUrl);if(scriptUrl){newScriptsObj[dynScriptIDForContainer+(sIndex)]=(""+scriptUrl)}});klib.console.info("Scripts(s) with scriptID(s).");klib.console.log(newScriptsObj);vScripts=(_.isEmpty(newScriptsObj))?{}:newScriptsObj}klib.console.info("External scripts to be loaded [cache:"+(kRVOptions.dataScriptsCache)+"] along with view container ["+viewContainerId+"] => "+JSON.stringify(vScripts));var vScriptsNames=_.keys(vScripts);klib.console.group("kLoadingScripts");_.each(vScriptsNames,function(scriptId){kAjaxRequestsQue=klib.loadScript(scriptId,vScripts[scriptId],kRVOptions.dataScriptsCache,kAjaxRequestsQue)});klib.console.info("External Scripts Loading Status: "+JSON.stringify(kAjaxRequestsQue));klib.console.groupEnd("kLoadingScripts")}else{klib.console.info("No scripts defined [data-scripts] in view container ["+viewContainerId+"] to load.")}klib.console.groupEnd("kLoadingViewScripts");$.when.apply($,kAjaxRequestsQue).then(function(){klib.console.info("External Scripts Loaded.")}).fail(function(){klib.console.error("External Scripts Loading Failed! Unexpected!? Check the Script Path/Network.")});klib.console.group("kDataModel");var dataModelName=(""+$(viewContainerId).data("model")).replace(/undefined/,""),viewDataModelName;if(!klib.isBlank(kRVOptions.dataModel)){dataModelName=kRVOptions.dataModel}var dataModelUrl=(""+$(viewContainerId).data("url")).replace(/undefined/,"");if(!klib.isBlank(kRVOptions.dataUrl)){dataModelUrl=kRVOptions.dataUrl}var isLocalDataModel=(useParamData||(dataModelUrl.beginsWithStrIgnoreCase("local:")));var defaultDataModelName=(dataModelUrl.beginsWithStrIgnoreCase("local:"))?dataModelUrl.replace(/local:/gi,""):"data";dataModelName=dataModelName.ifBlankStr(defaultDataModelName);viewDataModelName=dataModelName.replace(/\./g,"_");var kTemplateModelData={};if(useParamData){kTemplateModelData[viewDataModelName]=kRVOptions.data;klib.console.info("Loaded data model ["+dataModelName+"] from argument")}else{if(!(useOptions&&uOptions.hasOwnProperty("dataCache"))){var dataCacheInTagData=(""+$(viewContainerId).data("cache")).replace(/undefined/,"");if(!klib.isBlank(dataCacheInTagData)){kRVOptions.dataCache=dataCacheInTagData.toBoolean();klib.console.info("Override [data-cache] with [data-cache] option in tag-attribute: "+kRVOptions.dataCache)}}else{klib.console.info("Override [data-cache] with user option [dataCache]: "+kRVOptions.dataCache)}if(klib.isBlank(dataModelUrl)){kTemplateModelData[viewDataModelName]={};var dataModelCollection=(""+$(viewContainerId).data("collection")).replace(/undefined/,"");if(dataModelCollection){dataModelCollection=klib.toJSON(dataModelCollection)}if(!klib.isBlank(kRVOptions.dataCollection)){dataModelCollection=kRVOptions.dataCollection}if(_.isArray(dataModelCollection)){dataModelCollection={urls:dataModelCollection}}var dataModelUrls=dataModelCollection.urls;if(klib.isBlank(dataModelUrls)){klib.console.warn("Model Data ["+dataModelName+"] or [data-url] or [data-collection] NOT found! Check the arguments or html markup. Rendering with empty data {}.")}else{if(!_.isArray(dataModelUrls)){klib.console.warn("Invalid [data-urls].Check the arguments or html markup. Rendering with empty data {}.")}else{klib.console.info("Processing data-URLs");var dataIndexApi=0,defaultAutoDataNamePrefix=dataModelCollection.nameprefix||"data";_.each(dataModelUrls,function(dataApi){var defaultApiDataModelName=(defaultAutoDataNamePrefix+dataIndexApi),apiDataModelName=_.has(dataApi,"name")?((""+dataApi.name).replace(/[^a-zA-Z0-9]/gi,"")):(_.has(dataApi,"target")?(""+dataApi.target):defaultApiDataModelName),apiDataUrl=_.has(dataApi,"url")?dataApi.url:(_.has(dataApi,"path")?dataApi.path:"");if(apiDataModelName.containsStr(".")){apiDataModelName=_.last(apiDataModelName.split("."),1)}apiDataModelName=apiDataModelName.ifBlankStr(defaultApiDataModelName);klib.console.info("processing data-api for: "+apiDataModelName);klib.console.log(dataApi);if(apiDataUrl){kAjaxRequestsQue.push($.ajax({url:apiDataUrl,data:_.has(dataApi,"params")?dataApi.params:(_.has(dataApi,"data")?dataApi.data:{}),cache:_.has(dataApi,"cache")?dataApi.cache:kRVOptions.dataCache,dataType:"text",success:function(result){var targetApiData,targetDataModelName=_.has(dataApi,"target")?(""+dataApi.target):"",oResult=(""+result).toJSON();if(targetDataModelName.indexOf(".")>0){targetApiData=klib.hasKey(oResult,targetDataModelName)?klib.find(oResult,targetDataModelName):oResult}else{targetApiData=oResult.hasOwnProperty(targetDataModelName)?oResult[targetDataModelName]:oResult}if(kTemplateModelData[viewDataModelName][apiDataModelName]){kTemplateModelData[viewDataModelName][apiDataModelName]=[kTemplateModelData[viewDataModelName][apiDataModelName]];kTemplateModelData[viewDataModelName][apiDataModelName].push(targetApiData)}else{kTemplateModelData[viewDataModelName][apiDataModelName]=targetApiData}klib.console.info("Loaded data model ["+apiDataModelName+"] from ["+apiDataUrl+"]");var fnApiDataSuccess=dataApi.success||dataApi.onsuccess||dataApi.onSuccess;if(!fnApiDataSuccess){fnApiDataSuccess=dataModelCollection.success||dataModelCollection.onsuccess||dataModelCollection.onSuccess}if(fnApiDataSuccess){if(_.isFunction(fnApiDataSuccess)){fnApiDataSuccess(oResult,dataApi)}else{if(_.isString(fnApiDataSuccess)){eval("("+fnApiDataSuccess+"(oResult, dataApi))")}}}},error:function(jqXHR,textStatus,errorThrown){klib.console.warn("Error processing data-api ["+apiDataUrl+"]");var fnOnApiDataUrlErrorHandle=dataApi.error||dataApi.onerror||dataApi.onError;if(!fnOnApiDataUrlErrorHandle){fnOnApiDataUrlErrorHandle=dataModelCollection.error||dataModelCollection.onerror||dataModelCollection.onError;if((!fnOnApiDataUrlErrorHandle)&&(!klib.isBlank(kRVOptions.dataUrlErrorHandle))){fnOnApiDataUrlErrorHandle=kRVOptions.dataUrlErrorHandle}}if(fnOnApiDataUrlErrorHandle){if(_.isFunction(fnOnApiDataUrlErrorHandle)){fnOnApiDataUrlErrorHandle(jqXHR,textStatus,errorThrown)}else{if(_.isString(fnOnApiDataUrlErrorHandle)){eval("("+fnOnApiDataUrlErrorHandle+"(jqXHR, textStatus, errorThrown))")}}}}}))}else{klib.console.error("data-api-url not found. Please check the arguments or html markup. Skipped this data-api request")}dataIndexApi++})}}}else{if(dataModelUrl.beginsWithStrIgnoreCase("local:")){var localDataModelName=dataModelUrl.replace(/local:/gi,"");var localDataModelObj={};if(typeof eval("("+localDataModelName+")")!="undefined"){eval("(localDataModelObj="+localDataModelName+")")}klib.console.info("Using LOCAL Data Model: "+localDataModelName);if(klib.isBlank(kViewDataModelType)){if((!isLocalDataModel)&&(dataModelName.indexOf(".")>0)){kTemplateModelData[viewDataModelName]=klib.hasKey(localDataModelObj,dataModelName)?klib.find(localDataModelObj,dataModelName):localDataModelObj}else{kTemplateModelData[viewDataModelName]=localDataModelObj.hasOwnProperty(dataModelName)?localDataModelObj[dataModelName]:localDataModelObj}}else{klib.console.info("Local Data: "+localDataModelName+" not found.");if($.isEmptyObject(localDataModelObj)&&!$.isEmptyObject(kBackboneModelOption)){var bbClassUrl=kBackboneModelOption.classpath||"";if(!klib.isBlank(bbClassUrl)){if(bbClassUrl.beginsWithStrIgnoreCase("local:")){var bbClassLocal=bbClassUrl.substring(6);eval("( localDataModelObj = new "+bbClassLocal+"() )")}else{klib.console.info("loading Backbone Model Class from: "+(bbClassUrl)+".");var noop=function(){};var loadBackboneModelClassResult=klib.loadBackboneModelClass(bbClassUrl,{success:kBackboneModelOption.classsuccess||noop,fail:kBackboneModelOption.classerror||noop});localDataModelObj=new loadBackboneModelClassResult.bbclass();if(loadBackboneModelClassResult.success){if(kBackboneModelOption.defaults){localDataModelObj.set(kBackboneModelOption.defaults)}localDataModelObj.fetch({async:false,cache:false,success:kBackboneModelOption.fetchsuccess||noop,error:kBackboneModelOption.fetcherror||noop})}}eval("("+localDataModelName+"=localDataModelObj)");kTemplateModelData[viewDataModelName]=localDataModelObj.toJSON()}else{klib.console.error("Backbone 'classpath' NOT defined. Please check the 'dataModelType' option.")}}else{kTemplateModelData[viewDataModelName]=kViewDataModelType.equalsIgnoreCase("backbone")?localDataModelObj.toJSON():localDataModelObj}}}else{klib.console.info("Request Data ["+dataModelName+"] [cache:"+(kRVOptions.dataCache)+"] from URL =>"+dataModelUrl);kAjaxRequestsQue.push($.ajax({url:dataModelUrl,data:kRVOptions.dataParams,cache:kRVOptions.dataCache,dataType:"text",success:function(result){var oResult=(""+result).toJSON();if(dataModelName.indexOf(".")>0){kTemplateModelData[viewDataModelName]=klib.hasKey(oResult,dataModelName)?klib.find(oResult,dataModelName):oResult}else{kTemplateModelData[viewDataModelName]=oResult.hasOwnProperty(dataModelName)?oResult[dataModelName]:oResult}klib.console.info("Loaded data model ["+dataModelName+"] from ["+dataModelUrl+"]")},error:function(jqXHR,textStatus,errorThrown){var fnOnDataUrlErrorHandle=(""+$(viewContainerId).data("urlErrorHandle")).replace(/undefined/,"");if(!klib.isBlank(kRVOptions.dataUrlErrorHandle)){fnOnDataUrlErrorHandle=""+kRVOptions.dataUrlErrorHandle}if(!klib.isBlank(fnOnDataUrlErrorHandle)){eval("("+fnOnDataUrlErrorHandle+"(jqXHR, textStatus, errorThrown))")}}}))}}}klib.console.info("End of Data Processing");klib.console.log({o:kTemplateModelData});klib.console.groupEnd("kDataModel");if(dataFound){var vTemplate2RenderInTag=(""+$(viewContainerId).data("template")).replace(/undefined/,"");var vTemplatesList=(""+$(viewContainerId).data("templates")).replace(/undefined/,"");if(vTemplatesList&&klib.isBlank((vTemplatesList||"").replace(/[^:'\"]/g,""))){vTemplatesList="'"+((vTemplatesList).split(",").join("','"))+"'"}var vTemplates=klib.toJSON(vTemplatesList||"{}");if((!(_.isObject(kRVOptions.dataTemplates)))&&(_.isString(kRVOptions.dataTemplates))){vTemplatesList=(kRVOptions.dataTemplates||"").trimStr();if(klib.isBlank((vTemplatesList||"").replace(/[^:'\"]/g,""))){vTemplatesList="'"+((vTemplatesList).split(",").join("','"))+"'"}kRVOptions.dataTemplates=klib.toJSON(vTemplatesList)}if(!$.isEmptyObject(kRVOptions.dataTemplates)){vTemplates=kRVOptions.dataTemplates;vTemplatesList=""+(JSON.stringify(vTemplates))}if((_.isEmpty(klib.toJSON((vTemplatesList||"").trimStr())))||(_.isArray(vTemplates)&&vTemplates.length==1&&klib.isBlank(vTemplates[0]))){vTemplates={};vTemplatesList=""}klib.console.info("Templates:");klib.console.info(vTemplates);if(_.isArray(vTemplates)&&!_.isEmpty(vTemplates)){klib.console.info("Array of template(s) without templateID(s).");var newTemplatesObj={};var dynTmplIDForContainer="__tmpl_"+(viewContainerId.trimStr("#"))+"_";_.each(vTemplates,function(templateUrl,sIndex){klib.console.log(templateUrl);if(templateUrl){newTemplatesObj[dynTmplIDForContainer+(sIndex)]=(""+templateUrl)}});klib.console.info("Template(s) with template ID(s).");klib.console.log(newTemplatesObj);if(_.isEmpty(newTemplatesObj)){vTemplates={};vTemplatesList=""}else{vTemplates=newTemplatesObj;vTemplatesList=""+(JSON.stringify(vTemplates))}}if((!vTemplates)||($.isEmptyObject(vTemplates))){vTemplates={};var _dataTemplate=kRVOptions.dataTemplate,_tmplKey="",_tmplLoc="";if(klib.isBlank(_dataTemplate)){if(!klib.isBlank(vTemplate2RenderInTag)){klib.console.info("Template to load from location <"+vTemplate2RenderInTag+">");_dataTemplate=vTemplate2RenderInTag}}_dataTemplate=(_dataTemplate||"").trimStr();klib.console.info("Primary Template: <"+_dataTemplate+">");if(klib.isBlank(_dataTemplate)||_dataTemplate.equalsIgnoreCase("inline")||_dataTemplate.equals(".")){klib.console.info("Using target container (inline) content as template.");_tmplKey=("_tmplInline_"+(viewContainerId.trimStr("#")))}else{if(_dataTemplate.beginsWithStr("#")){klib.console.info("Using page container <"+_dataTemplate+"> content as template.");_tmplKey=_dataTemplate.trimStr("#")}else{klib.console.info("External path <"+_dataTemplate+"> content as template.");if(_dataTemplate.containsStr(":")&&!_dataTemplate.beginsWithStrIgnoreCase("http")){_tmplKey=klib.getOnSplit(_dataTemplate,":",0).replace(/[^a-z0-9]/gi,"");_tmplLoc=klib.getOnLastSplit(1)}else{_tmplKey=(("__tmpl_"+(viewContainerId.trimStr("#"))+"_")+(klib.now())+(klib.rand(1000,9999)));_tmplLoc=_dataTemplate}}}vTemplates[_tmplKey]=_tmplLoc.replace(/['\"]/g,"");klib.console.info(vTemplates)}klib.console.group("kView");var dataTemplatesCollectionUrl=(""+$(viewContainerId).data("templatesCollectionUrl")).replace(/undefined/,"");if(!klib.isBlank(kRVOptions.dataTemplatesCollectionUrl)){dataTemplatesCollectionUrl=kRVOptions.dataTemplatesCollectionUrl}if(!klib.isBlank(dataTemplatesCollectionUrl)){var templateCollectionId=viewContainerId+"_TemplatesCollection";klib.loadTemplatesCollection(templateCollectionId,dataTemplatesCollectionUrl)}if(vTemplates&&(!$.isEmptyObject(vTemplates))){klib.console.info("Templates of ["+kTemplateType+"] to be used in view container ["+viewContainerId+"] => "+JSON.stringify(vTemplates));var vTemplateNames=_.keys(vTemplates);klib.console.group("kLoadingTemplates");klib.console.group("kLoadingTemplatesCache");if(!(useOptions&&uOptions.hasOwnProperty("dataTemplatesCache"))){var templatesCacheInTagData=(""+$(viewContainerId).data("templatesCache")).replace(/undefined/,"");if(!klib.isBlank(templatesCacheInTagData)){kRVOptions.dataTemplatesCache=templatesCacheInTagData.toBoolean();klib.console.info("Override [data-templates-cache] with [data-templates-cache] option in tag-attribute: "+kRVOptions.dataTemplatesCache)}}else{klib.console.info("Override [data-templates-cache] with user option [dataTemplatesCache]: "+kRVOptions.dataTemplatesCache)}klib.console.groupEnd("kLoadingTemplatesCache");klib.console.info("Load Templates");klib.console.info(vTemplates);_.each(vTemplateNames,function(tmplId,tmplIndex){klib.console.info([tmplIndex,tmplId,vTemplates[tmplId],kTemplateType,viewContainerId]);kAjaxRequestsQue=klib.loadTemplate(tmplId,vTemplates[tmplId],kTemplateType,viewContainerId,kAjaxRequestsQue,!kRVOptions.dataTemplatesCache)});var vTemplate2RenderID="#"+(vTemplateNames[0].trimStr("#"));klib.console.info("External Data/Templates Loading Status: "+JSON.stringify(kAjaxRequestsQue));klib.console.groupEnd("kLoadingTemplates");klib.console.info("Render TemplateID: "+vTemplate2RenderID);klib.console.group("kLoadingViewStyles");if(!(useOptions&&uOptions.hasOwnProperty("dataStylesCache"))){var stylesCacheInTagData=(""+$(viewContainerId).data("stylesCache")).replace(/undefined/,"");if(!klib.isBlank(stylesCacheInTagData)){kRVOptions.dataStylesCache=stylesCacheInTagData.toBoolean();klib.console.info("Override [data-styles-cache] with [data-styles-cache] option in tag-attribute: "+kRVOptions.dataStylesCache)}}else{klib.console.info("Override [data-styles-cache] with user option [dataStylesCache]: "+kRVOptions.dataStylesCache)}var vStylesList=(""+$(viewContainerId).data("styles")).replace(/undefined/,"");if(vStylesList&&klib.isBlank((vStylesList||"").replace(/[^:'\"]/g,""))){vStylesList="'"+((vStylesList).split(",").join("','"))+"'"}var vStyles=klib.toJSON(vStylesList||"{}");if(!$.isEmptyObject(kRVOptions.dataStyles)){vStyles=kRVOptions.dataStyles}if(_.isArray(vStyles)){_.remove(vStyles,function(item){return !item})}if(vStyles&&(!$.isEmptyObject(vStyles))){if(_.isArray(vStyles)){klib.console.info("Convert array of style(s) without styleID to object with styleID(s).");var newStylesObj={};var dynStyleIDForContainer="__styles_"+(viewContainerId.trimStr("#"))+"_";_.each(vStyles,function(styleUrl,sIndex){klib.console.log(styleUrl);if(styleUrl){newStylesObj[dynStyleIDForContainer+(sIndex)]=(""+styleUrl)}});klib.console.info("Style(s) with styleID(s).");klib.console.log(newStylesObj);vStyles=(_.isEmpty(newStylesObj))?{}:newStylesObj}klib.console.info("External styles to be loaded [cache:"+(kRVOptions.dataStylesCache)+"] along with view container ["+viewContainerId+"] => "+JSON.stringify(vStyles));var vStylesNames=_.keys(vStyles);klib.console.group("kLoadingStyles");_.each(vStylesNames,function(styleId){kAjaxRequestsQue=klib.loadStyle(styleId,vStyles[styleId],kRVOptions.dataStylesCache,kAjaxRequestsQue)});klib.console.info("External Styles Loading Status: "+JSON.stringify(kAjaxRequestsQue));klib.console.groupEnd("kLoadingStyles")}else{klib.console.info("No styles defined [data-styles] in view container ["+viewContainerId+"] to load.")}klib.console.groupEnd("kLoadingViewStyles");$.when.apply($,kAjaxRequestsQue).then(function(){klib.console.group("kRender["+kRenderEngine+"*"+kTemplateEngine+"] - klib.renderHistory["+retValue.id+"]");klib.console.info("Rendering "+viewContainerId+" using master template: "+vTemplate2RenderID);$(viewContainerId).html("");try{retValue.model=kTemplateModelData[viewDataModelName];var kViewModel=kTemplateModelData[viewDataModelName],compiledTemplate;switch(kRenderEngine){case"backbone":if(!(isLocalDataModel&&(!klib.isBlank(kViewDataModelType)))){retValue.model=new Backbone.Model(retValue.model);kViewModel=retValue.model.toJSON()}break;default:if(isLocalDataModel&&(!klib.isBlank(kViewDataModelType))){switch(kViewDataModelType){case"backbone":kViewModel=retValue.model.toJSON();break}}break}klib.viewModels[retValue.id]=retValue.model;var templateContentToBindAndRender=($(vTemplate2RenderID).html()||"").replace(/_SCRIPTTAGINTEMPLATE_/g,"script").replace(/_LINKTAGINTEMPLATE_/g,"link");switch(kTemplateEngine){case"handlebar":case"handlebars":compiledTemplate=(Handlebars.compile(templateContentToBindAndRender))(kViewModel);break;case"underscore":compiledTemplate=(_.template(templateContentToBindAndRender))(kViewModel);break;case"underscore-as-mustache":var tSettings={interpolate:/\{\{(.+?)\}\}/g,escape:/\{\{\{(.+?)\}\}\}/g};compiledTemplate=_.template(templateContentToBindAndRender,kViewModel,tSettings);break;case"mustache":compiledTemplate=(Mustache.compile(templateContentToBindAndRender))(kViewModel);break;case"hogan":compiledTemplate=(Hogan.compile(templateContentToBindAndRender)).render(kViewModel);break;default:compiledTemplate=templateContentToBindAndRender;break}doDeepRender=false;switch(kRenderEngine){case"backbone":retValue.view=new (Backbone.View.extend({el:viewContainerId,render:function(){this.$el.html(compiledTemplate);return this}}));(retValue.view).render();doDeepRender=true;break;default:retValue.view=compiledTemplate;var targetRenderContainerType=((""+$(viewContainerId).data("renderType")).replace(/undefined/,"")).toLowerCase();if(!klib.isBlank(kRVOptions.dataRenderType)){targetRenderContainerType=kRVOptions.dataRenderType}switch(targetRenderContainerType){case"value":$(viewContainerId).val(retValue.view);break;case"text":$(viewContainerId).text(retValue.view);break;default:doDeepRender=true;$(viewContainerId).html(retValue.view);break}break}klib.console.info("Render: SUCCESS");var rhKeys=_.keys(klib.renderHistory);var rhLen=rhKeys.length;if(rhLen>klib.renderHistoryMax){$.each(rhKeys.splice(0,rhLen-(klib.renderHistoryMax)),function(index,key){delete klib.renderHistory[key]})}retValue.cron=""+klib.now();if(klib.renderHistoryMax>0){klib.renderHistory[retValue.id]=retValue}if(doDeepRender){klib.reflowFoundation(viewContainerId);klib.initKeyTracking();klib.i18n.apply(viewContainerId);klib.initRoutes(viewContainerId)}var _fnCallbackAfterRender=(""+$(viewContainerId).data("renderCallback")).replace(/undefined/,"");if(kRVOptions.dataRenderCallback){_fnCallbackAfterRender=kRVOptions.dataRenderCallback}var isCallbackDisabled=_fnCallbackAfterRender.equalsIgnoreCase("off");klib.console.info("Processing callback: "+_fnCallbackAfterRender);if(!isCallbackDisabled){if(isKHashRouteOn&&klib.routes&&klib.routes.hasOwnProperty("_renderCallback")&&_.isFunction(klib.routes._renderCallback)){klib.console.info("calling default callback: klib.routes._renderCallback");klib.routes._renderCallback.call(undefined,retValue)}if(_fnCallbackAfterRender){var fnCallbackAfterRender=_fnCallbackAfterRender;if(_.isString(fnCallbackAfterRender)){fnCallbackAfterRender=klib.findSafe(window,fnCallbackAfterRender)}if(fnCallbackAfterRender){if(_.isFunction(fnCallbackAfterRender)){klib.console.info("calling callback: "+_fnCallbackAfterRender);fnCallbackAfterRender.call(undefined,retValue)}else{klib.console.error("CallbackFunction <"+_fnCallbackAfterRender+" = "+fnCallbackAfterRender+"> is NOT a valid FUNCTION.")}}else{if((""+_fnCallbackAfterRender).beginsWithStr("klib")&&((""+_fnCallbackAfterRender).endsWithStr("_renderCallback"))){klib.console.warn("Default Route renderCallback function <"+_fnCallbackAfterRender+"> is NOT defined.")}else{klib.console.error("CallbackFunction <"+_fnCallbackAfterRender+"> is NOT defined.")}}}}if(doDeepRender){$(viewContainerId).find("[rel='kRender'],[data-render],[data-krender],[data-k-render]").kRender()}}catch(e){klib.console.error("Error Rendering: "+e.message)}klib.console.groupEnd("kRender["+kRenderEngine+"*"+kTemplateEngine+"] - klib.renderHistory["+retValue.id+"]")}).fail(function(){klib.console.error("External Data/Templates/Styles/Scripts Loading failed! Unexpected!! Check the template Path / Network. Rendering aborted.")}).done(klib.runOnceOnRender)}else{klib.console.error("No templates defined [data-templates] in view container ["+viewContainerId+"] to render. Check HTML markup.")}klib.console.groupEnd("kView")}return(retValue)};klib.hasAutoRoutes=function(routeHash,operator){var elSelector="[data-kroute-default]"+(routeHash?"[href"+(operator?operator:"")+"='"+routeHash+"']":"");return($(elSelector).length>0)};klib.routeCurLocHashAttemptDelaySec=3;klib.routeCurLocHashAttempt=0;klib.routeCurLocHash=function(){var curLocHash=(klib.getLocHash()||"").ifBlankStr(klib.routesOptions.defaultPageRoute);if(isKHashRouteOn&&curLocHash&&!klib.hasAutoRoutes(curLocHash)){klib.console.info("Route current url-hash.");if(!klib.route(curLocHash)){klib.console.warn("Current url-hash-route <"+curLocHash+"> FAILED and will try after "+klib.routeCurLocHashAttemptDelaySec+"sec.");if(klib.routeCurLocHashAttempt<5){klib.routeCurLocHashAttempt++;setTimeout(klib.routeCurLocHash,(klib.routeCurLocHashAttemptDelaySec*1000))}else{klib.console.error("5 attempts to route current url-hash failed. Aborting further attempts.")}}}};klib.finallyOnRender=[];klib.runOnceOnRenderFunctions=[klib.routeCurLocHash];klib.runOnceOnRender=function(){klib.console.info("Render Complete.");if((klib.runOnceOnRenderFunctions&&!_.isEmpty(klib.runOnceOnRenderFunctions))||(klib.finallyOnRender&&!_.isEmpty(klib.finallyOnRender))){if(!klib.runOnceOnRenderFunctions){klib.runOnceOnRenderFunctions=[]}if(!_.isArray(klib.runOnceOnRenderFunctions)){klib.runOnceOnRenderFunctions=[klib.runOnceOnRenderFunctions]}if(_.isArray(klib.runOnceOnRenderFunctions)){if(klib.finallyOnRender){if(!_.isArray(klib.finallyOnRender)){klib.finallyOnRender=[klib.finallyOnRender]}klib.runOnceOnRenderFunctions=klib.runOnceOnRenderFunctions.concat(klib.finallyOnRender)}_.each(klib.runOnceOnRenderFunctions,function(fn,index){if(_.isFunction(fn)){fn()}})}klib.finallyOnRender=klib.runOnceOnRenderFunctions=undefined}};klib.setElIdIfNot=function(el){var $el=$(el);if(klib.isBlank($el.attr("id"))){$el.attr("id",("_el_"+(klib.now())+"_"+klib.rand(1000,9999)))}return($el.attr("id"))};function __renderView(obj,opt){var retValue;var viewContainerId=klib.setElIdIfNot(obj);if((opt)&&(!$.isEmptyObject(opt))){retValue=klib.render("#"+viewContainerId,opt)}else{retValue=klib.render("#"+viewContainerId)}return retValue}klib.reflowFoundation=function(context){if("Foundation" in window){$(context||document).foundation("reflow")}};$.expr[":"].regex=function(elem,index,match){var matchParams=match[3].split(","),validLabels=/^(data|css):/,attr={method:matchParams[0].match(validLabels)?matchParams[0].split(":")[0]:"attr",property:matchParams.shift().replace(validLabels,"")},regexFlags="ig",regex=new RegExp(matchParams.join("").replace(/^\s+|\s+$/g,""),regexFlags);return regex.test($(elem)[attr.method](attr.property))};$.fn.extend({kRender:function(opt){this.each(function(){__renderView(this,opt)})}});$.extend({kRender:function(obj,opt){$(obj).kRender(opt)}});klib.initDataValidation=function(){klib.console.log("include validate framework lib (klib-validate.js) to use this feature!")};klib.doDataValidation=function(){klib.console.log("include validate framework lib (klib-validate.js) to use this feature!")};klib.properties={version:klib.VERSION};klib.routes={};klib.routesOptions={useHashRoute:true,usePatterns:true,defaultPageRoute:"",beforeRoute:"",defaultTemplateExt:".html",loadDefaultScript:true,defaultRouteTargetContainerIdPrefix:"routeContainer_",defaultRouteTemplateContainerIdPrefix:"template_"};klib.routePatterns={routes:[],register:undefined,deregister:undefined};klib.routePatterns.register=function(rPatternOptions,overwrite){if(rPatternOptions&&!_.isEmpty(rPatternOptions)){var pushRoutePattern=function(rOptions,_overwrite){if(_.has(rOptions,"pattern")){rOptions.pattern=rOptions.pattern.replace(/\?/g,"\\?");if(!_.has(rOptions,"name")){rOptions.name=rOptions.pattern.replace(/[^a-z0-9_]/gi,"")}if(!_.has(rOptions,"routeoptions")){rOptions.routeoptions={}}if(!_.find(klib.routePatterns.routes,{pattern:rOptions.pattern})){if(_.find(klib.routePatterns.routes,{name:rOptions.name})){if(_overwrite){klib.routePatterns.routes.push(rOptions)}}else{klib.routePatterns.routes.push(rOptions)}}}};if(_.isArray(rPatternOptions)){_.each(rPatternOptions,function(rOpt){pushRoutePattern(rOpt,overwrite)})}else{if(_.isObject(rPatternOptions)){pushRoutePattern(rPatternOptions,overwrite)}else{klib.console.error("Invalid RoutePattern Options. Provide Array/Object of RouteOptions")}}}else{klib.console.error("Empty RoutePattern Options.")}};klib.routePatterns.deregister=function(rNamesOrPatterns){if(rNamesOrPatterns&&!_.isEmpty(rNamesOrPatterns)){var removeRoutePattern=function(rNameOrPattern){if(rNameOrPattern){var indexOfNameOrPattern=_.findIndex(klib.routePatterns.routes,function(opt){return(opt.name==rNameOrPattern||opt.pattern==rNameOrPattern)});if(indexOfNameOrPattern>=0){_.pullAt(klib.routePatterns.routes,indexOfNameOrPattern)}else{klib.console.error("Route Pattern Not Found for <"+rNameOrPattern+">")}}};if(_.isArray(rNamesOrPatterns)){_.each(rNamesOrPatterns,function(rNorP){removeRoutePattern(rNorP)})}else{if(_.isString(rNamesOrPatterns)){removeRoutePattern(rNamesOrPatterns)}else{klib.console.error("Invalid RoutePattern Name/Pattern. Provide Array/Name of RouteNames/Patterns")}}}};klib.routeName=function(hashRoute){var _hashRoute=(hashRoute||klib.urlHash());if(_hashRoute.containsStr("\\?")){_hashRoute=_hashRoute.split("?")[0]}return(_hashRoute.trimLeftStr("#")).replace(/[^a-z0-9]/gi,"_")};klib.routeContainerId=function(hashRoute){var routeTargetContainerPrefix=((klib.routesOptions.defaultRouteTargetContainerIdPrefix).trimLeftStr("#"));return(routeTargetContainerPrefix+klib.routeName(hashRoute))};klib.routeTemplateId=function(hashRoute){var routeTargetContainerPrefix=((klib.routesOptions.defaultRouteTemplateContainerIdPrefix).trimLeftStr("#"));return(routeTargetContainerPrefix+klib.routeName(hashRoute))};klib.routeRender=function(elRouteBase,routeOptions){var $elRouteBase=(elRouteBase)?$(elRouteBase):undefined;var tagRouteOptions=($elRouteBase)?((""+$elRouteBase.data("kroute"))||""):("");if((tagRouteOptions.trimStr()).equalsIgnoreCase("false")||(tagRouteOptions.trimStr()).equalsIgnoreCase("no")||(tagRouteOptions.trimStr()).equalsIgnoreCase("off")){tagRouteOptions="quit:true"}var oTagRouteOptions=(tagRouteOptions)?klib.toJSON(tagRouteOptions):{};_.merge(oTagRouteOptions,routeOptions);if(oTagRouteOptions.hasOwnProperty("quit")&&(oTagRouteOptions.quit)){return}var routeNameWithPath="#RouteNotDefinedInHREF";if($elRouteBase){routeNameWithPath=$elRouteBase.attr("href")}else{if(routeOptions.urlhash){routeNameWithPath=routeOptions.urlhash["url"]}}routeNameWithPath=(routeNameWithPath).trimLeftStr("#");var routeParams="";if(routeNameWithPath.containsStr("\\?")){var _routeParts=routeNameWithPath.split("?");routeNameWithPath=_routeParts[0];routeParams=_routeParts[1]}var routeName=oTagRouteOptions.name||(klib.routeName(routeNameWithPath));if(klib.routes[routeName]){klib.routes[routeName]($elRouteBase,routeParams,oTagRouteOptions)}else{klib.console.info("Route method <klib.routes."+routeName+"> NOT FOUND. Attempting to route using [data-kroute] options.");var foundRouteTmplExt=(oTagRouteOptions.hasOwnProperty("ext")||oTagRouteOptions.hasOwnProperty("tmplext")||oTagRouteOptions.hasOwnProperty("tmplExt"));var renderTarget=""+((oTagRouteOptions.target||"").trimStr()),tmplExt=(foundRouteTmplExt)?(oTagRouteOptions.ext||oTagRouteOptions.tmplext||oTagRouteOptions.tmplExt):(klib.routesOptions.defaultTemplateExt||""),tmplEngine=oTagRouteOptions.tmplengine||oTagRouteOptions.tmplEngine||"",defaultTmplPath=(routeNameWithPath+tmplExt+"?"+routeParams).trimRightStr("\\?"),defaultScriptPath=routeNameWithPath+".js",defaultCallBeforeRoute="klib.routes."+routeName+"_before",defaultRenderCallback="klib.routes."+routeName+"_renderCallback",useTargetOptions=klib.findIgnoreCase(oTagRouteOptions,"usetargetoptions"),kRenderOptions={dataRenderCallback:defaultRenderCallback,rElRouteOptions:oTagRouteOptions,rElDataAttr:($elRouteBase)?$elRouteBase.data():{}};if(oTagRouteOptions.hasOwnProperty("template")&&!oTagRouteOptions.hasOwnProperty("templates")){oTagRouteOptions.templates=oTagRouteOptions.template;delete oTagRouteOptions.template}if(renderTarget.equalsIgnoreCase(".")){renderTarget="#"+klib.setElIdIfNot($elRouteBase)}else{if(klib.isBlank(renderTarget)){renderTarget=("#"+klib.routeContainerId(routeName))}}var foundRenderTarget=klib.isElementExist(renderTarget);klib.console.info("Render Target <"+renderTarget+">");if(oTagRouteOptions.hasOwnProperty("dataCache")){kRenderOptions.dataCache=oTagRouteOptions.dataCache}if(oTagRouteOptions.hasOwnProperty("templatesCache")){kRenderOptions.dataTemplatesCache=oTagRouteOptions.templatesCache}if(oTagRouteOptions.hasOwnProperty("scriptsCache")){kRenderOptions.dataScriptsCache=oTagRouteOptions.scriptsCache}kRenderOptions.dataTemplates={};var tmplID="__kRouteTemplate_"+routeName;if(!oTagRouteOptions.hasOwnProperty("templates")||(oTagRouteOptions.templates)){var oTagRouteOptionsTemplates=oTagRouteOptions.templates;var rTemplateId=klib.routeTemplateId(routeName);var routeTemplateContainerID="#"+rTemplateId;var hashTmplID="__tmpl_"+rTemplateId;switch(true){case (_.isString(oTagRouteOptionsTemplates)):var targetTmplId=tmplID;var tmplPath=oTagRouteOptionsTemplates.trimStr();if((tmplPath).equalsIgnoreCase(".")){tmplPath=defaultTmplPath}else{if((tmplPath).equalsIgnoreCase("#")){targetTmplId=hashTmplID;tmplPath=routeTemplateContainerID}}kRenderOptions.dataTemplates[targetTmplId]=tmplPath.ifBlankStr("none");break;case (_.isArray(oTagRouteOptionsTemplates)):if(_.indexOf(oTagRouteOptionsTemplates,".")>=0){kRenderOptions.dataTemplates[tmplID+"_dot"]=defaultTmplPath;_.pull(oTagRouteOptionsTemplates,".")}if(_.indexOf(oTagRouteOptionsTemplates,"#")>=0){kRenderOptions.dataTemplates[hashTmplID]=routeTemplateContainerID;_.pull(oTagRouteOptionsTemplates,"#")}_.each(oTagRouteOptionsTemplates,function(templateUrl,sIndex){kRenderOptions.dataTemplates[tmplID+"_"+(sIndex+1)]=templateUrl.ifBlankStr("none")});break;default:kRenderOptions.dataTemplates[tmplID]=defaultTmplPath;break}}else{klib.console.warn("Route without template");kRenderOptions.dataTemplates[tmplID]="none"}if(tmplEngine){kRenderOptions.dataTemplateEngine=tmplEngine}var useScripts=(!oTagRouteOptions.hasOwnProperty("scripts")||(oTagRouteOptions.scripts));if(useScripts){kRenderOptions.dataScripts={};var scriptID="__kRouteScript_"+routeName;switch(true){case (_.isString(oTagRouteOptions.scripts)):kRenderOptions.dataScripts[scriptID]=(_.indexOf(oTagRouteOptions.scripts,".")>=0)?defaultScriptPath:oTagRouteOptions.scripts;break;case (_.isArray(oTagRouteOptions.scripts)):if(_.indexOf(oTagRouteOptions.scripts,".")>=0){kRenderOptions.dataScripts[scriptID]=defaultScriptPath;_.pull(oTagRouteOptions.scripts,".")}_.each(oTagRouteOptions.scripts,function(scriptUrl,sIndex){kRenderOptions.dataScripts[scriptID+"_"+(sIndex+1)]=scriptUrl});break;default:if(klib.routesOptions.loadDefaultScript){kRenderOptions.dataScripts[scriptID]=defaultScriptPath}else{klib.console.warn("Script(s) not included. Use <klib.routesOptions.loadDefaultScript = true> to load default script <"+defaultScriptPath+">.")}break}klib.console.log(kRenderOptions.dataScripts)}if(oTagRouteOptions.dataUrl||oTagRouteOptions.dataurl){var tagDataUrl=oTagRouteOptions.dataurl||oTagRouteOptions.dataUrl;var kRenderDataUrls=klib.toRenderDataStructure(tagDataUrl,routeParams);if(!_.isEmpty(kRenderDataUrls)){_.merge(kRenderOptions,kRenderDataUrls)}}var overrideDefaultCallback=(oTagRouteOptions.hasOwnProperty("after")||oTagRouteOptions.hasOwnProperty("callback")||oTagRouteOptions.hasOwnProperty("callBack"));if(overrideDefaultCallback||oTagRouteOptions.after||oTagRouteOptions.callback||oTagRouteOptions.callBack){kRenderOptions.dataRenderCallback=oTagRouteOptions.after||oTagRouteOptions.callback||oTagRouteOptions.callBack||""}if(oTagRouteOptions.hasOwnProperty("scripts")&&klib.isBlank(oTagRouteOptions.hasOwnProperty("scripts"))){if(!overrideDefaultCallback){kRenderOptions.dataRenderCallback=""}else{if(_.isString((kRenderOptions.dataRenderCallback))&&(kRenderOptions.dataRenderCallback).equalsIgnoreCase(".")){kRenderOptions.dataRenderCallback=defaultRenderCallback}}}if(useTargetOptions&&foundRenderTarget){var $elTarget=$(renderTarget);if($elTarget.data("url")){delete kRenderOptions.dataUrl}if($elTarget.data("template")||$elTarget.data("templates")){delete kRenderOptions.dataTemplates}if($elTarget.data("scripts")){delete kRenderOptions.dataScripts}if($elTarget.data("templateEngine")){delete kRenderOptions.dataTemplateEngine}if($elTarget.data("renderCallback")){delete kRenderOptions.dataRenderCallback}}klib.console.info("Route Render Options Before preRenderProcess:");klib.console.info(kRenderOptions);var beforeRenderOptions={};var fnToRunBefore=oTagRouteOptions.before||oTagRouteOptions.beforeroute||oTagRouteOptions.beforeRoute||klib.routesOptions.beforeRoute;klib.console.info("callBeforeRoute: "+fnToRunBefore);if(fnToRunBefore){if(!_.isFunction(fnToRunBefore)&&_.isString(fnToRunBefore)){if(fnToRunBefore.equals(defaultCallBeforeRoute)){defaultCallBeforeRoute=undefined}fnToRunBefore=klib.findSafe(window,fnToRunBefore)}if(_.isFunction(fnToRunBefore)){beforeRenderOptions=fnToRunBefore.call(undefined,{el:$elRouteBase,target:renderTarget,renderOptions:kRenderOptions,routeOptions:oTagRouteOptions});if(_.isObject(beforeRenderOptions)){_.merge(kRenderOptions,beforeRenderOptions)}}else{klib.console.error("CallBeforeRouteFunction <"+oTagRouteOptions.before+"> NOT FOUND.")}}if(defaultCallBeforeRoute){fnToRunBefore=klib.findSafe(window,defaultCallBeforeRoute);if(fnToRunBefore&&_.isFunction(fnToRunBefore)){beforeRenderOptions=fnToRunBefore.call(undefined,{el:$elRouteBase,target:renderTarget,renderOptions:kRenderOptions,routeOptions:oTagRouteOptions});if(_.isObject(beforeRenderOptions)){_.merge(kRenderOptions,beforeRenderOptions)}}}klib.console.info("Route Render Options After preRenderProcess:");klib.console.info(kRenderOptions);if((!kRenderOptions.hasOwnProperty("render")||(kRenderOptions.render))&&(!oTagRouteOptions.hasOwnProperty("render")||(oTagRouteOptions.render))){klib.render(renderTarget,kRenderOptions)}}return true};klib.route=function(elRouteBase,routeOptions){if(_.isString(elRouteBase)&&klib.isBlank((""+elRouteBase).trimStr("#"))){return false}var foundRouteElBase=!_.isString(elRouteBase);routeOptions=routeOptions||{};if(!foundRouteElBase){var elWithRoute=$("[data-kroute][href='"+elRouteBase+"']");foundRouteElBase=!_.isEmpty(elWithRoute);if(!foundRouteElBase){klib.console.warn("Route source element NOT FOUND for route <"+elRouteBase+">");if(klib.routesOptions.usePatterns){klib.console.info("Searching RoutePattern.");var rPatternRouteOptions;var indexOfNameOrPattern=_.findIndex(klib.routePatterns.routes,function(opt){var matchFound=false;var _routeMatch=klib.routeMatch(opt.pattern,elRouteBase);if(_routeMatch){matchFound=true;rPatternRouteOptions=_.merge({},opt.routeoptions||{});rPatternRouteOptions.urlhash={pattern:(opt.pattern).replace(/\\\?/g,"?"),url:elRouteBase,urlParams:_routeMatch}}return matchFound});if(indexOfNameOrPattern<0){klib.console.warn("Pattern not found.");klib.console.info(klib.routePatterns.routes)}else{klib.console.info(rPatternRouteOptions);klib.routeRender(undefined,rPatternRouteOptions)}}else{klib.console.warn("Pattern match Disabled.")}}else{elRouteBase=elWithRoute.get(0)}}if(!foundRouteElBase){if(routeOptions.forceroute||routeOptions.forceRoute){klib.console.warn("Attempt dynamic route.");foundRouteElBase=true;elRouteBase=$("<a href='"+elRouteBase+"'></a>").get(0)}else{klib.console.warn("Exit Route.");return false}}if(foundRouteElBase){return klib.routeRender(elRouteBase,routeOptions)}};klib.initRoutes=function(routeInitScope,routeInitOptions){if(typeof routeInitScope=="object"){routeInitOptions=routeInitScope;routeInitScope=routeInitOptions.context||routeInitOptions.scope||""}if(routeInitOptions){klib.console.info("Init routesOptions");_.merge(klib.routesOptions,routeInitOptions);if(!isKHashRouteOn&&klib.routesOptions.useHashRoute){klib._initWindowOnHashChange()}if(isKHashRouteOn&&!klib.routesOptions.useHashRoute){klib._stopWindowOnHashChange()}if(!(routeInitOptions.hasOwnProperty("context")||routeInitOptions.hasOwnProperty("scope"))){return}}klib.console.info("Init kRoutes. Scan for [data-kroute] in context: <"+(routeInitScope||"body")+">");$(routeInitScope||"body").find("[data-kroute]").each(function(index,el){if(!klib.isBlank((($(el).attr("href")||"")+"#").split("#")[1])){$(el).off("click");$(el).on("click",function(){if(isKHashRouteOn){var elHash="#"+(((($(el).attr("href")||"")+"#").split("#")[1]).trimStr("#"));var winHash=klib.getLocHash();if(elHash.equals(winHash)){klib.route(this)}}else{klib.route(this)}});if(el.hasAttribute("data-kroute-default")){klib.route(el)}}})};$(document).ready(function(){klib.debug=klib.urlParam("klib.debug")||klib.hashParam("klib.debug")||klib.debug;klib.reflowFoundation();var kRouteInitOptions=$("body").data("krouteInit");if(kRouteInitOptions){klib.initRoutes(klib.toJSON(kRouteInitOptions))}klib.initRoutes("body");klib.extendBackbone();klib.initKeyTracking();var $autoRenderElList=$("[rel='kRender'],[data-render],[data-krender]");var autoRenderCount=$autoRenderElList.length;klib.console.info("Find and Render [rel='kRender'] or [data-render] or ,[data-krender]. Found:"+autoRenderCount);if(autoRenderCount){$autoRenderElList.kRender()}else{klib.console.info("Init Render.");$("body").append("<div id='initKRender0' data-template-engine='none' data-render-type='text' data-render-callback='off' style='display:none'></div>");$("#initKRender0").kRender()}})})(this);klib.console.info("klib loaded.");